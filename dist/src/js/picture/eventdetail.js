function load_event(e){$.ajax({type:"GET",url:"/cloudlink-inspection-event/eventInfo/get?token="+lsObj.getLocalStorage("token")+"&eventId="+e,contentType:"application/json",dataType:"json",success:function(e,n){var a=e.rows,t=a[0].pic;$(".eventpic_list").html(""),$(".event_code").text(a[0].eventCode),$(".event_type").text(a[0].fullTypeName),$(".report_man").text(a[0].inspectorName),$(".event_address").text(a[0].address),$(".event_description").text(a[0].description),$(".occurrenceTime").text(a[0].occurrenceTime);var i="";if(t.length>0)for(var s=0;s<t.length;s++)i+='<img class="show_pic" src="/cloudlink-core-file/file/getImageBySize?fileId='+t[s]+'&viewModel=fill&width=104&hight=78" id="imagesPic'+s+'" onmouseover="bigger(e)" onmouseout="smaller(e)" alt=""/>';else $(".pic_des").html("无");if($(".eventpic_list").append(i),0==a[0].audio.length)$(".event_audio").html("无");else{var o='<button  class="audioPlay" onclick="playAmrAudio(\''+a[0].audio[0]+"',this)\"></button>";$(".event_audio").html(o)}setcenter(a[0].bdLon,a[0].bdLat)}})}function view_detail(){$("#details").modal(),setTimeout(function(){load_event(currenteventid),load_task(currenteventid)},1e3)}function load_task(e){$.ajax({type:"GET",url:"/cloudlink-inspection-task/dispose/getPageListByEventId?bizId="+e+"&token="+lsObj.getLocalStorage("token"),contentType:"application/json",dataType:"json",success:function(e,n){var a=e.rows[0].disposeList;$(".dispose_content").html("");for(var t="",i=[],s="",o=0;o<a.length;o++)s!=a[o].modifyday&&(i.push(a[o].modifyday),s=a[o].modifyday);for(var l=0;l<i.length;l++){t='<div class="dispose_date" id="day_'+l+'"><div class="dispose_day"><div class="day_dian"></div><div class="day_time">'+i[l]+"</div></div></div>",$(".dispose_content").append(t);for(var d=0;d<a.length;d++){var c="";if(a[d].modifyday==i[l]){var p=a[d].recevieUserName;if(null!=p&&""!=p||(p="无"),c='<div class="dispose_main"><div class="dispose_main_l"><span class="dispose_time">'+a[d].modifytime+'</span></div><div class="dispose_main_r"><div class="dispose_info"><span class="modifyUserName">'+a[d].modifyUserName+'</span>&nbsp&nbsp<span class="disposeValue">'+a[d].disposeValue+'</span></div><div class="dispose_info"><span class="info_l text-right">信息描述：</span><div class="info_r">'+a[d].content+'</div></div><div class="dispose_info"><span class="info_l text-right">语音描述：</span><div class="info_r task_audio_'+d+'"></div></div><div class="dispose_info"><span class="info_l text-right">接收人：</span><div class="info_r">'+p+'</div></div><div class="dispose_info"><span class="info_l text-right">照片：</span><div class="info_r taskImg_'+d+'"></div></div></div></div>',$("#day_"+l).append(c),0==a[d].audio.length)$(".task_audio_"+d).html("无");else{var r='<button  class="audioPlay" onclick="playAmrAudio(\''+a[d].audio[0]+"',this)\"></button>";$(".task_audio_"+d).html(r)}for(var v=a[d].pic,m="",u=0;u<v.length;u++)m+='<div class="task_pic_list"><img  src="/cloudlink-core-file/file/getImageBySize?fileId='+v[u]+'&viewModel=fill&width=104&hight=78" id="taskImagesPic'+u+'" onclick="previewPicture(this)" alt=""/></div>';$(".taskImg_"+d).append(m)}}}}})}function setcenter(e,n){var a=new BMap.Map("details_address_map");a.clearOverlays();var t=new BMap.Point(e,n),i=new BMap.Icon("/src/images/event/personal.png",new BMap.Size(130,130)),s=new BMap.Marker(t,{icon:i});a.addOverlay(s),a.centerAndZoom(t,15)}function addClickHandler(e,n){n.addEventListener("click",function(n){$(".event_list").css("display","block"),load_event(e.eventid),currenteventid=e.eventid})}function show_point(){var e={status:"20",type:"",startDate:"2016-10-01",endDate:(new Date).Format("yyyy-MM-dd"),keyword:"",userIds:JSON.parse(lsObj.getLocalStorage("userBo")).objectId,pageNum:1,pageSize:1e4};$.ajax({type:"POST",url:"/cloudlink-inspection-event/eventInfo/web/v1/getPageList?token="+lsObj.getLocalStorage("token"),data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(e,n){event_data=e.rows,$(".inhand").text(event_data.length);var a=Enumerable.From(event_data).Where(function(e){return e.disposeTime.split(" ")[0]==(new Date).Format("yyyy-MM-dd")}).Select(function(e){return e}).ToArray();if($(".newevent").text(a.length),$(".Allevent").html(""),event_data.length>0){for(var t="<ul>",i=0;i<event_data.length;i++)t+='<li class=""><div class="line01"> <span class="type">'+event_data[i].fullTypeName+'</span><span class="name">'+event_data[i].inspectorName+'</span><span class="date">'+event_data[i].disposeTime+'</span></div><div class="loca_desc">'+event_data[i].address+"</div> </li>",eventListAndbiaozhu(event_data[i]);t+="</ul>",$(".Allevent").append(t)}}})}function quite(){var e=$("#search").val().trim(),n=Enumerable.From(event_data).Where(function(n){return n.fullTypeName.indexOf(e)>=0}).Select(function(e){return e}).ToArray();if(Mapobj.clearOverlays(),n.length>0){$(".Allevent").html("");for(var a="<ul>",t=0;t<n.length;t++)a+='<li class=""><div class="line01"> <span class="type">'+n[t].fullTypeName+'</span><span class="name">'+n[t].inspectorName+'</span><span class="date">'+n[t].disposeTime+'</span></div><div class="loca_desc">'+n[t].address+"</div> </li>",eventListAndbiaozhu(n[t]);a+="</ul>",$(".Allevent").append(a)}}function eventListAndbiaozhu(e){var n="";1==e.parentTypeId?n=new BMap.Icon("/src/images/event/con1.png",new BMap.Size(29,42)):2==e.parentTypeId?n=new BMap.Icon("/src/images/event/dis1.png",new BMap.Size(29,42)):3==e.parentTypeId&&(n=new BMap.Icon("/src/images/event/pip1.png",new BMap.Size(29,42)));var a=(e.objectId,new BMap.Point(e.bdLon,e.bdLat)),t=new BMap.Marker(a,{icon:n});Mapobj.addOverlay(t),addClickHandler({tsakid:e.inspectorId,eventid:e.objectId},t)}function show_peoplepoint(){var e=(new BMap.Icon("/src/images/map/online.png",new BMap.Size(20,20)),{});$.ajax({type:"GET",url:"/cloudlink-inspection-event/inspectionRecord/getOnline?token="+lsObj.getLocalStorage("token"),data:e,contentType:"application/json",dataType:"json",success:function(e,n){}})}var eventcount=0,Mapobj=null,eventId=null,taskId=null,currenteventid=null,event_data=null;$(function(){Mapobj=new BMap.Map("container"),Mapobj.centerAndZoom(new BMap.Point(116.404,39.915),5),Mapobj.enableScrollWheelZoom(!0);var e=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT}),n=new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});Mapobj.addControl(e),Mapobj.addControl(n),Mapobj.addControl(new BMap.MapTypeControl)}),$("#collapseOne").on("shown.bs.collapse",function(){$(".glyphicon1").removeClass("glyphicon-menu-down"),$(".glyphicon1").addClass("glyphicon-menu-up")}),$("#collapseOne").on("hidden.bs.collapse",function(){$(".glyphicon1").removeClass("glyphicon-menu-up"),$(".glyphicon1").addClass("glyphicon-menu-down")}),$("#collapseTwo").on("shown.bs.collapse",function(){$(".glyphicon2").removeClass("glyphicon-menu-down"),$(".glyphicon2").addClass("glyphicon-menu-up")}),$("#collapseTwo").on("hidden.bs.collapse",function(){$(".glyphicon2").removeClass("glyphicon-menu-up"),$(".glyphicon2").addClass("glyphicon-menu-down")}),$(".closeInformation").click(function(){$(".panel-group").css({display:"none"})}),$("#datetimeStart").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,startDate:new Date}).on("click",function(){$("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())}),$("#datetimeEnd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,startDate:new Date}).on("click",function(){$("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())}),$("#timeStart").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,startDate:new Date}).on("click",function(){$("#timeStart").datetimepicker("setEndDate",$("#timeEnd").val())}),$("#timeEnd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,startDate:new Date}).on("click",function(){$("#timeEnd").datetimepicker("setStartDate",$("#timeStart").val())});var peopleImg=!1,peopleChange=$(".renyuan .changeImg");$(peopleChange).click(function(){peopleImg?($(peopleChange).attr("src","/src/images/map/open.png"),peopleImg=!1):($(peopleChange).attr("src","/src/images/map/close.png"),$("#accordion").css("display","none"),peopleImg=!0)});var eventImg=!1,eventChange=$(".shijian .changeImg");$(eventChange).click(function(){eventImg?($(eventChange).attr("src","/src/images/map/open.png"),show_point(),eventImg=!1):($(eventChange).attr("src","/src/images/map/close.png"),Mapobj.clearOverlays(),$(".event_list").css("display","none"),eventImg=!0)});