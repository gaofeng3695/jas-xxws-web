function IsExistEnterprised(){var e=JSON.parse(lsObj.getLocalStorage("userBo")),t="",s="",o="",n="";$(".userName").text(e.userName);var a={userId:e.objectId};$.ajax({type:"GET",url:"/cloudlink-core-framework/enterprise/getByUserId?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:a,dataType:"json",success:function(e){if(1==e.success){console.log(JSON.stringify(e));for(var a=e.rows,r=0;r<a.length;r++)-3==a[r].status||-2==a[r].status?t+=a[r].enterpriseName+"，":-1==a[r].status?o+='<div class="radio"><input type = "radio"  name = "optionEnterprise"   id = "foren'+r+'" value = "'+a[r].objectId+'" class ="fl wh20 radiobox " disabled><label for="foren"'+r+' class="forzen" >'+a[r].enterpriseName+"（被冻结）</label></div>":1==a[r].status?s+='<div class="radio "><input type = "radio" name = "optionEnterprise"   id = "join'+r+'" value = "'+a[r].objectId+'" class ="fl wh20 radiobox"><label for="join"'+r+"  >"+a[r].enterpriseName+"</label></div>":0==a[r].status&&(n+='<div class="radio"><input type = "radio"  name = "optionEnterprise"   id = "nojoin'+r+'" value = "'+a[r].objectId+'" class ="fl wh20 radiobox"><label for="nojoin"'+r+">"+a[r].enterpriseName+"（受邀请）</label></div>");if(""!=t){var c="<b><p>您已被<span>【"+t.substring(0,t.lastIndexOf("，"))+"】等公司移除</span></p></b>";$(".deleteEnterprised").append(c)}else $(".deleteEnterprised").css("display","none");""==s&&""==n&&""==o?($(".bottom1").css("display","block"),$(".bottom2").css("display","none")):""==s&&""==n?($(".allEnterprised").append(o),$(".bottom1").css("display","block"),$(".bottom2").css("display","none")):($(".allEnterprised").append(s+n+o),$(".bottom2").css("display","block"),$(".bottom1").css("display","none"))}}})}function createNewEnterprise(){var e=$(".companyName").val().trim(),t=$(".companyScale").val(),s=$(".companyRole").val(),o={userId:JSON.parse(lsObj.getLocalStorage("userBo")).objectId,roleIds:s,enterpriseName:e,enterpriseScale:t};$.ajax({type:"POST",url:"/cloudlink-core-framework/login/registEnterpriseAndLogin",contentType:"application/json",data:JSON.stringify(o),dataType:"json",success:function(e){1==e.success?(lsObj.setLocalStorage("userBo",JSON.stringify(e.rows[0])),lsObj.setLocalStorage("token",e.token),setDefaultEnterprise()):xxwsWindowObj.xxwsAlert("企业创建失败")}})}function getDefaultEnterpriseId(e){$.ajax({type:"POST",url:"/cloudlink-core-framework/login/getDefaultEnterpriseId",contentType:"application/json",data:JSON.stringify({userId:e}),dataType:"json",success:function(e){1==e.success&&e.rows.length>0&&joinDefaultEnterprise(e.rows[0].enterpriseId)},error:function(e,t,s){console.log(e),console.log(t),console.log(s)}})}function joinDefaultEnterprise(e){var t=JSON.parse(lsObj.getLocalStorage("userBo"));$.ajax({type:"POST",url:"/cloudlink-core-framework/login/joinEnterprise",contentType:"application/json",data:JSON.stringify({userId:t.objectId,enterpriseId:e}),dataType:"json",success:function(e){if(1==e.success){var t=e.rows,s=e.token;lsObj.setLocalStorage("token",s),lsObj.setLocalStorage("userBo",JSON.stringify(t[0])),lsObj.setLocalStorage("timeOut",(new Date).getTime()+828e5),location.href="../../main.html"}else switch(e.code){case"400":$(".hidkuai2 span").text("服务异常");break;case"401":$(".hidkuai2 span").text("参数异常");break;case"E01":$(".hidkuai2 span").text("您的账户已被该企业冻结");break;case"E02":$(".hidkuai2 span").text("您的账户已被该企业移除");break;case"E03":$(".hidkuai2 span").text("该企业不存在")}},error:function(e,t,s){console.log(e),console.log(t),console.log(s)}})}function setDefaultEnterprise(){var e=JSON.parse(lsObj.getLocalStorage("userBo"));$.ajax({type:"POST",url:"/cloudlink-core-framework/user/setDefaultEnterprise?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify({userId:e.objectId,enterpriseId:e.enterpriseId}),dataType:"json",success:function(e){1==e.success&&($(".bottom1").css("display","none"),$(".bottom2").css("display","none"),$(".bottom3").css("display","none"),$(".bottom4").css("display","block"),jumpto())}})}function checkenterpriseScale(){return"0"===$(".companyScale").val()?($(".companyTs").css("display","block"),$("#companyTs").text("请选择企业规模"),!1):($(".companyTs").css("display","none"),$("#companyTs").text(""),!0)}function checkCompanyRole(){return"请选择"===$(".companyRole").val()?($(".roleTs").css("display","block"),$("#roleTs").text("请选择角色"),!1):($(".roleTs").css("display","none"),$("#roleTs").text(""),!0)}function checkEnterprised(){var e=$(".companyName").val().trim();return 0===e.length?($(".companyMsg").css("display","block"),$("#companyMsg").text("请输入企业名称"),!1):!0===/[^(A-Za-z_\-\u4e00-\u9fa5)]/.test(e)?($(".companyMsg").css("display","block"),$("#companyMsg").text("企业名称只能由汉字、字母、下划线组成"),!1):e.length<2?($(".companyMsg").css("display","block"),$("#companyMsg").text("您输入的企业名称过短"),!1):e.length>30?($(".companyMsg").css("display","block"),$("#companyMsg").text("您输入的企业名称过长"),!1):($("#companyMsg").text(""),$(".companyMsg").css("display","none"),!0)}function jumpto(){var e=5,t=setInterval(function(){e--,e<1&&(clearInterval(t),top.location.href="../../main.html"),$(".jumpTo").text(e)},1e3)}$(function(){IsExistEnterprised()}),$("body").on("click",".radio",function(){$(".radio").removeClass("on_check"),$(this).addClass("on_check"),$(this).find("input[type='radio']").prop("checked",!0)}),$(".createNewEnterprised").click(function(){$(".bottom1").css("display","none"),$(".bottom2").css("display","none"),$(".bottom3").css("display","block")}),$(".quiteCreate").click(function(){var e=$(".companyName").val().trim();$(".companyScale").val(),$(".companyRole").val();checkEnterprised()&&checkenterpriseScale()&&checkCompanyRole()&&$.ajax({type:"POST",url:"/cloudlink-core-framework/enterprise/isExist",contentType:"application/json",data:JSON.stringify({enterpriseName:e}),dataType:"json",success:function(e){1==e.success&&(1==e.rows[0].isExist?(xxwsWindowObj.xxwsAlert("您好，该企业已注册！"),$(".companyName").focus()):createNewEnterprise())}})}),$(".setDefaultAndLogin").click(function(){var e="",t="";t=$("input[name='optionEnterprise']:checked").val(),e=$("input[name='optionEnterprise']:checked").attr("id");var s=JSON.parse(lsObj.getLocalStorage("userBo"));null==t||""==t?xxwsWindowObj.xxwsAlert("请选择一个默认企业后，才可登录成功"):""!=e?$.ajax({type:"POST",url:"/cloudlink-core-framework/user/setDefaultEnterpriseAndJoin?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify({userId:s.objectId,enterpriseId:t}),dataType:"json",success:function(e){1==e.success?getDefaultEnterpriseId(s.objectId):xxwsWindowObj.xxwsAlert("默认企业设置失败，请重新登录进行设置")}}):$.ajax({type:"POST",url:"/cloudlink-core-framework/user/setDefaultEnterprise?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify({userId:s.objectId,enterpriseId:t}),dataType:"json",success:function(e){1==e.success?getDefaultEnterpriseId(s.objectId):xxwsWindowObj.xxwsAlert("默认企业设置失败，请重新登录进行设置")}})}),$(".quitToLogin").click(function(){lsObj.clearAll(),location.href="../../login.html"}),$(".companyTs").blur(function(){checkenterpriseScale()}),$(".companyRole").blur(function(){checkCompanyRole()}),$(".companyName").blur(function(){checkEnterprised()}),$(".createFinish").click(function(){top.location.href="../../main.html"});