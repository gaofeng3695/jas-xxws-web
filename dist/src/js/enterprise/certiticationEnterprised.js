function closebusinessImg(e){$(e).closest(".business_enterprise_images").remove();for(var i=0;i<$(".business_img_file").find("input[name='file']").length;i++)$(".business_img_file").find("input").eq(i).attr("data-value")==$(e).attr("data-key")&&$(".business_img_file").find("input").eq(i).remove()}function closeIndefityImg(e){$(e).closest(".identify_enterprise_images").remove();for(var i=0;i<$(".identify_img_file").find("input[name='file']").length;i++)$(".identify_img_file").find("input").eq(i).attr("data-value")==$(e).attr("data-key")&&$(".identify_img_file").find("input").eq(i).remove()}function closeRoseImg(e){$(e).closest(".rose_enterprise_images").remove();for(var i=0;i<$(".rose_img_file").find("input[name='file']").length;i++)$(".rose_img_file").find("input").eq(i).attr("data-value")==$(e).attr("data-key")&&$(".rose_img_file").find("input").eq(i).remove()}function previewPicture(e){viewPicObj.viewPic(e)}$(function(){enterprisedObj.init()});var enterprisedObj={$submitApplay:$(".submitApplay"),$submitInformation:$("#submitInformation"),$addBusinessImg:$(".addBusinessImg"),$addidentifyImg:$(".addidentifyImg"),$addroseImg:$(".addroseImg"),currentstatus:null,$flag:!0,imgIndex:0,userBo:JSON.parse(lsObj.getLocalStorage("userBo")),init:function(){this.authenticationstatus(),this.bindEvent()},bindEvent:function(){var e=this;e.$submitApplay.click(function(){-1==e.currentstatus?e.deleteImgByEnterpriseId():($(".certification_main").css("display","none"),$(".enterpriseInformation").css("display","block"),$("#enterpriseName").val(e.userBo.enterpriseName))}),e.$addBusinessImg.click(function(){$(".business_img_list").find(".business_enterprise_images").length<=2?$(".upload_business_picture").trigger("click"):xxwsWindowObj.xxwsAlert("最多上传三张图片")}),e.$addidentifyImg.click(function(){$(".identify_img_list").find(".identify_enterprise_images").length<=1?$(".upload_identify_picture").trigger("click"):xxwsWindowObj.xxwsAlert("最多上传两张图片")}),e.$addroseImg.click(function(){$(".rose_img_list").find(".rose_enterprise_images").length<=5?$(".upload_rose_picture").trigger("click"):xxwsWindowObj.xxwsAlert("最多上传6张图片")}),e.$submitInformation.click(function(){e.$flag&&e.verify()&&(e.$flag=!1,e.subBusinessmitImg())})},authenticationstatus:function(){var e=this;$(".enterprise_Name").text(e.userBo.enterpriseName),$.ajax({type:"GET",url:"/cloudlink-core-framework/enterprise/getById?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:{objectId:e.userBo.enterpriseId},dataType:"json",success:function(i){1==i.success&&(0==i.rows[0].authenticateStatus?(e.currentstatus=0,$(".status").text("未认证")):1==i.rows[0].authenticateStatus?(e.currentstatus=1,$(".status").text("已认证"),$(".status").css("background","#06dd8f"),$(".submitApplay").css("display","none")):-1==i.rows[0].authenticateStatus?(e.currentstatus=-1,$(".status").text("未认证"),e.searchIdea()):2==i.rows[0].authenticateStatus&&(e.currentstatus=2,$(".status").css("display","none"),document.getElementById("submitApplay").disabled=!0,$(".submitApplay").text("审核中..."),$(".submitApplay").css("background","#ccc")))}})},verify:function(){var e=this;return!!e.checkEnterprised()&&(e.checkEnterpriseCode()?!!e.checkBusinessImg():void 0)},subBusinessmitImg:function(){var e=this;if($(".business_img_list").find(".business_enterprise_images").length==e.imgIndex)e.imgIndex=0,e.submitIdentify();else{var i=$(".business_img_file").find("input").eq(e.imgIndex).attr("id");this.subBusinessmitImgSycn(i)}},subBusinessmitImgSycn:function(e){var i=this;$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+i.userBo.enterpriseId+"&bizType=pic_business&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:e,dataType:"json",type:"POST",async:!1,success:function(e,t){1==e.success?(i.imgIndex=i.imgIndex+1,i.subBusinessmitImg()):xxwsWindowObj.xxwsAlert("当前网络不稳定",function(){i.imgIndex=0,i.again()})}})},submitIdentify:function(){var e=this,i=$(".identify_img_list").find(".identify_enterprise_images").length;if(0==i||i==e.imgIndex)e.imgIndex=0,e.submitRose();else{var t=$(".identify_img_file").find("input").eq(e.imgIndex).attr("id");e.submitIdentifySycn(t)}},submitIdentifySycn:function(e){var i=this;$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+i.userBo.enterpriseId+"&bizType=pic_identity&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:e,dataType:"json",type:"POST",async:!1,success:function(e,t){1==e.success?(i.imgIndex=i.imgIndex+1,i.submitIdentify()):xxwsWindowObj.xxwsAlert("当前网络不稳定",function(){i.imgIndex=0,i.again()})}})},submitRose:function(){var e=this,i=$(".rose_img_list").find(".rose_enterprise_images").length;if(0==i||i==e.imgIndex)e.fillInformation();else{var t=$(".rose_img_file").find("input").eq(e.imgIndex).attr("id");e.submitRoseSycn(t)}},submitRoseSycn:function(e){var i=this;$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+i.userBo.enterpriseId+"&bizType=pic_roster&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:e,dataType:"json",type:"POST",async:!1,success:function(e,t){1==e.success?(i.imgIndex=i.imgIndex+1,i.submitRose()):xxwsWindowObj.xxwsAlert("当前网络不稳定",function(){i.imgIndex=0,i.again()})}})},fillInformation:function(){var e=this,i=$("#enterpriseName").val().trim(),t=$("#enterpriseCode").val().trim();$.ajax({type:"POST",url:"/cloudlink-core-framework/enterprise/authenticate?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify({objectId:e.userBo.enterpriseId,enterpriseName:i,registerNum:t}),dataType:"json",success:function(i){if(1==i.success){var t={tip:"申请成功",name_title:"提示",name_confirm:"确定",callBack:function(){$(".enterpriseInformation").css("display","none"),$(".certification_main").css("display","block"),e.authenticationstatus()}};xxwsWindowObj.xxwsAlert(t)}else"402"==i.code?xxwsWindowObj.xxwsAlert("您好，该公司名称已被占用，请联系客服。",function(){e.imgIndex=0,e.deleteImgByEnterpriseId()}):xxwsWindowObj.xxwsAlert("当前网络不稳定",function(){e.imgIndex=0,e.deleteImgByEnterpriseId()})}})},deleteImgByEnterpriseId:function(){var e=this,i=["pic_business","pic_identity","pic_roster"],t=[e.userBo.enterpriseId];$.ajax({type:"POST",contentType:"application/json",url:"/cloudlink-core-file/attachment/delBizAndFileByBizIdsAndBizAttrs?token="+lsObj.getLocalStorage("token"),data:JSON.stringify({bizTypes:i,bizIds:t}),dataType:"json",success:function(i){1==i.success?(e.again(),$(".dismissed-reason").css("display","none"),$(".certification_main").css("display","none"),$(".enterpriseInformation").css("display","block"),$("#enterpriseName").val(e.userBo.enterpriseName)):xxwsWindowObj.xxwsAlert("当前网络不稳定",function(){e.again()})}})},viewEnterpriseInformation:function(){var e=this;$.ajax({type:"GET",dataType:"json",url:"/cloudlink-core-framework/enterprise/getById?token="+lsObj.getLocalStorage("token"),data:{objectId:e.userBo.enterpriseId},success:function(i){1==i.success&&($("#enterpriseNames").val(i.rows[0].enterpriseName),$("#enterpriseCodes").val(i.rows[0].registerNum),e.viewBusinessImg())}})},viewBusinessImg:function(){var e=this;$.ajax({type:"GET",dataType:"json",url:"/cloudlink-core-file/attachment/getFileIdListByBizIdAndBizAttr?token="+lsObj.getLocalStorage("token"),data:{businessId:e.userBo.enterpriseId,bizType:"pic_business"},success:function(i){if(1==i.success){for(var t="",s=0;s<i.rows.length;s++){t+='<li><img src="'+("/cloudlink-core-file/file/getImageBySize?fileId="+i.rows[s].fileId+"&viewModel=fill&width=120&hight=82")+' " data-original="/cloudlink-core-file/file/downLoad?fileId='+i.rows[s].fileId+'" id="imagesBusiness'+s+'" onclick="previewPicture(this)" alt=""/></li>'}$(".business_list").append(t),e.viewIdentifyImg()}}})},viewIdentifyImg:function(){var e=this;$.ajax({type:"GET",dataType:"json",url:"/cloudlink-core-file/attachment/getFileIdListByBizIdAndBizAttr?token="+lsObj.getLocalStorage("token"),data:{businessId:e.userBo.enterpriseId,bizType:"pic_identity"},success:function(e){if(1==e.success){var i="";if(0==e.rows.length)$(".identifyImg").css("display","none");else{for(var t=0;t<e.rows.length;t++){i+='<li><img src="'+("/cloudlink-core-file/file/getImageBySize?fileId="+e.rows[t].fileId+"&viewModel=fill&width=120&hight=82")+'" data-original="/cloudlink-core-file/file/downLoad?fileId='+e.rows[t].fileId+'" id="imagesIdentify'+t+'" onclick="previewPicture(this)" alt=""/><li>'}$(".identify_list").append(i)}}}})},checkEnterprised:function(){var e=$("#enterpriseName").val().trim();return 0===e.length?($(".enterprisenote").text("请输入企业名称"),!1):!0===/[^(A-Za-z_\-\u4e00-\u9fa5)]/.test(e)?($(".enterprisenote").text("企业名称只能由汉字、字母、下划线组成"),!1):e.length<2?($(".enterprisenote").text("您输入的企业名称过短"),!1):e.length>30?($(".enterprisenote").text("您输入的企业名称过长"),!1):($(".enterprisenote").text(""),!0)},checkEnterpriseCode:function(){var e=$("#enterpriseCode").val().trim();return""==e||"请填写社会统一信用代码（必填）"==e?($(".noteCode").text("请输入社会统一信用代码"),!1):($(".noteCode").text(""),!0)},checkBusinessImg:function(){return 0==$(".business_img_list").find(".business_enterprise_images").length?($(".businessnote").text("请至少上传一张营业执照"),!1):($(".businessnote").text(""),!0)},searchIdea:function(){$(".dismissed-reason").css("display","block"),$.ajax({type:"get",dataType:"json",url:"/cloudlink-core-framework/enterprise/getAuthApproveContent?token="+lsObj.getLocalStorage("token"),data:{enterpriseId:this.userBo.enterpriseId},success:function(e){1==e.success&&""!=e.rows[0].approveContent&&null!=e.rows[0].approveContent?$(".reason").text(e.rows[0].approveContent):$(".reason").text("无驳回意见")}})},again:function(){this.$flag=!0}};$("#enterpriseName").blur(function(){enterprisedObj.checkEnterprised()}),$("#enterpriseCode").blur(function(){enterprisedObj.checkEnterpriseCode()});