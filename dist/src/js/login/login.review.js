!function(e,n,t,i,a,s){"use strict";var o=function(){this.passwordVal=null,this.nameVal=null,this.eventsMap={"focus .name input":"nameFocus","blur .name input":"nameBlur","focus .password input":"pswdFocus","blur .password input":"pswdBlur","click .btn":"login","keydown input":"keydownLogin"},this.initializeElements(),this.initialization()};o.Eles={name:".name",password:".password",nameInput:".name input",passwordInput:".password input",nTip:".hidkuai1 span",pTip:".hidkuai2 span"};var r={zhugeTrackForFailed:function(e,n){1==a&&s.track("登陆失败",{"手机号":e,"原因":n})},zhugeTrackForSuccess:function(e){1==a&&(s.identify(e.objectId,{name:e.userName,gender:e.sex,age:e.age,email:e.email,qq:e.qq,weixin:e.wechat,mobile:e.mobileNum,"企业名称":null==e.enterpriseName?"":e.enterpriseName,"部门名称":null==e.orgName?"":e.orgName}),s.track("登陆成功"))}},c={nameImg:"url(src/images/loginImg/nameImg.png)",nameImg1:"url(src/images/loginImg/nameImg1.png)",passwordImg:"url(src/images/loginImg/password1.png)",passwordImg1:"url(src/images/loginImg/password.png)",setActiveStyle:function(e,n){e.css({background:"#ECF7FF",border:"1px solid #5EB6F9"}),e.find("input").css("background","#ECF7FF"),e.find(".common").css("border-left","1px solid #5EB6F9"),e.find(".bg").css("background-image",n)},setInitStyle:function(e,n){e.css({background:"#fff",border:"1px solid #bbb"}),e.find("input").css("background","#fff"),e.find(".common").css("border-left","1px solid #bbb"),e.find(".bg").css("background-image",n)}};o.prototype={constructor:o,_flag:!0,initialization:function(){this.bindEvent()},initializeElements:function(){var e=o.Eles;for(var t in e)e.hasOwnProperty(t)&&(this[t]=n(e[t]))},bindEvent:function(){this.initializeOrdinaryEvent(this.eventsMap)},unbindEvent:function(){this.uninitializeOrdinaryEvent(this.eventsMap)},initializeOrdinaryEvent:function(e){this._scanEventsMap(e,!0)},uninitializeOrdinaryEvent:function(e){this._scanEventsMap(e)},_scanEventsMap:function(e,t){var i=/^(\S+)\s*(.*)$/,a=t?"on":"off";for(var s in e)if(e.hasOwnProperty(s)){"string"==typeof e[s]&&(e[s]=this[e[s]].bind(this));var o=s.match(i);n("body")[a](o[1],o[2],e[s])}},destroy:function(){this.unbindEvent()},nameFocus:function(e){c.setActiveStyle(this.name,c.nameImg)},nameBlur:function(e){c.setInitStyle(this.name,c.nameImg1)},pswdFocus:function(e){c.setActiveStyle(this.password,c.passwordImg)},pswdBlur:function(e){c.setInitStyle(this.password,c.passwordImg1)},keydownLogin:function(e){13===e.which&&this.login()},login:function(e){var n=this.passwordInput,t=this.nameInput,i=this.pTip,a=this.nTip;this.nameVal=t.val().trim(),this.passwordVal=MD5(n.val().trim());var s=this.nameVal,o=this.nameVal,r=/^1\d{10}$/;""==s||null==s?(a.text("手机号码不能为空"),n.val("")):r.test(s)?""==o||null==o?(a.text(""),i.text("密码不能为空")):(a.text(""),i.text(""),this._requestIfTelregisted()):a.text("您输入的手机号码不正确")},_requestIfTelregisted:function(){var e={registNum:this.nameVal},t=this.nTip,i=this;1==i._flag&&(i._flag=!1,n(".btn").html("登录中...").css("background","#999"),n.ajax({type:"GET",url:"/cloudlink-core-framework/login/isExist",contentType:"application/json",data:e,dataType:"json",success:function(e,n){return 0==e.rows.isExist?(t.text("账号未注册"),r.zhugeTrackForFailed(i.nameVal,"账号未注册"),i.again(),!1):(i._requestData(),!0)},error:function(){return i.again(),!1}}))},_requestData:function(){var e=this,t=this.pTip,a={loginNum:this.nameVal,password:this.passwordVal};n.ajax({type:"POST",url:"/cloudlink-core-framework/login/loginByPassword",contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(n){if(1==n.success){var a=n.rows,s=n.token;i.setLocalStorage("token",s),i.setLocalStorage("userBo",JSON.stringify(a[0])),i.setLocalStorage("timeOut",(new Date).getTime()+828e5),e._getDefaultEnterpriseId(a[0].objectId)}else{if("U01"==n.code)return t.text("用户名和密码不一致"),r.zhugeTrackForFailed(e.nameVal,"用户名和密码不一致"),void e.again();if("U02"==n.code)return t.text("该用户未注册"),r.zhugeTrackForFailed(e.nameVal,"该用户未注册"),void e.again();if("U03"==n.code)return t.text("该用户已注册"),void e.again();if("U04"==n.code)return t.text("该账户已冻结"),void e.again();if("400"==n.code)return t.text("代码异常"),void e.again();if("401"==n.code)return t.text("参数异常"),void e.again()}},error:function(n,t,i){console.log(n),console.log(t),console.log(i),e.again()}})},_getDefaultEnterpriseId:function(e){var t=this,i=this.pTip;n.ajax({type:"POST",url:"/cloudlink-core-framework/login/getDefaultEnterpriseId",contentType:"application/json",data:JSON.stringify({userId:e}),dataType:"json",success:function(e){if(1==e.success)if(e.rows.length>0){var n=e.rows[0].enterpriseId;t._joinDefaultEnterprise(n)}else t.again(),i.text("当前用户未设置默认登录企业"),location.href="/src/html/loginSet.html";else t.again()},error:function(e,n,i){console.log(e),console.log(n),console.log(i),t.again()}})},_joinDefaultEnterprise:function(e){var t=this,a=this.pTip,s=JSON.parse(i.getLocalStorage("userBo"));n.ajax({type:"POST",url:"/cloudlink-core-framework/login/joinEnterprise",contentType:"application/json",data:JSON.stringify({userId:s.objectId,enterpriseId:e}),dataType:"json",success:function(e){if(1==e.success){t.again();var n=e.rows,o=e.token;i.setLocalStorage("token",o),i.setLocalStorage("userBo",JSON.stringify(n[0])),i.setLocalStorage("timeOut",(new Date).getTime()+828e5),r.zhugeTrackForSuccess(n[0]),location.href="main.html"}else switch(t.again(),e.code){case"400":a.text("服务异常"),r.zhugeTrackForFailed(s.mobileNum,"服务异常");break;case"401":a.text("参数异常"),r.zhugeTrackForFailed(s.mobileNum,"参数异常");break;case"E01":a.text("您的账户已被该企业冻结"),r.zhugeTrackForFailed(s.mobileNum,"您的账户已被该企业冻结");break;case"E02":a.text("您的账户已被该企业移除"),r.zhugeTrackForFailed(s.mobileNum,"您的账户已被该企业移除");break;case"E03":a.text("该企业不存在"),r.zhugeTrackForFailed(s.mobileNum,"该企业不存在")}},error:function(e,n,i){console.log(e),console.log(n),console.log(i),t.again()}})},again:function(){this._flag=!0,n(".btn").html("登&nbsp;&nbsp;录").css("background","#5EB6F9")}},n(function(){e.loginObj=new o})}(this,this.jQuery,document,lsObj,zhugeSwitch,zhuge),$("#versionInformation span").click(function(){$("#versionmodal").modal()});