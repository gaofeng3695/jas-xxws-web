function dateChangeForSearch(){var e=$("#datetimeStart").val(),a=$("#datetimeEnd").val();""!=e&&""!==a?$("#diyDateBtn").addClass("active"):$("#diyDateBtn").removeClass("active")}function checkLen(e){var a=$(e).val().length;a>199&&$(e).val($(e).val().substring(0,200));var t=200-a;t<0&&(t=0),$(e).next(".text_num").text("("+t+"字)")}var planObj={$addplan:$("#addPlan"),$deletePlan:$("button.deletePlan"),$closePlan:$("button.closePlan"),$addPlanFrame:$("#addPlanFrame"),$modifyPlanFrame:$("#modifyPlanFrame"),$planDetailsFrame:$("#planDetailsFrame"),$securityPeople:$(".planMainAdd input[name=securityPeople]"),$securityPeopleModify:$(".planMainModify input[name=securityPeople]"),$addChoiceUserBtn:$(".addChoiceUserBtn span.areaBtn"),$addChoiceRegionBtn:$(".addChoiceUserBtn span.regionBtn"),$modifyChoiceUserBtn:$(".modifyChoiceUserBtn span"),$lookUserListBtn:$(".lookUserList span"),$copyPlanBtn:$(".copyPlan"),selectPersonArr:[],_planId:null,_planNmae:null,_planShowStatus:null,_createUserId:null,_isEdit:null,_flag:!0,init:function(){var e=this;e.getTable(),e.bindPlanDate(),e.$addplan.click(function(){e.$addPlanFrame.modal(),e.$securityPeople.val(""),e.selectPersonArr=[],$(".planMainAdd").find("input").val(""),$(".planMainAdd").find("textarea").val(""),$("#addPlanFrame").removeData("userData"),$("#addPlanFrame").removeData("regionData")}),e.$addPlanFrame.on("shown.bs.modal",function(e){$("input[name=createUserNameAdd]").val(JSON.parse(lsObj.getLocalStorage("userBo")).userName)}),e.$addChoiceUserBtn.click(function(){e._isEdit=!1,choiceFrameObj.$choiceAreaFrame.modal(),choiceFrameObj._areaChoiceData=$("#addPlanFrame").data("userData")}),e.$addChoiceRegionBtn.click(function(){choiceFrameObj.$choiceRegionFrame.modal(),choiceFrameObj._regionChoiceData=$("#addPlanFrame").data("regionData")}),e.$modifyChoiceUserBtn.click(function(){e._isEdit=!0,choiceFrameObj.$choiceAreaFrame.modal(),choiceFrameObj._areaChoiceData=$("#modifyPlanFrame").data("userData")}),$(".regionChoiceTrueBtn").click(function(){var e=choiceFrameObj.getRegionChoiceData(),a=e.value;choiceFrameObj.$choiceRegionFrame.modal("hide");for(var t=[],n=0,i=0;i<a.length;i++)n+=a[i].choiceNumber,t.push(a[i].residential+"("+a[i].choiceNumber+"户)"),a[i].regionId="";$("#addPlanFrame").data("regionData",e.key),$("#addPlanFrame").data("userData",a),$("#addPlanFrame").find("input[name=planWorkload]").val(0==n?"":n),$("#addPlanFrame").find("textarea[name=securityCheckScope]").val(t.join("，"))}),$(".areaChoiceTrueBtn").click(function(){var a=choiceFrameObj.getAreaChoiceData();choiceFrameObj.$choiceAreaFrame.modal("hide");for(var t=[],n=0,i=0;i<a.length;i++)n+=a[i].choiceNumber,t.push(a[i].residential+"("+a[i].choiceNumber+"户)");1==e._isEdit?($("#modifyPlanFrame").data("userData",a),$("#modifyPlanFrame").find("input[name=planWorkload]").val(0==n?"":n),$("#modifyPlanFrame").find("textarea[name=securityCheckScope]").val(t.join("，"))):($("#addPlanFrame").removeData("regionData"),$("#addPlanFrame").data("userData",a),$("#addPlanFrame").find("input[name=planWorkload]").val(0==n?"":n),$("#addPlanFrame").find("textarea[name=securityCheckScope]").val(t.join("，")))}),e.$lookUserListBtn.click(function(){e._planId?($("#viewDetailFrame").modal(),choiceFrameObj._planId=e._planId,$(".areaRangeName .areaName").text(e._planNmae)):xxwsWindowObj.xxwsAlert("无详细信息")}),e.$securityPeople.click(function(){e._isEdit=!1,$("#stakeholder").modal(),e.requestPeopleTree()}),e.$securityPeopleModify.click(function(){e._isEdit=!0,$("#stakeholder").modal(),e.requestPeopleTree()}),$("#btn_selectPeople").click(function(){e.getSelectPeople()}),$(".addSubmit").click(function(){if(1==e._flag){var a=e.formVerification($(".planMainAdd"));if(0==a)return;var t={tip:"您是否确定创建计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.addPlan(a)}};xxwsWindowObj.xxwsAlert(t)}}),$(".modifySubmit").click(function(){if(1==e._flag){var a=e.formVerification($(".planMainModify"));if(0==a)return;a.objectId=e._planId;var t={tip:"您是否确定修改该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.modifyPlan(a)}};xxwsWindowObj.xxwsAlert(t)}}),e.$modifyPlanFrame.on("shown.bs.modal",function(a){e.getModifyDetails(e._planId)}),e.$planDetailsFrame.on("shown.bs.modal",function(a){2==e._planShowStatus?(e.$deletePlan.hide(),e.$closePlan.hide()):1==JSON.parse(lsObj.getLocalStorage("userBo")).isSysadmin?(e.$deletePlan.show(),e.$closePlan.show()):e._createUserId==JSON.parse(lsObj.getLocalStorage("userBo")).objectId?(e.$deletePlan.show(),e.$closePlan.show()):(e.$deletePlan.hide(),e.$closePlan.hide()),e.getPlanDetails(e._planId)}),e.$closePlan.click(function(){var a={tip:"您是否关闭该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.closedPlan(e._planId)}};return xxwsWindowObj.xxwsAlert(a),!1}),e.$deletePlan.click(function(){var a={tip:"您是否删除该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.judgePlanHas(e._planId)}};return xxwsWindowObj.xxwsAlert(a),!1}),e.$copyPlanBtn.click(function(){if(e._planId){var a={tip:"您是否复制该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.copyPlan(e._planId)}};return xxwsWindowObj.xxwsAlert(a),!1}xxwsWindowObj.xxwsAlert("未获取到计划信息，不能复制")})},getTable:function(){var e=this;$("#tablePlan").bootstrapTable({url:"/cloudlink-inspection-event/commonData/securityCheckPlan/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",toolbar:"#toolbar",toolbarAlign:"left",cache:!1,showHeader:!0,showRefresh:!0,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return searchObj.defaultObj.pageSize=e.pageSize,searchObj.defaultObj.pageNum=e.pageNumber,searchObj.defaultObj},onLoadSuccess:function(e){e.success},onDblClickRow:function(a){return e._planId=a.objectId,e._planShowStatus=a.planShowStatus,e._createUserId=a.createUserId,e.$planDetailsFrame.modal(),e.clearDetails(),!1},columns:[{field:"state",checkbox:!0,align:"center",visible:!0,sortable:!1,width:"4%"},{field:"planName",title:"计划名称",align:"center",visible:!0,sortable:!1,width:"15%",editable:!0},{field:"planStartTime",title:"起始时间",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0,cellStyle:function(e,a,t){return{css:{}}}},{field:"planEndTime",title:"结束时间",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"planShowStatusName",title:"计划状态",align:"center",visible:!0,sortable:!1,width:"7%",formatter:function(e,a,t){return"<span class='atatus_"+(parseInt(a.planShowStatus)+1)+"'>"+e+"</span>"}},{field:"planWorkload",title:"用户总数",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0},{field:"coverageWorkload",title:"覆盖数",align:"center",visible:!0,sortable:!1,width:"7%"},{field:"coverageRatio",title:"覆盖率",align:"center",visible:!0,sortable:!1,width:"7%",editable:!0,formatter:function(e,a,t){return e+"%"}},{field:"factWorkload",title:"入户数",align:"center",visible:!0,sortable:!1,width:"7%"},{field:"workloadRatio",title:"入户率",align:"center",visible:!0,sortable:!1,width:"7%",editable:!0,formatter:function(e,a,t){return e+"%"}},{field:"operate",title:"操作",align:"center",events:e.tableEvent(),width:"18%",formatter:e.tableOperation}]})},tableOperation:function(e,a,t){var n=null,i=null,o=null;return 2==a.planShowStatus?(n="modify_end",i="closed_end",o="delete_end"):1==JSON.parse(lsObj.getLocalStorage("userBo")).isSysadmin?(n="modify",i="closed",o="delete"):a.createUserId==JSON.parse(lsObj.getLocalStorage("userBo")).objectId?(n="modify",i="closed",o="delete"):(n="modify_end",i="closed_end",o="delete_end"),['<a class="look" data-toggle="modal" href="javascript:void(0)" title="查看">',"<i></i>","</a>",'<a class="range" href="javascript:void(0)" title="范围明细">',"<i></i>","</a>",'<a class="'+n+'" href="javascript:void(0)" title="修改">',"<i></i>","</a>",'<a class="'+i+'" href="javascript:void(0)" title="关闭">',"<i></i>","</a>",'<a class="clone" href="javascript:void(0)" title="复制计划">',"<i></i>","</a>",'<a class="'+o+'" href="javascript:void(0)" title="删除">',"<i></i>","</a>"].join("")},tableEvent:function(){var e=this;return{"click .look":function(a,t,n,i){return e._planId=n.objectId,e._planShowStatus=n.planShowStatus,e._createUserId=n.createUserId,e.$planDetailsFrame.modal(),e.clearDetails(),!1},"click .range":function(e,a,t,n){return $("#viewDetailFrame").modal(),choiceFrameObj._planId=t.objectId,$(".areaRangeName .areaName").text(t.planName),!1},"click .modify":function(a,t,n,i){if(0==n.planShowStatus)e._planId=n.objectId,e.clearModify(),e.$modifyPlanFrame.modal();else{var o={tip:"该计划处于【"+n.planShowStatusName+"】，如要修改安检范围，则会引起覆盖及入户相关数据的改变，是否继续修改？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e._planId=n.objectId,e.clearModify(),e.$modifyPlanFrame.modal()}};xxwsWindowObj.xxwsAlert(o)}return!1},"click .closed":function(a,t,n,i){var o={tip:"您是否关闭该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.closedPlan(n.objectId)}};return xxwsWindowObj.xxwsAlert(o),!1},"click .clone":function(a,t,n,i){var o={tip:"您是否复制该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.copyPlan(n.objectId)}};return xxwsWindowObj.xxwsAlert(o),!1},"click .delete":function(a,t,n,i){var o={tip:"您是否删除该计划？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.judgePlanHas(n.objectId)}};return xxwsWindowObj.xxwsAlert(o),!1}}},requestPeopleTree:function(){var e=this;if(e.aAllPeople)return void e.renderPeopleTree(e.aAllPeople);$.ajax({type:"GET",url:"/cloudlink-core-framework/user/getOrgUserTree?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:{token:lsObj.getLocalStorage("token"),status:1},dataType:"json",success:function(a){var t=a.rows;if(1!=a.success)return void xxwsWindowObj.xxwsAlert("获取人员信息失败！");e.aAllPeople=t,e.renderPeopleTree(e.aAllPeople)},statusCode:{404:function(){xxwsWindowObj.xxwsAlert("获取人员信息失败！")}}})},renderPeopleTree:function(e){var a=this,t={view:{showLine:!0},data:{key:{name:"treenodename"},simpleData:{enable:!0,pIdKey:"pid"}},check:{enable:!0,chkStyle:"checkbox"}};a.zTree=$.fn.zTree.init($("#people_list"),t,e),a.zTree.expandAll(!0),a.setSelectPeople()},setSelectPeople:function(){var e=this;if(e.selectPersonArr.length>0)for(var a=0;a<e.selectPersonArr.length;a++){var t=e.zTree.getNodesByParam("id",e.selectPersonArr[a].relationshipPersonId,null);e.zTree.checkNode(t[0],!0,!0)}},getSelectPeople:function(){var e=this;e.aPeopleName=[],e.selectPersonArr=[];var a=null;e.zTree.getCheckedNodes(!0).forEach(function(t,n){t.isParent||(a={relationshipPersonId:t.id,relationshipPersonName:t.treenodename},e.selectPersonArr.push(a),e.aPeopleName.push(t.treenodename))}),1==e._isEdit?e.$securityPeopleModify.val(e.aPeopleName.join("，")):e.$securityPeople.val(e.aPeopleName.join("，")),$("#stakeholder").modal("hide")},initPeopleList:function(){var e=this;e.aPeopleName=[],e.selectPersonArr=[],e.$receiveUser.val(""),e.zTree&&e.zTree.checkAllNodes(!1)},formVerification:function(e){for(var a=this,t=e.find("input[name=planName]").val().trim(),n=e.find("input[name=planWorkload]").val().trim(),i=e.find("input[name=planStartTime]").val().trim(),o=e.find("input[name=planEndTime]").val().trim(),r=(e.find("input[name=securityPeople]").val().trim(),e.find("textarea[name=securityCheckScope]").val().trim()),l=e.find("textarea[name=remark]").val().trim(),s=(JSON.parse(lsObj.getLocalStorage("userBo")).objectId,JSON.parse(lsObj.getLocalStorage("userBo")).userName,[]),c=0;c<a.selectPersonArr.length;c++)s[c]=a.selectPersonArr[c];return""==t||null==t?(xxwsWindowObj.xxwsAlert("请输入计划名称"),!1):t.length>15?(xxwsWindowObj.xxwsAlert("计划名称过长，填写上限为15个字"),!1):""==i||null==i?(xxwsWindowObj.xxwsAlert("起始时间不能为空"),!1):""==o||null==o?(xxwsWindowObj.xxwsAlert("结束时间不能为空"),!1):""==r||null==r?(xxwsWindowObj.xxwsAlert("请选择安检范围"),!1):{planName:t,planStartTime:i,planEndTime:o,planWorkload:n,securityCheckScope:r,remark:l,relationshipPersons:s}},addPlan:function(e){var a=this;a._flag=!1;var t=$("#addPlanFrame").data("regionData"),n=[];if(t){for(var i=0;i<t.length;i++){var o={regionId:t[i],residential:"",userFileIdSet:[]};n.push(o)}e.userFileIdVoSet=n}else e.userFileIdVoSet=$("#addPlanFrame").data("userData");$.ajax({type:"POST",url:"/cloudlink-inspection-event/securityCheckPlan/save?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e),dataType:"json",success:function(e){if(1==e.success){a.$addPlanFrame.modal("hide");var t={tip:"添加计划成功",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(t)}else xxwsWindowObj.xxwsAlert("添加计划失败");a.again()},error:function(){xxwsWindowObj.xxwsAlert("添加计划失败"),a.again()}})},modifyPlan:function(e){var a=this;a._flag=!1,e.userFileIdVoSet=$("#modifyPlanFrame").data("userData"),$.ajax({type:"POST",url:"/cloudlink-inspection-event/securityCheckPlan/update?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e),dataType:"json",success:function(e){if(1==e.success){a.$modifyPlanFrame.modal("hide");var t={tip:"修改计划成功",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(t)}else xxwsWindowObj.xxwsAlert("修改计划失败");a.again()},error:function(){xxwsWindowObj.xxwsAlert("修改计划失败"),a.again()}})},clearModify:function(){var e=this;$(".planMainModify").find("input").val(""),$(".planMainModify").find("textarea").val(""),$("#modifyPlanFrame").data("userData",null),e.selectPersonArr=[]},getModifyDetails:function(e){var a=this,t={objectId:e};$.ajax({type:"GET",url:"/cloudlink-inspection-event/commonData/securityCheckPlan/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:t,dataType:"json",success:function(e){if(1==e.success){$(".planMainModify").find("input[name=planName]").val(e.rows[0].planName),$(".planMainModify").find("input[name=createUserNameModify]").val(e.rows[0].createUserName),$(".planMainModify").find("input[name=planWorkload]").val(e.rows[0].planWorkload),$(".planMainModify").find("input[name=planStartTime]").val(e.rows[0].planStartTime),$(".planMainModify").find("input[name=planEndTime]").val(e.rows[0].planEndTime),a.$securityPeopleModify.val(e.rows[0].relationshipPersonNames),$(".planMainModify").find("textarea[name=securityCheckScope]").val(e.rows[0].securityCheckScope),$(".planMainModify").find("textarea[name=remark]").val(e.rows[0].remark),$("#modifyPlanFrame").data("userData",e.rows[0].userFileIdVoSet),a.selectPersonArr=[];for(var t=0;t<e.rows[0].relationshipPersons.length;t++)a.selectPersonArr.push(e.rows[0].relationshipPersons[t])}else xxwsWindowObj.xxwsAlert("获取计划失败")},error:function(){xxwsWindowObj.xxwsAlert("获取计划失败")}})},clearDetails:function(){$(".planNameT").text("---"),$(".createUserNameT").text("---"),$(".planWorkloadT").text("---"),$(".planStartTimeT").text("---"),$(".planEndTimeT").text("---"),$(".coverageRatioT").text("---"),$(".coverageWorkloadT").text("---"),$(".factWorkloadT").text("---"),$(".workloadRatioT").text("---"),$(".relationshipPersonNamesT").text("---"),$(".securityCheckScopeT").text("---"),$(".remarkT").text("---"),this.$deletePlan.hide(),this.$closePlan.hide()},getPlanDetails:function(e){var a=this,t={objectId:e};a._planId=null,$.ajax({type:"GET",url:"/cloudlink-inspection-event/commonData/securityCheckPlan/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:t,dataType:"json",success:function(e){1==e.success?(a._planId=e.rows[0].objectId,a._planNmae=e.rows[0].planName,$(".planNameT").text(e.rows[0].planName),$(".createUserNameT").text(e.rows[0].createUserName),$(".planWorkloadT").text(e.rows[0].planWorkload),$(".planStartTimeT").text(e.rows[0].planStartTime),$(".planEndTimeT").text(e.rows[0].planEndTime),$(".coverageWorkloadT").text(e.rows[0].coverageWorkload),$(".coverageRatioT").text(parseInt(""==e.rows[0].coverageRatio?0:e.rows[0].coverageRatio)+"%"),$(".factWorkloadT").text(e.rows[0].factWorkload),$(".workloadRatioT").text(parseInt(e.rows[0].workloadRatio)+"%"),$(".relationshipPersonNamesT").text(e.rows[0].relationshipPersonNames),$(".securityCheckScopeT").text(e.rows[0].securityCheckScope),$(".remarkT").text(e.rows[0].remark)):xxwsWindowObj.xxwsAlert("获取计划详情失败")},error:function(){xxwsWindowObj.xxwsAlert("获取计划详情失败")}})},closedPlan:function(e){var a={objectId:e};$.ajax({type:"POST",url:"/cloudlink-inspection-event/securityCheckPlan/finish?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(e,a){if(1==e.success){var t={tip:"安检计划关闭成功！",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(t)}else 410==e.code?xxwsWindowObj.xxwsAlert("您没有关闭计划的权限！"):xxwsWindowObj.xxwsAlert("安检计划关闭失败！")}})},judgePlanHas:function(e){var a=this,t={objectId:e};$.ajax({type:"GET",url:"/cloudlink-inspection-event/securityCheckPlan/hasCheckRecord?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:t,dataType:"json",success:function(t,n){1==t.success?0==t.rows[0].hasCheckRecord?a.deletePlan(e):xxwsWindowObj.xxwsAlert("当前计划包含安检记录数据，无法删除！"):410==t.code?xxwsWindowObj.xxwsAlert("您没有删除计划的权限！"):xxwsWindowObj.xxwsAlert("安检计划删除失败！")}})},deletePlan:function(e){var a={objectId:e};$.ajax({type:"POST",url:"/cloudlink-inspection-event/securityCheckPlan/delete?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(e,a){if(1==e.success){var t={tip:"安检计划删除成功！",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(t)}else 410==e.code?xxwsWindowObj.xxwsAlert("您没有删除计划的权限！"):xxwsWindowObj.xxwsAlert("安检计划删除失败！")}})},copyPlan:function(e){var a={objectId:e};$.ajax({type:"POST",url:"/cloudlink-inspection-event/securityCheckPlan/clone?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(e,a){if(1==e.success){var t={tip:"安检计划复制成功！",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(t)}else xxwsWindowObj.xxwsAlert("安检计划复制失败！")}})},bindPlanDate:function(){$("#planTimeStartSet").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#planTimeStartSet").datetimepicker("setEndDate",$("#planTimeEndSet").val())}),$("#planTimeEndSet").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#planTimeEndSet").datetimepicker("setStartDate",$("#planTimeStartSet").val())}),$("#planTimeStartModify").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#planTimeStartModify").datetimepicker("setEndDate",$("#planTimeEndModify").val())}),$("#planTimeEndModify").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#planTimeEndModify").datetimepicker("setStartDate",$("#planTimeStartModify").val())})},again:function(){this._flag=!0}},searchObj={$items:$(".top .item"),$searchInput:$("#searchInput"),$startDate:$("#datetimeStart"),$endDate:$("#datetimeEnd"),defaultObj:{planShowStatus:"",startDate:"",endDate:"",keywordWeb:"",pageNum:1,pageSize:10},querryObj:{planShowStatus:"",startDate:"",endDate:"",keywordWeb:"",pageNum:1,pageSize:10},activeObj:{planShowStatus:"",date:"all"},init:function(){this.renderActive(),this.bindEvent(),this.bindDateDiyEvent()},renderActive:function(e){var a=this;e||(e=a.activeObj);for(var t in e){var n=a.$items.parent("[data-class="+t+"]");n.find(".item").removeClass("active"),n.find('.item[data-value="'+e[t]+'"]').addClass("active"),"date"===t&&("diy"===e[t]?$("#item_diy").addClass("active"):$("#item_diy").removeClass("active"))}},bindEvent:function(){var e=this;e.$items.click(function(){var a=$(this).parent().attr("data-class"),t=$(this).attr("data-value");"date"===a?e.setDate(t):e.querryObj[a]=t;var n={};n[a]=t,e.renderActive(n),e.refreshTable()}),$("#gf_Btn").click(function(){var a=$(this).parent().find("input").val().trim();e.querryObj.keywordWeb=a,e.refreshTable()}),e.$searchInput.keypress(function(a){a&&13===a.keyCode&&e.refreshTable()}),$("#search_more").click(function(){$(this).hasClass("active")?($(this).removeClass("active"),$(".more_item_wrapper").slideUp()):($(this).addClass("active"),$(".more_item_wrapper").slideDown())}),$("#gf_reset_Btn").click(function(){$.extend(e.querryObj,e.defaultObj),e.$startDate.val(""),e.$endDate.val(""),e.$searchInput.val(""),$("#diyDateBtn").removeClass("active"),e.renderActive(),e.refreshTable()}),$("#diyDateBtn").on("click",function(){var a=e.$startDate.val(),t=e.$endDate.val();return a?t?(e.querryObj.startDate=a,e.querryObj.endDate=t,e.renderActive({date:"diy"}),void e.refreshTable()):void xxwsWindowObj.xxwsAlert("请选择结束时间"):void xxwsWindowObj.xxwsAlert("请选择起始时间")})},setDate:function(e){var a=this;switch(e){case"day":var t=(new Date).Format("yyyy-MM-dd");a.querryObj.startDate=t,a.querryObj.endDate=t;break;case"week":var t=new Date;a.querryObj.startDate=t.getWeekStartDate().Format("yyyy-MM-dd"),a.querryObj.endDate=t.getWeekEndDate().Format("yyyy-MM-dd");break;case"month":var t=new Date;a.querryObj.startDate=t.getMonthStartDate().Format("yyyy-MM-dd"),a.querryObj.endDate=t.getMonthEndDate().Format("yyyy-MM-dd");break;default:a.querryObj.startDate="",a.querryObj.endDate=""}},refreshTable:function(){var e=this;e.querryObj.keywordWeb=e.$searchInput.val().trim(),e.$searchInput.val(e.querryObj.keywordWeb),e.querryObj.pageNum="1",$("#tablePlan").bootstrapTable("removeAll"),$("#tablePlan").bootstrapTable("refreshOptions",{pageNumber:+e.querryObj.pageNum,pageSize:+e.querryObj.pageSize,queryParams:function(a){return e.querryObj.pageSize=a.pageSize,e.querryObj.pageNum=a.pageNumber,e.querryObj}})},bindDateDiyEvent:function(){$("#datetimeStart").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())}),$("#datetimeEnd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())})}},exportFileObj={$exportAll:$("#export_all"),$exportChoice:$("#export_choice"),expoerObj:{planShowStatus:"",startDate:"",endDate:"",keywordWeb:"",ids:[]},init:function(){var e=this;this.$exportAll.click(function(){e.expoerObj.ids=[],e.expoerCondition()}),this.$exportChoice.click(function(){var a=$("#tablePlan").bootstrapTable("getSelections");if(e.expoerObj.ids=[],0==a.length)return xxwsWindowObj.xxwsAlert("请选择你需要导出的计划！"),!1;for(var t=0;t<a.length;t++)e.expoerObj.ids.push(a[t].objectId);e.expoerCondition()})},expoerCondition:function(){var e=searchObj.querryObj;this.expoerObj.planShowStatus=e.planShowStatus,this.expoerObj.startDate=e.startDate,this.expoerObj.endDate=e.endDate,this.expoerObj.keywordWeb=e.keywordWeb,this.expoerData(this.expoerObj)},expoerData:function(e){var a={url:"/cloudlink-inspection-event/commonData/securityCheckPlan/export?token="+lsObj.getLocalStorage("token"),data:e,method:"post"};this.downLoadFile(a)},downLoadFile:function(e){var a=$.extend(!0,{method:"post"},e),t=$('<iframe id="down-file-iframe" />'),n=$('<form target="down-file-iframe" method="'+a.method+'" />');n.attr("action",a.url);for(var i in a.data)n.append('<input type="hidden" name="'+i+'" value="'+a.data[i]+'" />');t.append(n),$(document.body).append(t),n[0].submit(),t.remove()}};$(function(){$("input[type=text]").val(""),planObj.init(),searchObj.init(),exportFileObj.init(),$(document).on("show.bs.modal",".modal",function(e){var a=1040+10*$(".modal:visible").length;$(this).css("z-index",a),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",a-1).addClass("modal-stack")},0)}),$(document).on("hidden.bs.modal",".modal",function(e){$(".modal:visible").length>0&&$("body").addClass("modal-open")})});