var pipe_right_title={template:"#pipe-right-title",methods:{tabchange:function(t,e){this.$emit("tabchange",t),$(e.currentTarget).attr("class","active").siblings("li").attr("class","")}}},pipe_right_content_attribute={props:["detail"],template:"#pipe-right-content-attribute",data:function(){return{changeObj:{}}},watch:{detail:function(){$.extend(this.changeObj,this.detail),$(".attributeBtn").html("修改"),$(".right-content-attribute input").prop({disabled:!0}),$(".right-content-attribute textarea").prop({disabled:!0}),$(".left-edit-shrink").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(".rightcontent").show()}},methods:{save_attribute:function(t){"修改"==$(t.currentTarget).html()?($(t.currentTarget).html("保存"),$(".right-content-attribute input").prop({disabled:!1}),$(".right-content-attribute textarea").prop({disabled:!1})):this.verifyPipe()},lineModify:function(){var t=this,e=t.changeObj.pipeFactLength;""!=e&&null!=e||(e=null);var i={objectId:t.detail.objectId,pipeNetworkId:t.detail.pipeNetworkId,pipeLineName:t.changeObj.pipeLineName,pipeLineRemark:t.changeObj.pipeLineRemark,pipeMaterial:t.changeObj.pipeMaterial,pipeDiameter:t.changeObj.pipeDiameter,pipeThickness:t.changeObj.pipeThickness,pipeFactLength:e,pipeLength:t.detail.pipeLength};$.ajax({type:"POST",url:"/cloudlink-inspection-event/pipemapline/updateProperty?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(i),dataType:"json",success:function(e){1==e.success?xxwsWindowObj.xxwsAlert("修改管线属性成功",function(){t.$emit("savelineattribute",i.objectId,3),$(".attributeBtn").html("修改"),$(".right-content-attribute  input").prop({disabled:!0}),$(".right-content-attribute  textarea").prop({disabled:!0})}):($(".attributeBtn").html("修改"),$(".right-content-attribute  input").prop({disabled:!0}),$(".right-content-attribute  textarea").prop({disabled:!0}),xxwsWindowObj.xxwsAlert("服务异常，请稍候重试"))},error:function(){$(".attributeBtn").html("修改"),$(".right-content-attribute  input").prop({disabled:!0}),$(".right-content-attribute  textarea").prop({disabled:!0}),xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})},verifyPipe:function(){var t=/^[0-9]{1,1}\d{0,8}(\.\d{1,3})?$/;if(0==this.changeObj.pipeLineName.trim().length)return xxwsWindowObj.xxwsAlert("管线名称不能为空"),!1;if(this.changeObj.pipeLineName.trim().length>50)return xxwsWindowObj.xxwsAlert("管线名称长度不能超过50个字"),!1;if(this.changeObj.pipeMaterial.trim().length>50)return xxwsWindowObj.xxwsAlert("管线材质长度不能超过50个字"),!1;if(this.changeObj.pipeDiameter.trim().length>50)return xxwsWindowObj.xxwsAlert("管线管径长度不能超过50个字"),!1;if(this.changeObj.pipeThickness.trim().length>50)return xxwsWindowObj.xxwsAlert("管线壁厚长度不能超过50个字"),!1;if(null!=this.changeObj.pipeFactLength&&this.changeObj.pipeFactLength.trim().length>0){if(!t.test(this.changeObj.pipeFactLength.trim()))return xxwsWindowObj.xxwsAlert("管线实际长度格式不正确"),!1;this.lineModify(this.changeObj)}else{if(this.changeObj.pipeLineRemark.trim().length>200)return xxwsWindowObj.xxwsAlert("备注长度不能超过200个字"),!1;this.lineModify(this.changeObj)}}}},pipe_right_content_style={template:"#pipe-right-content-style",props:["detailstyle"],data:function(){return{lineWeight:{},lineColor:{},lineStyle:{}}},watch:{detailstyle:function(){"solid"==this.detailstyle.pipeStyle?$("select").val("1"):"dashed"==this.detailstyle.pipeStyle&&$("select").val("2"),$(".bgColorStyle").css("background-color",this.detailstyle.pipeColor),$(".borderColorStyle").css("border-color",this.detailstyle.pipeColor),$(".borderColorStyle").css("border-style",this.detailstyle.pipeStyle),$(".preview").css({height:this.detailstyle.pipeWeight,"background-color":this.detailstyle.pipeColor}),""==this.detailstyle.pipeWeight||null==this.detailstyle.pipeWeight?(this.detailstyle.pipeWeight="2",$(".preview").height("2px"),$(".scale div").css({width:"12px","background-color":this.detailstyle.pipeColor}),$("#btn").css("left","12px")):($(".scale div").css({width:6*this.detailstyle.pipeWeight,"background-color":this.detailstyle.pipeColor}),$("#btn").css("left",6*this.detailstyle.pipeWeight))}},mounted:function(){var t=this;$(".bgcolor").colorpicker({fillcolor:!0,success:function(e,i){$(".bgColorStyle").css("background",i),$(".borderColorStyle").css("border-color",i),$(".scale div").css("background-color",i),$(".preview").css("background-color",i);var n=JSON.parse(JSON.stringify(t.detailstyle));n.pipeColor=i,t.$emit("styleedit",n)}}),$(".chooseStyle").change(function(){if(1==$("select").val()){$(".borderColorStyle").css("border-style","solid");var e=JSON.parse(JSON.stringify(t.detailstyle));e.pipeStyle="solid"}else{$(".borderColorStyle").css("border-style","dashed");var e=JSON.parse(JSON.stringify(t.detailstyle));e.pipeStyle="dashed"}t.$emit("styleedit",e)});var e=function(t,e){this.btn=document.getElementById(t),this.bar=document.getElementById(e),this.fontSizeVal=document.getElementById("font_size"),this.step=this.bar.getElementsByTagName("div")[0],this.init()};e.prototype={init:function(){var t=this,e=document,i=window,n=Math;t.btn.onmousedown=function(r){var o=(r||i.event).clientX,a=this.offsetLeft,s=t.bar.offsetWidth-this.offsetWidth;e.onmousemove=function(r){var l=(r||i.event).clientX,p=n.min(s,n.max(-2,a+(l-o)));t.btn.style.left=p+"px",t.ondrag(n.round(100*n.max(0,p/s)),p),i.getSelection?i.getSelection().removeAllRanges():e.selection.empty()},e.onmouseup=new Function("this.onmousemove=null")}},ondrag:function(e,i){this.step.style.width=Math.max(0,i)+"px";var n=(e-e%5.26)/5.26+1;this.fontSizeVal.value=Math.round(n);var r=JSON.parse(JSON.stringify(t.detailstyle));r.pipeWeight=Math.round(n),t.$emit("styleedit",r)}},new e("btn","bar"),$("#font_size").on("input proprarychange",function(e){var i=$(this).val().trim(),n=i.length;if(/[\D]/g.test(i)||i>20)return void $(this).val(i.substring(0,n-1));0==i&&($(this).val("1"),i=1),$(".scale>div").width(6*i),$("#btn").attr("style","left:"+6*i+"px"),""==i||null==i?$(".preview").height(0):$(".preview").height(i);var r=JSON.parse(JSON.stringify(t.detailstyle));r.pipeWeight=i,t.$emit("styleedit",r)})}},pipe_right_content_point={template:"#pipe-right-content-point",props:["detailPointer"],data:function(){return{}},methods:{deletePointer:function(t){var e=this,i={tip:"是否确定删除坐标点？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){var i=JSON.parse(JSON.stringify(e.detailPointer));i.line.splice(t,1),e.$emit("pointedit",i)}};xxwsWindowObj.xxwsAlert(i)},pointerImport:function(){this.$emit("pointerImport")},downTemplate:function(){var t={url:"/cloudlink-inspection-event/templatedownload/excelDownload?token="+lsObj.getLocalStorage("token"),method:"post"};this.downLoadFile(t)},downLoadFile:function(t){var e=$.extend(!0,{method:"post"},t),i=$('<iframe id="down-file-iframe" />'),n=$('<form target="down-file-iframe" method="'+e.method+'" />');n.attr("action",e.url);for(var r in e.data)n.append('<input type="hidden" name="'+r+'" value="'+e.data[r]+'" />');i.append(n),$(document.body).append(i),n[0].submit(),i.remove()}}},pipenetwork_attribute={props:{details:{type:[Object,String]}},template:"#pipenetwork-attribute",data:function(){return{pipeNetworkNameL:"",pipeNetworkRemarkL:""}},watch:{details:function(){this.pipeNetworkNameL=this.details.pipeNetworkName,this.pipeNetworkRemarkL=this.details.pipeNetworkRemark,$(".attributeWorkBtn").html("修改"),$(".pipenetwork-attribute input").attr("disabled",!0),$(".pipenetwork-attribute textarea").attr("disabled",!0),$(".pipeNetworkShrink").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(".netrightcontent").show()}},methods:{save_workattribute:function(t){"修改"==$(t.currentTarget).html()?($(t.currentTarget).html("保存"),$(".pipenetwork-attribute input").prop({disabled:!1}),$(".pipenetwork-attribute textarea").prop({disabled:!1})):this.verifyNet(this.details)},worklineModify:function(t){var e=this,i={objectId:t.objectId,pipeNetworkName:e.pipeNetworkNameL,pipeNetworkRemark:e.pipeNetworkRemarkL,pipeNetworkUsed:t.pipeNetworkUsed};$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/pipemapnetwork/update?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(i),dataType:"json",success:function(t){1==t.success?xxwsWindowObj.xxwsAlert("修改管网属性成功",function(){e.$emit("saveworkattribute",i.objectId,3),$(".attributeWorkBtn").html("修改"),$(".pipenetwork-attribute input").prop({disabled:!0}),$(".pipenetwork-attribute textarea").prop({disabled:!0})}):($(".attributeWorkBtn").html("修改"),$(".pipenetwork-attribute input").prop({disabled:!0}),$(".pipenetwork-attribute textarea").prop({disabled:!0}),xxwsWindowObj.xxwsAlert("服务异常，请稍候重试"))},error:function(){$(".attributeWorkBtn").html("修改"),$(".pipenetwork-attribute input").prop({disabled:!0}),$(".pipenetwork-attribute textarea").prop({disabled:!0}),xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})},verifyNet:function(t){return 0==this.pipeNetworkNameL.trim().length?(xxwsWindowObj.xxwsAlert("管网名称不能为空"),!1):this.pipeNetworkNameL.trim().length>50?(xxwsWindowObj.xxwsAlert("管网名称长度不能超过50个字"),!1):this.pipeNetworkRemarkL.trim().length>200?(xxwsWindowObj.xxwsAlert("备注长度不能超过200个字"),!1):void this.worklineModify(t)}}},pipeline_edit={props:{linedetail:{type:[Object,String]},netdetail:{type:[Object,String]},editdetail:{type:[Object,String]}},template:"#pipeline_edit",components:{"pipe-right-title":pipe_right_title,"pipe-right-content-attribute":pipe_right_content_attribute,"pipe-right-content-style":pipe_right_content_style,"pipe-right-content-point":pipe_right_content_point,"pipenetwork-attribute":pipenetwork_attribute},computed:{linedata:function(){return""==this.editdetail?this.linedetail:this.editdetail}},data:function(){return{sCurrentTap:"attributeShow",show:!1,errorinfo:!1}},mounted:function(){$(".scrollpointer").mCustomScrollbar({theme:"minimal-dark",advanced:{updateOnContentResize:!0}})},methods:{tabchange:function(t){this.sCurrentTap=t,$(".rightcontent").show()},pipeNeLineClose:function(){var t=this;t.editdetail?xxwsWindowObj.xxwsAlert("当前管线已修改未保存,您是否放弃对当前管线的编辑?",function(){t.$emit("checkedcloseline")},!0):t.$emit("checkedcloseline")},pipeNetworkClose:function(){this.$emit("chooseclosenet")},shrink:function(t){$(".rightcontent").slideToggle(500),$(t.currentTarget).hasClass("fa-chevron-down")?$(t.currentTarget).removeClass("fa-chevron-down").addClass("fa-chevron-up"):$(t.currentTarget).addClass("fa-chevron-down").removeClass("fa-chevron-up")},networkshrink:function(){$(".netrightcontent").slideToggle(500),$(".pipeNetworkShrink").hasClass("fa-chevron-down")?$(".pipeNetworkShrink").removeClass("fa-chevron-down").addClass("fa-chevron-up"):$(".pipeNetworkShrink").addClass("fa-chevron-down").removeClass("fa-chevron-up")},pointerImport:function(){this.styleobj={title:"导入坐标",width:"800",height:"400"},this.aFooters=[{title:"上传",color:"#fff",bgcolor:"#59B6FC",disabled:!1},{title:"取消",color:"#333",bgcolor:"#fff",disabled:!1}],this.show=!0,this._flag=!0},cancel:function(){this.show=!1},close:function(){this.errorinfo=!1},browse:function(){$(".upload_picture").trigger("click")},uploadbtn:function(){this.importVerification()},importVerification:function(){var t=this,e=$(".batchImportInput").val().trim();if(""==e||null==e)return xxwsWindowObj.xxwsAlert("请选择上传的文件"),!1;var i=$(".feedback_img_file").find("input").attr("id");t.uploadFlie(i)},uploadFlie:function(t){var e=this,i=baseOperation.createuuid();1==e._flag&&(e._flag=!1,$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+i+"&bizType=excel&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:t,dataType:"json",type:"POST",async:!1,success:function(t){if(1==t.success){var i=t.rows[0].fileId;e.fileCheck(i)}else e.again(),xxwsWindowObj.xxwsAlert("校验失败，请稍后重试")},error:function(t){e.again(),xxwsWindowObj.xxwsAlert("校验失败，请稍后重试")}}))},fileCheck:function(t){var e=this,n={fileId:t};$.ajax({type:"POST",url:"/cloudlink-inspection-event/pipemapline/importValidation?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(n),dataType:"json",success:function(t,n){var r=t.rows[0].status,o=t.rows[0].total,a=t.rows[0].errors;t.rows[0].converted;if(1==t.success)if(1==r){var s=JSON.parse(JSON.stringify(e.linedetail)),l=s.objectId,p=t.rows[0].line,c=[];p.forEach(function(t,e){var i={lon:t.lon,lat:t.lat,bdLon:t.bdLon,bdLat:t.bdLat,pipeLineId:l};c.push(i)}),s.line=c,e.changelinefn(s),xxwsWindowObj.xxwsAlert("坐标点导入成功"),e.show=!1}else e.show=!1,e.pointerstyleobj={title:"坐标点规范验证",width:"600",height:"400"},e.pointeraFooters=[{title:"关闭",color:"#333",bgcolor:"#fff",disabled:!1}],e.errorinfo=!0,setTimeout(function(){$(".hintsTotal").text(o),$(".hintsNum").text(a.length);for(i in a){var e=t.rows[0].errors[i].msg.split(","),n='<li><span class="rownum listLeft">'+a[i].rowNum+'</span><span class="lon listRight">'+("null"==e[0]?"":e[0])+'</span><span class="lat listRight">'+("null"==e[1]?"":e[1])+'</span><span class="errorinfo listRight">数据类型不匹配</span></li>';$(".hintsMainList ul").append(n)}},0);else xxwsWindowObj.xxwsAlert("校验失败，请稍后重试"),e.again()},error:function(t){e.again(),xxwsWindowObj.xxwsAlert("校验失败，请稍后重试")}})},again:function(){this._flag=!0},changelinefn:function(t){this.$emit("changelinefn",t)},saveattribute:function(t,e){this.$emit("savework",t,e)},savelineattribute:function(t,e){this.$emit("saveline",t,e)}}};