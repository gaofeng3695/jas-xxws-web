var pipeline_baidumap={template:"#pipeline_baidumap",props:{linedetails:{},linedetailsedited:{},istabshow:{default:!1}},data:function(){return{sCurrentTap:""}},computed:{aLineDetailsToShow:function(){return this.linedetailsedited||(this.sCurrentTap=""),1===this.linedetails.length&&this.linedetailsedited?[this.linedetailsedited]:this.linedetails},isNoPoints:function(){return 1===this.aLineDetailsToShow.length&&0===this.aLineDetailsToShow[0].line.length},isEditable:function(){return"edit"===this.sCurrentTap},isDrawable:function(){return"draw"===this.sCurrentTap}},watch:{sCurrentTap:function(e){this._draw_lines(),"save"===e&&this.$emit("savedetail")},aLineDetailsToShow:function(){this._draw_lines()}},mounted:function(){this.mapObj=createMap({sNodeId:"mapContainer"}),this._addDrawLineEvent(this.mapObj.map),this._draw_lines()},methods:{changeTab:function(e){this.sCurrentTap===e?this.sCurrentTap="":this.sCurrentTap=e},_draw_lines:function(){var e=this,i=this.mapObj,t=this.aLineDetailsToShow;if(i.clearOverlays(),e.isDrawable?(i.map.setDefaultCursor("crosshair"),i.map.setDraggingCursor("crosshair")):(i.map.setDefaultCursor(e.defaultCursor),i.map.setDraggingCursor(e.draggingCursor)),t&&0!==t.length){e.topline="";var n=[];t.forEach(function(a,r){if(a.line&&0!==a.line.length){if(e.linedetailsedited){var l=(i.getDistance(a.line)/1e3).toFixed(3);if(l!==a.pipeLength){var s=JSON.parse(JSON.stringify(e.aLineDetailsToShow[0]));return s.pipeLength=l,void e.$emit("changeline",s)}}if(1===t.length){if(a.line.length>0){i.draw_pointMarker(a.line[0].bdLon,a.line[0].bdLat,i.startMarker)}if(a.line.length>1){i.draw_pointMarker(a.line[a.line.length-1].bdLon,a.line[a.line.length-1].bdLat,i.endMarker)}}if(a.line.length>1){var o=i.draw_line(a.line,{strokeColor:a.pipeColor,strokeWeight:a.pipeWeight,strokeStyle:a.pipeStyle,strokeOpacity:1,enableEditing:e.isEditable||!1});(e.isEditable||e.isDrawable)&&0===r&&(e.topline=o,e.topline.addEventListener("lineupdate",function(){var t=e.topline.getPath(),n=0,a=t.map(function(e,t,a){return t>0&&(n+=i.map.getDistance(new BMap.Point(a[t-1].lng,a[t-1].lat),new BMap.Point(e.lng,e.lat))),{lon:"",lat:"",bdLon:e.lng,bdLat:e.lat,rowIndex:t}}),r=JSON.parse(JSON.stringify(e.aLineDetailsToShow[0]));r.line=a,r.pipeLength=(n/1e3).toFixed(3),e.$emit("changeline",r)}))}e.isEditable||e.isDrawable||(n=n.concat(a.line.map(function(e){return new BMap.Point(e.bdLon,e.bdLat)})))}}),i.map.setViewport(n,{enableAnimation:!0,margins:[0,0,0,0]})}},_addDrawLineEvent:function(e){var i=this;this.defaultCursor=e.getDefaultCursor(),this.draggingCursor=e.getDraggingCursor(),e.addEventListener("click",function(e){if(i.isDrawable){var t=e.point.lng,n=e.point.lat,a=new BMap.Point(e.point.lng,e.point.lat),r=i.aLineDetailsToShow[0].line;if(i.topline)i.topline.setPath(i.topline.getPath().concat([a]));else{if(0===r.length)var l=[{lon:"",lat:"",bdLon:t,bdLat:n,rowIndex:1}];else if(1===r.length)var l=r.concat([{lon:"",lat:"",bdLon:t,bdLat:n,rowIndex:2}]);var s=JSON.parse(JSON.stringify(i.aLineDetailsToShow[0]));s.line=l,i.$emit("changeline",s)}}}),e.addEventListener("mousemove",function(e){if(i.isDrawable){i.dashLineDrawed&&i.mapObj.map.removeOverlay(i.dashLineDrawed);var t=i.aLineDetailsToShow[0].line;if(0!==t.length){var n=new BMap.Point(t[t.length-1].bdLon,t[t.length-1].bdLat),a=e.point.lng,r=e.point.lat,l=new BMap.Point(a,r);i.dashLineDrawed=i.mapObj.draw_line([n,l],{strokeColor:i.aLineDetailsToShow[0].pipeColor||"blue",strokeWeight:i.aLineDetailsToShow[0].pipeWeight||2,strokeOpacity:.5,strokeStyle:"dashed"},!0)}}}),e.addEventListener("rightclick",function(e){(i.isEditable||i.isDrawable)&&(i.sCurrentTap="",i.dashLineDrawed&&i.mapObj.map.removeOverlay(i.dashLineDrawed))})}}};