window.onerror=function(e,t,i){return alert("erro"+e+"\n"+t+":"+i),!0};var util={updateArrayById:function(e,t,i){for(var n=0;n<e.length;n++)if(e[n].objectId===t){e[n]=i;break}return[].concat(e)},findItemInArrayById:function(e,t){if(!e&&0===e.length)return"";for(var i=0;i<e.length;i++)if(e[i].objectId===t)return e[i];return""}},vm=new Vue({el:"#app",data:{sNetId_choosed:"",sLineId_choosed:"",olineDetail_edited:"",isLineList_entered:!1,aNetDetails:[],aLineDetails:[]},computed:{aNetId_active:function(){return this.aNetDetails.filter(function(e){return 1==+e.pipeNetworkUsed})},oNetDetail_choosed:function(){var e=this;return this.sNetId_choosed&&!this.isLineList_entered?util.findItemInArrayById(this.aNetDetails,e.sNetId_choosed):""},oLineDetail_choosed:function(){var e=this;return this.sLineId_choosed?util.findItemInArrayById(this.aLineDetails,e.sLineId_choosed):""},aLineDetailsToShow:function(){var e=this;return e.sNetId_choosed&&!e.sLineId_choosed?e.aLineDetails.filter(function(t){return t.pipeNetworkId===e.sNetId_choosed}):e.sLineId_choosed?e.aLineDetails.filter(function(t){return t.objectId===e.sLineId_choosed}):e.aLineDetails.filter(function(t){for(var i=0;i<e.aNetId_active.length;i++)if(e.aNetId_active[i].objectId===t.pipeNetworkId)return!0;return!1})}},watch:{sLineId_choosed:function(){this.olineDetail_edited=""}},components:{"pipe-left":pipe_left,"pipeline-baidumap":pipeline_baidumap,"pipeline-edit":pipeline_edit},mounted:function(){console.log("#app mounted"),this._requestNetDetails()},methods:{_requestNetDetails:function(){var e=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/pipemapnetwork/getPageList?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify({pageNum:1,pageSize:1e3}),dataType:"json",success:function(t){1==t.success?(e.aNetDetails=t.rows,e._requestLineDetails()):xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})},_requestLineDetails:function(){var e=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/pipemaplinedetail/getPageList?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify({pageNum:1,pageSize:1e3}),dataType:"json",success:function(t){1==t.success?e.aLineDetails=t.rows:xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})},chooseNet:function(e){this.sNetId_choosed=e||""},chooseLine:function(e){this.sLineId_choosed=e||""},enterLineList:function(e){this.isLineList_entered=!!e},updateNetDetailById:function(e,t){var i=this;switch(t){case 1:i._getNetDetailById(e,1);break;case 2:i.aNetDetails=i.aNetDetails.filter(function(t){return t.objectId!=e}),i.aLineDetails=i.aLineDetails.filter(function(t){return t.pipeNetworkId!=e});break;case 3:i._getNetDetailById(e,3)}},_getNetDetailById:function(e,t){var i=this;$.ajax({type:"GET",url:"/cloudlink-inspection-event/commonData/pipemapnetwork/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:{objectId:e},dataType:"json",success:function(n){1==n.success?1==t?i.aNetDetails.unshift(n.rows[0]):i.aNetDetails=util.updateArrayById(i.aNetDetails,e,n.rows[0]):xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})},updateLineDetailById:function(e,t){var i=this;switch(t){case 1:i._getLineDetailById(e,1);break;case 2:i.aLineDetails=i.aLineDetails.filter(function(t){return t.objectId!=e}),i.updateNetDetailById(i.sNetId_choosed,3);break;case 3:i._getLineDetailById(e,3)}},_getLineDetailById:function(e,t){var i=this;$.ajax({type:"GET",url:"/cloudlink-inspection-event/commonData/pipemapline/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:{objectId:e},dataType:"json",success:function(n){1==n.success?(1==t?i.aLineDetails.unshift(n.rows[0]):(console.log(n.rows[0]),console.log(i.aLineDetails),i.aLineDetails=util.updateArrayById(i.aLineDetails,e,n.rows[0])),i.updateNetDetailById(i.sNetId_choosed,3)):xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})},editLineDetail:function(e){console.log("管线的坐标或者样式发生改变"),this.olineDetail_edited=e},saveLineStyleAndPoint:function(){console.log("——————————开始保存修改的管线数据数据");var e=this,t=JSON.parse(JSON.stringify(this.olineDetail_edited));delete t.createTime,delete t.createUserId,delete t.createUserName;var i=t.objectId;$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/pipemapline/update?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){1==t.success?(e.updateLineDetailById(i,3),e.olineDetail_edited=""):xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})}}});