var phoneObj={$back:$(".back"),$one:$(".stepOneBtn"),$two:$(".stepTwoBtn"),$three:$(".stepThreeBtn"),_flag:!0,_code:null,_messageFlag:!0,init:function(){var e=this;e.code(),e.$back.click(function(){var e={tip:"您是否确定取消修改手机号？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){window.history.back()}};xxwsWindowObj.xxwsAlert(e)}),e.$one.click(function(){1==e._flag&&e.verificationPassword()}),e.$two.click(function(){1==e._flag&&e.verificationForm()}),e.$three.click(function(){e.signOut()}),$(".suspension_pic").click(function(){e.code()}),$(".suspension_message").click(function(){1==e._messageFlag&&e.message()})},verificationPassword:function(){var e=this,t=$("input[name='password']").val().trim();if(""==t)return void $(".passwordT").text("请输入密码").show();$(".passwordT").text("").hide(),e._flag=!1;var s={userId:JSON.parse(lsObj.getLocalStorage("userBo")).objectId,mobileNum:JSON.parse(lsObj.getLocalStorage("userBo")).mobileNum,password:t};$.ajax({type:"GET",url:"/cloudlink-core-framework/user/checkPassword?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:s,dataType:"json",success:function(t){1==t.success?(1==t.rows[0].booleanResult?($(".modifyTitle").find("span").attr("class","step2"),$(".stepOne").hide(),$(".stepTwo").show()):$(".passwordT").text("密码错误").show(),e.again()):("PU03013"==t.code&&xxwsWindowObj.xxwsAlert("登录超时，请重新登录！"),e.again())}})},code:function(){var e=["q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m","0","1","2","3","4","5","6","7","8","9","Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","Z","X","C","V","B","N","M"],t=parseInt(1e4*Math.random()%62),s=parseInt(1e4*Math.random()%62),a=parseInt(1e4*Math.random()%62),o=parseInt(1e4*Math.random()%62);this._code=e[o]+e[t]+e[s]+e[a],$(".suspension_pic i").text(this._code)},message:function(){var e=this,t=e.verificationTel();if(0!=t){e._messageFlag=!1;var s=60;$(".suspension_message").text("60秒后再次获取").addClass("messageAgain");var a=setInterval(function(){s--,$(".suspension_message").text(s+"秒后再次获取").addClass("messageAgain"),s<1&&(clearInterval(a),$(".suspension_message").text("重新获取").removeClass("messageAgain"),e._messageFlag=!0)},1e3),o={sendNum:t,sendMode:1,useMode:3};$.ajax({url:"/cloudlink-core-framework/login/getVerifyCode?token="+lsObj.getLocalStorage("token"),type:"GET",contentType:"application/json",dataType:"json",data:o,success:function(e){}})}},verificationTel:function(){$(".picCodeT").text("").hide(),$(".messageCodeT").text("").hide();var e=$("input[name='tel']").val().trim(),t=/^1\d{10}$/;return""==e?($(".telT").text("请输入手机号").show(),!1):t.test(e)?($(".telT").text("").hide(),e):($(".telT").text("手机号码错误").show(),!1)},verificationForm:function(){var e=this,t=e.verificationTel(),s=$("input[name='picCode']").val().trim(),a=new RegExp("^"+e._code+"$","gi"),o=$("input[name='messageCode']").val().trim();if(0!=t){if(""==s)return $(".messageCodeT").text("").hide(),void $(".picCodeT").text("请输入图片验证").show();if(0==a.test(s))return $(".messageCodeT").text("").hide(),void $(".picCodeT").text("图片验证错误").show();if(""==o)return $(".picCodeT").text("").hide(),void $(".messageCodeT").text("请输入短信验证").show();$(".picCodeT").text("").hide(),$(".messageCodeT").text("").hide(),e._flag=!1;var n={sendNum:t,sendMode:1,verifyCode:o};$.ajax({url:"/cloudlink-core-framework/login/checkVerifyCode?token="+lsObj.getLocalStorage("token"),type:"GET",contentType:"application/json",dataType:"json",data:n,success:function(s){if(1!=s.success)return $(".messageCodeT").text("验证失败").show(),void e.again();e.updatePhone(t)}})}},updatePhone:function(e){var t=this,s={objectId:JSON.parse(lsObj.getLocalStorage("userBo")).objectId,mobileNum:e};$.ajax({url:"/cloudlink-core-framework/user/update?token="+lsObj.getLocalStorage("token"),type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(s),success:function(e){if(1==e.success){$(".modifyTitle").find("span").attr("class","step3"),$(".stepTwo").hide(),$(".stepThree").show();var s=5;$(".backTime").text(s);var a=setInterval(function(){s--,$(".backTime").text(s),s<1&&(clearInterval(a),t.signOut())},1e3)}else"该手机号码已经注册过"==e.msg?xxwsWindowObj.xxwsAlert("新手机号已经被注册，无法修改"):xxwsWindowObj.xxwsAlert("修改手机号失败");t.again()}})},signOut:function(){lsObj.clearAll(),top.location.href="../../login.html"},again:function(){this._flag=!0}};$(function(){phoneObj.init()});