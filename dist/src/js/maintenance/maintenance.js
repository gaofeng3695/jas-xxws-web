function dateChangeForSearch(){var e=$("#datetimeStart").val(),t=$("#datetimeEnd").val();""!=e&&""!==t?$("#diyDateBtn").addClass("active"):$("#diyDateBtn").removeClass("active")}function checkLen(e){var t=$(e).val().length;t>199&&$(e).val($(e).val().substring(0,200));var a=200-t;a<0&&(a=0),$(e).next(".text_num").text("("+a+"字)")}var searchObj={$items:$(".top .item"),$searchInput:$("#searchInput"),$startDate:$("#datetimeStart"),$endDate:$("#datetimeEnd"),defaultObj:{status:"",startDate:"",endDate:"",keywordWeb:"",originTypeCode:"",ids:[],pageNum:1,pageSize:10},querryObj:{status:"",startDate:"",endDate:"",keywordWeb:"",originTypeCode:"",ids:[],pageNum:1,pageSize:10},activeObj:{status:"",originTypeCode:"",date:"all"},init:function(){this.bindEvent(),this.renderActive(),this.bindDateDiyEvent()},renderActive:function(e){var t=this;e||(e=t.activeObj);for(var a in e){var i=t.$items.parent("[data-class="+a+"]");i.find(".item").removeClass("active"),i.find('.item[data-value="'+e[a]+'"]').addClass("active"),"date"===a&&("diy"===e[a]?$("#item_diy").addClass("active"):$("#item_diy").removeClass("active"))}},bindEvent:function(){var e=this;e.$items.click(function(){var t=$(this).parent().attr("data-class"),a=$(this).attr("data-value");"date"===t?e.setDate(a):e.querryObj[t]=a;var i={};i[t]=a,e.renderActive(i),e.refreshTable()}),$("#gf_Btn").click(function(){var t=$(this).parent().find("input").val().trim();e.querryObj.keywordWeb=t,e.refreshTable()}),e.$searchInput.keypress(function(t){t&&13===t.keyCode&&e.refreshTable()}),$("#search_more").click(function(){$(this).hasClass("active")?($(this).removeClass("active"),$(".more_item_wrapper").slideUp()):($(this).addClass("active"),$(".more_item_wrapper").slideDown())}),$("#gf_reset_Btn").click(function(){$.extend(e.querryObj,e.defaultObj),e.$startDate.val(""),e.$endDate.val(""),e.$searchInput.val(""),$("#diyDateBtn").removeClass("active"),e.renderActive(),e.refreshTable()}),$("#diyDateBtn").on("click",function(){var t=e.$startDate.val(),a=e.$endDate.val();return t?a?(e.querryObj.startDate=t,e.querryObj.endDate=a,e.renderActive({date:"diy"}),void e.refreshTable()):void xxwsWindowObj.xxwsAlert("请选择结束时间"):void xxwsWindowObj.xxwsAlert("请选择起始时间")})},setDate:function(e){var t=this;switch(e){case"week":var a=new Date;t.querryObj.startDate=a.Format("yyyy-MM-dd"),t.querryObj.endDate=t.GetDateStr(7);break;case"harfMonth":var a=new Date;t.querryObj.startDate=a.Format("yyyy-MM-dd"),t.querryObj.endDate=t.GetDateStr(15);break;case"month":var a=new Date;t.querryObj.startDate=a.Format("yyyy-MM-dd"),t.querryObj.endDate=t.GetDateStr(30);break;default:t.querryObj.startDate="",t.querryObj.endDate=""}},refreshTable:function(){var e=this;e.querryObj.keywordWeb=e.$searchInput.val().trim(),e.$searchInput.val(e.querryObj.keywordWeb),e.querryObj.pageNum="1",$("#workList").bootstrapTable("removeAll"),$("#workList").bootstrapTable("refreshOptions",{pageNumber:+e.querryObj.pageNum,pageSize:+e.querryObj.pageSize,queryParams:function(t){return e.querryObj.pageSize=t.pageSize,e.querryObj.pageNum=t.pageNumber,e.querryObj}})},bindDateDiyEvent:function(){$("#datetimeStart").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())}),$("#datetimeEnd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())}),$(".time-limit").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,startDate:new Date})},GetDateStr:function(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate();return i<10&&(i="0"+i),r<10&&(r="0"+r),a+"-"+i+"-"+r}},addressSearchObj={$items:$(".ChoiceTop .item"),$addressSearchInput:$("#addressSearchInput"),defaultObj:{regionId:"",residential:"",enterhomeUserTypeCode:"",userStatusCode:"",keyword:"",pageNum:1,pageSize:10},querryObj:{regionId:"",residential:"",enterhomeUserTypeCode:"",userStatusCode:"",keyword:"",pageNum:1,pageSize:10},activeObj:{enterhomeUserTypeCode:"",userStatusCode:""},init:function(){this.renderActive(),this.bindEvent()},renderActive:function(e){var t=this;e||(e=t.activeObj);for(var a in e){var i=t.$items.parent("[data-class="+a+"]");i.find(".item").removeClass("active"),i.find('.item[data-value="'+e[a]+'"]').addClass("active")}},bindEvent:function(){var e=this;e.$items.click(function(){var t=$(this).parent().attr("data-class"),a=$(this).attr("data-value");e.querryObj[t]=a;var i={};i[t]=a,e.renderActive(i),e.refreshTable()}),$("select[name=areaList]").change(function(){$("select[name=quartersList]").html('<option value="">全部（小区/院/村）</option>'),e.querryObj.regionId=$(this).val(),e.querryObj.residential="",e.refreshTable()}),$("#address_gf_Btn").click(function(){var t=$(this).parent().find("input").val().trim();e.querryObj.keyword=t,e.refreshTable()}),e.$addressSearchInput.keypress(function(t){t&&13===t.keyCode&&e.refreshTable()}),$("#address_reset_Btn").click(function(){e.emptySelect(),e.refreshTable()})},refreshTable:function(){var e=this;e.querryObj.keyword=e.$addressSearchInput.val().trim(),e.$addressSearchInput.val(e.querryObj.keyword),e.querryObj.pageNum="1",$("#userList").bootstrapTable("removeAll"),$("#userList").bootstrapTable("refreshOptions",{pageNumber:+e.querryObj.pageNum,pageSize:+e.querryObj.pageSize,queryParams:function(t){return e.querryObj.pageSize=t.pageSize,e.querryObj.pageNum=t.pageNumber,e.querryObj}})},emptySelect:function(){$.extend(this.querryObj,this.defaultObj),$("select[name=areaList]").val(""),this.$addressSearchInput.val(""),this.renderActive()}},facilitySearchObj={$items:$(".facilityTop .item"),$facilitySearchInput:$("#facilitySearchInput"),defaultObj:{pipelineTypeCode:"",facilityTypeCodeList:[],keyword:"",pageNum:1,pageSize:10},querryObj:{pipelineTypeCode:"",facilityTypeCodeList:[],keyword:"",pageNum:1,pageSize:10},activeObj:{pipelineTypeCode:"",facilityTypeCodeList:""},init:function(){this.renderActive(),this.bindEvent()},renderActive:function(e){var t=this;e||(e=t.activeObj);for(var a in e){var i=t.$items.parent("[data-class="+a+"]");i.find(".item").removeClass("active"),i.find('.item[data-value="'+e[a]+'"]').addClass("active")}},bindEvent:function(){var e=this;e.$items.click(function(){var t=$(this).parent().attr("data-class"),a=$(this).attr("data-value");e.querryObj[t]="facilityTypeCodeList"==t?""==a?[]:[a]:a;var i={};i[t]=a,e.renderActive(i),e.refreshTable()}),$("#facility_gf_Btn").click(function(){var t=$(this).parent().find("input").val().trim();e.querryObj.keyword=t,e.refreshTable()}),e.$facilitySearchInput.keypress(function(t){t&&13===t.keyCode&&e.refreshTable()}),$("#facility_reset_Btn").click(function(){e.emptySelect(),e.refreshTable()})},refreshTable:function(){var e=this;e.querryObj.keyword=e.$facilitySearchInput.val().trim(),e.$facilitySearchInput.val(e.querryObj.keyword),e.querryObj.pageNum="1",$("#facilityList").bootstrapTable("removeAll"),$("#facilityList").bootstrapTable("refreshOptions",{pageNumber:+e.querryObj.pageNum,pageSize:+e.querryObj.pageSize,queryParams:function(t){return e.querryObj.pageSize=t.pageSize,e.querryObj.pageNum=t.pageNumber,e.querryObj}})},emptySelect:function(){$.extend(this.querryObj,this.defaultObj),this.$facilitySearchInput.val(""),this.renderActive()}},eventSearchObj={queryObj:{keyword:"",type:"",date:"all",startDate:"",endDate:"",pageNum:1,pageSize:10,iscustorm:"1"},init:function(){this.requestEventType()},requestEventType:function(){var e=this,t={};$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/eventType/getList?token="+lsObj.getLocalStorage("token"),data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(t){if(1==t.success){e.foramtEventType(t.rows);var a=e.createSearchTemplateObj(e.aActiveData,e.hisData);e.searchInst=createSearhTemplate(a),e.hisData.length>0&&(e.bindEvent(),e.renderEventTypeTree(e.hisData))}else xxwsWindowObj.xxwsAlert("获取事件类型失败！")}})},foramtEventType:function(e){var t={};e.forEach(function(e){0==+e.parentId&&(t[e.objectId]={typeName:e.typeName,nodeType:e.nodeType,indexNum:e.indexNum,active:e.active,aHisData:[],aActiveData:[]})}),e.forEach(function(e){0!=+e.parentId&&(0==+e.active?t[e.parentId].aHisData.push({isParent:!1,treenodename:e.typeName,pid:e.parentId,id:e.objectId}):t[e.parentId].aActiveData.push({name:e.typeName,value:e.objectId}))}),this._formatTypeDataForActiveAndHis(t)},_formatTypeDataForActiveAndHis:function(e){var t=this,a=[],i=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(n.aHisData.length>0&&1!=+n.nodeType&&([].push.apply(a,n.aHisData),a.push({isParent:!0,treenodename:n.typeName,pid:"",id:r})),1==+n.nodeType&&0==+n.active&&a.push({isParent:!1,treenodename:n.typeName,pid:"",id:r}),n.aActiveData.length>0){var s=n.aActiveData.map(function(e){return e.value}).join(","),o=n.aActiveData.length>1?[{name:"全部",value:s}].concat(n.aActiveData):n.aActiveData;i[n.indexNum]={name:n.typeName,value:r,subValue:s,children:o}}1==+n.nodeType&&1==+n.active&&(i[n.indexNum]={name:n.typeName,value:r})}t.hisData=a,t.aActiveData=i.filter(function(e){return e})},_initSearcEventType:function(e,t){var a=[{name:"全部",value:""}].concat(e);return a.push(t.length>0&&['<span class="fl history">','<span class="fl itemHisData">历史类型：</span>','<span class="peo_wrapper" data-class="userIds">','<span class="peo_border">','<input id="hisTypeInput" class="peo_selected" readonly>','<span class="mybtn"></span>',"</span>",'<span id="clear_type" class="clear">清空</span>',"</span>","</span>"].join("")),a},createSearchTemplateObj:function(e,t){var a=this;return{wrapper:"#search_wrapper",topItem:{widthRate:[0,12,0],data:["date"]},itemArr:[{title:{name:"事件类型",value:"type"},items:a._initSearcEventType(e,t)},"date"],cbRender:function(){$(".itemHisData").removeClass("active")},queryObj:this.queryObj,callback:function(e){a.refreshTable()}}},refreshTable:function(){var e=this;e.queryObj.pageNum="1",$("#eventList").bootstrapTable("refreshOptions",{pageNumber:+e.queryObj.pageNum,pageSize:+e.queryObj.pageSize,queryParams:function(t){return e.queryObj.pageSize=t.pageSize,e.queryObj.pageNum=t.pageNumber,e.queryObj}})},bindEvent:function(){var e=this;$("body").on("click",".peo_border",function(){$("#hisData").modal()}),$("body").on("click","#btn_hisData",function(){if(e._setSelectedItems(),$(".item2_id").hide(),$("#hisTypeInput").val(e.aTypeName.join("，")),$("#hisData").modal("hide"),!e.aTypeId||0===e.aTypeId.length)return void $("#clear_type").trigger("click");$(".itemHisData").addClass("active"),$('div[data-class="type"]').find(".item").removeClass("active"),e.queryObj.type=e.aTypeId.join(","),e.searchInst.callback()}),$("body").on("click","#clear_type",function(){e._clearHisActive(),e.queryObj.type="",e.searchInst.renderActive({type:""}),e.searchInst.callback()}),$("body").on("click",".search_reset",function(){e._clearHisActive()})},renderEventTypeTree:function(e){var t=this,a={view:{showLine:!0,showIcon:!1},data:{key:{name:"treenodename"},simpleData:{enable:!0,pIdKey:"pid"}},check:{enable:!0,chkStyle:"checkbox"}};t.zTree=$.fn.zTree.init($("#eventType_list"),a,e),t.zTree.expandAll(!0)},_setSelectedItems:function(){var e=this;e.aTypeId=[],e.aTypeName=[],e.zTree.getCheckedNodes(!0).forEach(function(t,a){t.isParent||(e.aTypeId.push(t.id),e.aTypeName.push(t.treenodename))})},_clearHisActive:function(){var e=this;e.aTypeId=null,e.aTypeName=null,$("#hisTypeInput").val(""),$(".itemHisData").removeClass("active"),e.zTree.checkAllNodes(!1)}},userTable={_flag:!0,_againArea:null,_selectPeople:[],_isModify:null,init:function(){var e=this;e.getTable(),e.getAdress(),e.getFacility(),e.getEvent(),$(".selectUserBtn").click(function(){e.getSelectAdress()}),$(".selectPeopleBtn").click(function(){e.getSelectPeople()}),$(".selectFacilityBtn").click(function(){e.getSelectFacility()}),$(".selectEventBtn").click(function(){e.getSelectEvent()})},getTable:function(){var e=this;$("#workList").bootstrapTable({url:"/cloudlink-inspection-event/commonData/maintenanceWork/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",toolbar:"#toolbar",toolbarAlign:"left",cache:!1,showHeader:!0,showRefresh:!0,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return searchObj.defaultObj.pageSize=e.pageSize,searchObj.defaultObj.pageNum=e.pageNumber,searchObj.defaultObj},onLoadSuccess:function(e){},onDblClickRow:function(e){return repairObj.openDetailsFrame(e.objectId,e.originTypeCode),!1},columns:[{field:"state",checkbox:!0,align:"center",visible:!0,sortable:!1,width:"4%"},{field:"maintenanceCode",title:"维修编号",align:"center",visible:!0,sortable:!1,width:"12%",editable:!0},{field:"originTypeName",title:"维修来源",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0},{field:"status",title:"维修状态",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0,formatter:function(e,t,a){if(1==e){var i="待维修";return"<span class='atatus_"+(parseInt(t.status)+1)+"'>"+i+"</span>"}if(2==e){var i="已完成";return"<span class='atatus_"+(parseInt(t.status)+1)+"'>"+i+"</span>"}return""}},{field:"remediationTime",title:"维修期限",align:"center",visible:!0,sortable:!1,width:"10%"},{field:"relationshipPersonNames",title:"维修人",align:"center",visible:!0,sortable:!1,width:"15%",editable:!0,formatter:function(e,t,a){return"<span class='atatus_people' title='"+e+"'>"+e+"</span>"}},{field:"createUserName",title:"创建人",align:"center",visible:!0,sortable:!1,width:"8%"},{field:"address",title:"地址",align:"center",visible:!0,sortable:!1,width:"22%",editable:!0},{field:"operate",title:"操作",align:"center",events:e.tableEvent(),width:"13%",formatter:e.tableOperation}]})},tableOperation:function(e,t,a){var i=null;return i=2==t.status?"modify_end":"modify",['<a class="look" href="javascript:void(0)" title="查看">',"<i></i>","</a>",'<a class="'+i+'" href="javascript:void(0)" title="修改">',"<i></i>","</a>",'<a class="export" href="javascript:void(0)" title="导出详情">',"<i></i>","</a>"].join("")},tableEvent:function(){return{"click .look":function(e,t,a,i){repairObj.openDetailsFrame(a.objectId,a.originTypeCode)},"click .modify":function(e,t,a,i){repairObj.openDetailsFrame(a.objectId,a.originTypeCode,!0)},"click .export":function(e,t,a,i){exportObj.exportDetails(a.objectId)}}},renderPeopleTree:function(e){var t=this,a={view:{showLine:!0},data:{key:{name:"treenodename"},simpleData:{enable:!0,pIdKey:"pid"}},check:{enable:!0,chkStyle:"checkbox"}};t.zTree=$.fn.zTree.init($("#people_list"),a,e),t.zTree.expandAll(!0),t.setSelectPeople()},requestPeopleTree:function(){var e=this;if(e.aAllPeople)return void e.renderPeopleTree(e.aAllPeople);$.ajax({type:"GET",url:"/cloudlink-core-framework/user/getOrgUserTree?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:{token:lsObj.getLocalStorage("token"),status:1},dataType:"json",success:function(t){var a=t.rows;if(1!=t.success)return void xxwsWindowObj.xxwsAlert("获取人员信息失败！");e.aAllPeople=a,e.renderPeopleTree(e.aAllPeople)},statusCode:{404:function(){xxwsWindowObj.xxwsAlert("获取人员信息失败！")}}})},setSelectPeople:function(){var e=this;if(e._selectPeople.length>0)for(var t=0;t<e._selectPeople.length;t++){var a=e.zTree.getNodesByParam("id",e._selectPeople[t].relationshipPersonId,null);e.zTree.checkNode(a[0],!0,!0)}},getSelectPeople:function(){var e=this;e.aPeopleName=[],e._selectPeople=[];var t=null;e.zTree.getCheckedNodes(!0).forEach(function(a,i){a.isParent||(t={relationshipPersonId:a.id,relationshipPersonName:a.treenodename},e._selectPeople.push(t),e.aPeopleName.push(a.treenodename))}),e._isModify?detailsV.getSelectPerson(e._selectPeople,e.aPeopleName.join("，")):createmaintenance.selectPeople=e.aPeopleName.join("，"),$("#chooseRepairer").modal("hide")},getAdress:function(){$("#userList").bootstrapTable({url:"/cloudlink-inspection-event/commonData/userArchive/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",cache:!1,showHeader:!0,showRefresh:!1,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return addressSearchObj.defaultObj.pageSize=e.pageSize,addressSearchObj.defaultObj.pageNum=e.pageNumber,addressSearchObj.defaultObj},onClickRow:function(e,t){$("#userList").bootstrapTable("check",t.index())},columns:[{field:"state",radio:!0,align:"center",visible:!0,sortable:!1,width:"6%"},{field:"userFileName",title:"用户名称",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"userFileCode",title:"用户编号",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"enterhomeUserTypeName",title:"用户类型",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"userStatusName",title:"用户状态",align:"center",visible:!0,sortable:!1,width:"10%"},{field:"regionName",title:"所属片区",align:"center",visible:!0,sortable:!1,width:"12%",editable:!0},{field:"residential",title:"小区/院/村",align:"center",visible:!0,sortable:!1,width:"12%"},{field:"address",title:"详细地址",align:"center",visible:!0,sortable:!1,width:"30%",editable:!0}]})},getAreaList:function(){var e=this;if(!e._againArea){var t={keyword:"",pageNum:1,pageSize:1e4};$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/region/getPageList?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){if(1==t.success){e._againArea=!0;var a=t.rows,i=null;i='<option value="">全部（片区）</option>';for(var r=0;r<a.length;r++)i+='<option value="'+a[r].objectId+'">'+a[r].regionName+"</option>";i+='<option value="none">无</option>',$("select[name=areaList]").html(i)}}})}},getSelectAdress:function(){var e=$("#userList").bootstrapTable("getSelections");e.length>0&&createmaintenance.determine(e[0].objectId,e[0].address,e[0].userFileName,e[0].contactPhone),$("#choiceUserFrame").modal("hide")},getFacility:function(){$("#facilityList").bootstrapTable({url:"/cloudlink-inspection-event/facility/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",cache:!1,showHeader:!0,showRefresh:!1,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return facilitySearchObj.defaultObj.pageSize=e.pageSize,facilitySearchObj.defaultObj.pageNum=e.pageNumber,facilitySearchObj.defaultObj},onClickRow:function(e,t){$("#facilityList").bootstrapTable("check",t.index())},columns:[{field:"state",radio:!0,align:"center",visible:!0,sortable:!1,width:"6%"},{field:"facilityName",title:"设施名称",align:"center",visible:!0,sortable:!1,width:"12%",editable:!0},{field:"facilityCode",title:"设施编号",align:"center",visible:!0,sortable:!1,width:"12%",editable:!0},{field:"facilityTypeName",title:"设施类型",align:"center",visible:!0,sortable:!1,width:"12%",editable:!0},{field:"pipelineTypeName",title:"管网类型",align:"center",visible:!0,sortable:!1,width:"12%",editable:!0},{field:"facilityStatusName",title:"设施状态",align:"center",visible:!0,sortable:!1,width:"12%"},{field:"address",title:"事件地点",align:"center",visible:!0,sortable:!1,width:"34%",editable:!0}]})},getSelectFacility:function(){var e=$("#facilityList").bootstrapTable("getSelections");e.length>0&&createmaintenance.determineFac(e[0].objectId,e[0].address,e[0].facilityName,e[0].facilityCode,e[0].facilityTypeName),$("#choiceFacFrame").modal("hide")},getEvent:function(){$("#eventList").bootstrapTable({url:"/cloudlink-inspection-event/eventInfo/web/v1/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",cache:!1,showHeader:!0,showRefresh:!1,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return eventSearchObj.queryObj.pageSize=e.pageSize,eventSearchObj.queryObj.pageNum=e.pageNumber,eventSearchObj.queryObj},onClickRow:function(e,t){$("#eventList").bootstrapTable("check",t.index())},columns:[{field:"state",radio:!0,align:"center",visible:!0,sortable:!1,width:"6%"},{field:"eventCode",title:"事件编号",align:"center",visible:!0,sortable:!1,width:"14%",editable:!0},{field:"occurrenceTime",title:"事件发生时间",align:"center",visible:!0,sortable:!1,width:"15%",editable:!0},{field:"fullTypeName",title:"事件类型",align:"center",visible:!0,sortable:!1,width:"20%",editable:!0},{field:"address",title:"事件地点",align:"center",visible:!0,sortable:!1,width:"27%",editable:!0},{field:"inspectorName",title:"上报人",align:"center",visible:!0,sortable:!1,width:"18%",editable:!0}]})},getSelectEvent:function(){var e=$("#eventList").bootstrapTable("getSelections");e.length>0&&createmaintenance.determineEvent(e[0].objectId,e[0].address,e[0].eventCode,e[0].fullTypeName),$("#choiceEventFrame").modal("hide")},creatmtc:function(e){this._selectPeople.length=[],createmaintenance.originTypeCode="",createmaintenance.originTypeName="",createmaintenance.reason="",createmaintenance.remediationTime="",createmaintenance.selectPeople="",createmaintenance.repairObj.maintenanceName="",createmaintenance.repairObj.typeCode="",createmaintenance.repairObj.typeName="",createmaintenance.repairObj.address="",createmaintenance.repairObj.buzId="",createmaintenance.repairObj.contactPhone="",$(".textarea_text span.text_num").text("(200字)"),$("#maintenanceAdd").modal(),createmaintenance.originTypeCode=e,"MO_01"==e?(createmaintenance.originTypeName="入户整改",createmaintenance.is_show="newHouseHold",1==zhugeSwitch&&zhuge.track("点击新建入户整改维修工单")):"MO_02"==e?(createmaintenance.originTypeName="管网设施",createmaintenance.is_show="newFacility",1==zhugeSwitch&&zhuge.track("点击新建管网设施维修工单")):"MO_03"==e?(createmaintenance.originTypeName="巡检事件",createmaintenance.is_show="newEvent",1==zhugeSwitch&&zhuge.track("点击新建巡检事件维修工单")):(createmaintenance.originTypeName="其他维修",createmaintenance.is_show="newOther",1==zhugeSwitch&&zhuge.track("点击新建其他维修工单"))}},newHouseHold={props:["repairdate"],template:'<div><div class="householdList"><div class="householdHalf"><div class="householdHalfLeft changeText">用户名称</div><div class="householdHalfRight changeLogo"><input type="text" readonly="readonly" onfocus="this.blur()" name="maintenanceName" v-model="maintenanceName" class="form-control" /></div></div><div class="householdHalf"><div class="householdHalfLeft changePhone">联系方式</div><div class="householdHalfRight changeNumber"><input type="text" name="contactPhone" readonly="readonly" onfocus="this.blur()" v-model="contactPhone" class="form-control" /></div></div></div><div class="householdList"><div class="householdHalfLeft changeAdress"><i>*</i>用户地址</div><div class="householdHalfRight changeAdressLogo has-feedback" @click="useradress"><input type="text" class="form-control hand" readonly="readonly" onfocus="this.blur()" v-model="address" name="address" /><span class="adressLogo"></span></div></div></div>',data:function(){return this.repairdate},watch:{},methods:{useradress:function(){userTable.getAreaList(),addressSearchObj.emptySelect(),addressSearchObj.refreshTable(),$("#choiceUserFrame").modal()}}},newFacility={props:["repairdate"],template:'<div><div class="householdList"><div class="householdHalf"><div class="householdHalfLeft changeText"><i>*</i>设施选择</div><div class="householdHalfRight changeLogo has-feedback" @click="choosefac"><input type="text" readonly="readonly" onfocus="this.blur()" name="maintenanceName" v-model="maintenanceName" class="form-control hand" /><span class="facchooseLogo"></span></div></div><div class="householdHalf"><div class="householdHalfLeft changePhone">设施类型</div><div class="householdHalfRight changeNumber"><input type="text" name="typeName" readonly="readonly" onfocus="this.blur()" v-model="typeName" class="form-control" /></div></div></div><div class="householdList"><div class="householdHalfLeft changeAdress">设施位置</div><div class="householdHalfRight changeAdressLogo"><input type="text" class="form-control" readonly="readonly" onfocus="this.blur()" v-model="address" name="address" /></div></div></div>',data:function(){return this.repairdate},methods:{choosefac:function(){facilitySearchObj.emptySelect(),facilitySearchObj.refreshTable(),$("#choiceFacFrame").modal()}}},newEvent={props:["repairdate"],template:'<div><div class="householdList"><div class="householdHalf"><div class="householdHalfLeft changeText"><i>*</i>事件选择</div><div class="householdHalfRight changeLogo has-feedback" @click="chooseevent"><input type="text" readonly="readonly" onfocus="this.blur()" name="facChoose" v-model="maintenanceName" class="form-control hand" /><span class="eventLogo"></span></div></div><div class="householdHalf"><div class="householdHalfLeft changePhone">事件类型</div><div class="householdHalfRight changeNumber"><input type="text" name="typeCode" v-model="typeName" readonly="readonly" onfocus="this.blur()" class="form-control" /></div></div></div><div class="householdList"><div class="householdHalfLeft changeAdress">事件位置</div><div class="householdHalfRight changeAdressLogo"><input type="text" class="form-control" v-model="address" readonly="readonly" onfocus="this.blur()" name="address" /></div></div></div>',data:function(){return this.repairdate},methods:{chooseevent:function(){$(".gf_reset_Btn").trigger("click"),$("#choiceEventFrame").modal()}}},newOther={props:["repairdate"],template:'<div><div class="householdList"><div class="householdHalf"><div class="householdHalfLeft changeText"><i>*</i>联系人</div><div class="householdHalfRight changeLogo"><input type="text" name="contact" v-model="maintenanceName" class="form-control" /></div></div><div class="householdHalf"><div class="householdHalfLeft changePhone"><i>*</i>联系电话</div><div class="householdHalfRight changeNumber"><input type="text" name="contactPhone" v-model="contactPhone" class="form-control" /></div></div></div><div class="householdList"><div class="householdHalfLeft changeAdress"><i>*</i>地址</div><div class="householdHalfRight changeAdressLogo"><input type="text" class="form-control" v-model="address" name="address" /></div></div></div>',data:function(){return this.repairdate}},createmaintenance=new Vue({el:"#maintenanceAdd",data:{is_show:"newHouseHold",originTypeCode:"",originTypeName:"",name:JSON.parse(lsObj.getLocalStorage("userBo")).userName,reason:"",remediationTime:"",selectPeople:"",repairObj:{maintenanceName:"",typeCode:"",typeName:"",address:"",buzId:"",contactPhone:""}},components:{newHouseHold:newHouseHold,newFacility:newFacility,newEvent:newEvent,newOther:newOther},methods:{chooserepairer:function(e){$("#chooseRepairer").modal(),userTable._isModify=e,userTable.requestPeopleTree()},determine:function(e,t,a,i){var r=this;Vue.set(r.repairObj,"maintenanceName",a),Vue.set(r.repairObj,"buzId",e),Vue.set(r.repairObj,"contactPhone",i),Vue.set(r.repairObj,"address",t)},determineFac:function(e,t,a,i,r){var n=this;Vue.set(n.repairObj,"maintenanceName",a),Vue.set(n.repairObj,"buzId",e),Vue.set(n.repairObj,"typeCode",i),Vue.set(n.repairObj,"typeName",r),Vue.set(n.repairObj,"address",t)},determineEvent:function(e,t,a,i){var r=this;Vue.set(r.repairObj,"maintenanceName",a),Vue.set(r.repairObj,"buzId",e),Vue.set(r.repairObj,"typeName",i),Vue.set(r.repairObj,"address",t)},judge:function(){var e=/^((1\d{10})|(([0-9]{3,4}-)?[0-9]{7,8}))$/;if("newHouseHold"==this.is_show){if(""==this.repairObj.address||"null"==this.repairObj.address)return xxwsWindowObj.xxwsAlert("请选择用户地址"),!1}else if("newFacility"==this.is_show){if(""==this.repairObj.maintenanceName||"null"==this.repairObj.maintenanceName)return xxwsWindowObj.xxwsAlert("请选择设施"),!1}else if("newEvent"==this.is_show){if(""==this.repairObj.maintenanceName||"null"==this.repairObj.maintenanceName)return xxwsWindowObj.xxwsAlert("请选择事件"),!1}else{if(""==this.repairObj.maintenanceName.trim()||"null"==this.repairObj.maintenanceName.trim())return xxwsWindowObj.xxwsAlert("请填写联系人"),!1;if(this.repairObj.maintenanceName.trim().length>20)return xxwsWindowObj.xxwsAlert("联系人不能超过20个字符"),!1;if(""==this.repairObj.contactPhone.trim()||"null"==this.repairObj.contactPhone.trim())return xxwsWindowObj.xxwsAlert("请填写联系电话"),!1;if(!e.test(this.repairObj.contactPhone.trim()))return xxwsWindowObj.xxwsAlert("联系电话格式填写错误"),!1;if(""==this.repairObj.address.trim()||"null"==this.repairObj.address.trim())return xxwsWindowObj.xxwsAlert("请填写地址"),!1;if(this.repairObj.address.trim().length>50)return xxwsWindowObj.xxwsAlert("地址不能超过50个字符"),!1}return""==this.selectPeople||"null"==this.selectPeople?(xxwsWindowObj.xxwsAlert("请选择维修人"),!1):""==this.remediationTime||"null"==this.remediationTime?(xxwsWindowObj.xxwsAlert("请选择维修期限"),!1):""==this.reason.trim()||"null"==this.reason.trim()?(xxwsWindowObj.xxwsAlert("请填写维修原因"),!1):void this.creatsubmit()},creatsubmit:function(){var e=this,t=e.repairObj;t.maintenanceName=t.maintenanceName.trim(),t.contactPhone=t.contactPhone.trim(),t.address=t.address.trim(),e.reason=e.reason.trim(),$(".creatSubmit").attr("disabled","disabled");var a={originTypeCode:e.originTypeCode,originTypeName:e.originTypeName,remediationTime:e.remediationTime,reason:e.reason,maintenanceCode:(new Date).Format("yyyyMMddHHmmssS"),relationshipPerson:userTable._selectPeople};$.extend(a,t,!0),$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/maintenanceWork/save?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(e){if(1==e.success){var t={tip:"新建维修成功",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){$("#maintenanceAdd").modal("hide"),window.location.reload()}};xxwsWindowObj.xxwsAlert(t),1==zhugeSwitch&&zhuge.track("新建维修工单成功")}else xxwsWindowObj.xxwsAlert("新建维修失败"),1==zhugeSwitch&&zhuge.track("新建维修工单失败");$(".creatSubmit").removeAttr("disabled")},error:function(){$(".creatSubmit").removeAttr("disabled"),xxwsWindowObj.xxwsAlert("新建维修失败"),1==zhugeSwitch&&zhuge.track("新建维修工单失败")}})}}}),exportObj={$exportAll:$("#export_all"),$exportChoice:$("#export_choice"),$exportAllWorksheet:$("#export_all_worksheet"),$exportChoiceWorksheet:$("#export_choice_worksheet"),expoerObj:{startDate:"",endDate:"",originTypeCode:"",status:"",keywordWeb:"",ids:[]},urlObj:{accountUrl:"/cloudlink-inspection-event/commonData/maintenanceAccount/export?token="+lsObj.getLocalStorage("token"),workUrl:"/cloudlink-inspection-event/commonData/maintenanceWork/export?token="+lsObj.getLocalStorage("token")},init:function(){var e=this;this.$exportAll.click(function(){e.expoerObj.ids=[],e.expoerCondition(e.urlObj.accountUrl)}),this.$exportChoice.click(function(){var t=$("#workList").bootstrapTable("getSelections");if(e.expoerObj.ids=[],0==t.length)return xxwsWindowObj.xxwsAlert("请选择你需要导出的台账！"),!1;for(var a=0;a<t.length;a++)e.expoerObj.ids.push(t[a].objectId);e.expoerCondition(e.urlObj.accountUrl)}),this.$exportAllWorksheet.click(function(){e.expoerObj.ids=[],e.expoerCondition(e.urlObj.workUrl)}),this.$exportChoiceWorksheet.click(function(){var t=$("#workList").bootstrapTable("getSelections");if(e.expoerObj.ids=[],0==t.length)return xxwsWindowObj.xxwsAlert("请选择你需要导出的工单！"),!1;for(var a=0;a<t.length;a++)e.expoerObj.ids.push(t[a].objectId);e.expoerCondition(e.urlObj.workUrl)})},exportDetails:function(e){var t=this,a={startDate:"",endDate:"",originTypeCode:"",status:"",keywordWeb:"",ids:[]};a.ids.push(e),t.expoerData(a,t.urlObj.workUrl)},expoerCondition:function(e){var t=searchObj.querryObj;this.expoerObj.startDate=t.startDate,this.expoerObj.endDate=t.endDate,this.expoerObj.originTypeCode=t.originTypeCode,this.expoerObj.status=t.status,this.expoerObj.keywordWeb=t.keywordWeb,this.expoerData(this.expoerObj,e)},expoerData:function(e,t){var a={url:t,data:e,method:"post"};this.downLoadFile(a)},downLoadFile:function(e){var t=$.extend(!0,{method:"post"},e),a=$('<iframe id="down-file-iframe" />'),i=$('<form target="down-file-iframe" method="'+t.method+'" />');i.attr("action",t.url)
;for(var r in t.data)i.append('<input type="hidden" name="'+r+'" value="'+t.data[r]+'" />');a.append(i),$(document.body).append(a),i[0].submit(),a.remove()}};$(function(){searchObj.init(),userTable.init(),addressSearchObj.init(),facilitySearchObj.init(),eventSearchObj.init(),exportObj.init(),$(document).on("show.bs.modal",".modal",function(e){if(!$(this).hasClass("in")){var t=1040+10*$(".modal:visible").length;$(this).css("z-index",t),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",t-1).addClass("modal-stack")},0)}}),$(document).on("hidden.bs.modal",".modal",function(e){$(".modal:visible").length>0&&$("body").addClass("modal-open")})});