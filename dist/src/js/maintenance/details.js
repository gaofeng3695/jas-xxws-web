var User=Vue.extend({props:["myMsgdetails","modifybtn","openperson"],template:'<div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修来源</div><div class="frameListRight"><p>{{myMsgdetails.originTypeName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">创建人</div><div class="frameListRight"><p>{{createUserName}}</p></div></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">用户名称</div><div class="frameListRight"><p>{{maintenanceName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">联系方式</div><div class="frameListRight"><p>{{contactPhone}}</p></div></div></div><div class="frameList"><div class="frameListLeft">用户地址</div><div class="frameListRight"><p>{{address}}</p></div></div><div class="frameList"><div class="frameListLeft">维修人</div><div class="frameListRight"><p class="repairModify"><em @click="openperson" v-show="modifybtn" title="修改人员"></em><span>{{relationshipPersonNames}}</span></p></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修期限</div><div class="frameListRight"><p>{{remediationTime}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">维修时间</div><div class="frameListRight"><p>{{maintenanceRecordTime}}</p></div></div></div><div class="frameList"><div class="frameListLeft">维修状态</div><div class="frameListRight"><p>{{statusName}}</p></div></div><div class="frameList"><div class="frameListLeft">维修原因</div><div class="frameListRight"><p>{{reason}}</p></div></div><child-component v-if="orderShow" v-bind:my-orderdeta="myMsgdetails"></child-component></div>',data:function(){return this.myMsgdetails},computed:{statusName:function(){return 1==this.status?"待维修":2==this.status?"已完成":"---"},orderShow:function(){return""!=this.workRecordId&&null!=this.workRecordId&&void 0!=this.workRecordId}}}),Facility=Vue.extend({props:["myMsgdetails","modifybtn","openperson"],template:'<div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修来源</div><div class="frameListRight"><p>{{originTypeName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">创建人</div><div class="frameListRight"><p>{{createUserName}}</p></div></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">设施名称</div><div class="frameListRight"><p>{{maintenanceName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">设施类型</div><div class="frameListRight"><p>{{typeName}}</p></div></div></div><div class="frameList"><div class="frameListLeft">设施位置</div><div class="frameListRight"><p>{{address}}</p></div></div><div class="frameList"><div class="frameListLeft">维修人</div><div class="frameListRight"><p class="repairModify"><em @click="openperson" v-show="modifybtn" title="修改人员"></em><span>{{relationshipPersonNames}}</span></p></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修期限</div><div class="frameListRight"><p>{{remediationTime}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">维修时间</div><div class="frameListRight"><p>{{maintenanceRecordTime}}</p></div></div></div><div class="frameList"><div class="frameListLeft">维修状态</div><div class="frameListRight"><p>{{statusName}}</p></div></div><div class="frameList"><div class="frameListLeft">维修原因</div><div class="frameListRight"><p>{{reason}}</p></div></div><child-component v-if="orderShow" v-bind:my-orderdeta="myMsgdetails"></child-component></div>',data:function(){return this.myMsgdetails},computed:{statusName:function(){return 1==this.status?"待维修":2==this.status?"已完成":"---"},orderShow:function(){return""!=this.workRecordId&&null!=this.workRecordId&&void 0!=this.workRecordId}}}),Events=Vue.extend({props:["myMsgdetails","modifybtn","openperson"],template:'<div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修来源</div><div class="frameListRight"><p>{{originTypeName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">创建人</div><div class="frameListRight"><p>{{createUserName}}</p></div></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">事件编号</div><div class="frameListRight"><p>{{maintenanceName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">事件类型</div><div class="frameListRight"><p>{{typeName}}</p></div></div></div><div class="frameList"><div class="frameListLeft">事件地点</div><div class="frameListRight"><p>{{address}}</p></div></div><div class="frameList"><div class="frameListLeft">维修人</div><div class="frameListRight"><p class="repairModify"><em @click="openperson" v-show="modifybtn" title="修改人员"></em><span>{{relationshipPersonNames}}</span></p></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修期限</div><div class="frameListRight"><p>{{remediationTime}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">维修时间</div><div class="frameListRight"><p>{{maintenanceRecordTime}}</p></div></div></div><div class="frameList"><div class="frameListLeft">维修状态</div><div class="frameListRight"><p>{{statusName}}</p></div></div><div class="frameList"><div class="frameListLeft">维修原因</div><div class="frameListRight"><p>{{reason}}</p></div></div><child-component v-if="orderShow" v-bind:my-orderdeta="myMsgdetails"></child-component></div>',data:function(){return this.myMsgdetails},computed:{statusName:function(){return 1==this.status?"待维修":2==this.status?"已完成":"---"},orderShow:function(){return""!=this.workRecordId&&null!=this.workRecordId&&void 0!=this.workRecordId}}}),Other=Vue.extend({props:["myMsgdetails","modifybtn","openperson"],template:'<div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修来源</div><div class="frameListRight"><p>{{originTypeName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">创建人</div><div class="frameListRight"><p>{{createUserName}}</p></div></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">联系人</div><div class="frameListRight"><p>{{maintenanceName}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">联系方式</div><div class="frameListRight"><p>{{contactPhone}}</p></div></div></div><div class="frameList"><div class="frameListLeft">地址</div><div class="frameListRight"><p>{{address}}</p></div></div><div class="frameList"><div class="frameListLeft">维修人</div><div class="frameListRight"><p class="repairModify"><em @click="openperson" v-show="modifybtn" title="修改人员"></em><span>{{relationshipPersonNames}}</span></p></div></div><div class="frameList"><div class="frameListHalf"><div class="frameListLeft">维修期限</div><div class="frameListRight"><p>{{remediationTime}}</p></div></div><div class="frameListHalf"><div class="frameListLeft">维修时间</div><div class="frameListRight"><p>{{maintenanceRecordTime}}</p></div></div></div><div class="frameList"><div class="frameListLeft">维修状态</div><div class="frameListRight"><p>{{statusName}}</p></div></div><div class="frameList"><div class="frameListLeft">维修原因</div><div class="frameListRight"><p>{{reason}}</p></div></div><child-component v-if="orderShow" v-bind:my-orderdeta="myMsgdetails"></child-component></div>',data:function(){return this.myMsgdetails},computed:{statusName:function(){return 1==this.status?"待维修":2==this.status?"已完成":"---"},orderShow:function(){return""!=this.workRecordId&&null!=this.workRecordId&&void 0!=this.workRecordId}}}),childComponent=Vue.extend({props:["myOrderdeta"],template:'<div><div class="frameDetailsTitle">维修费用</div><child-list v-for="team in workRecordCostArr(workRecordCost)" v-bind:names="team.name" v-bind:prices="team.price" v-bind:amounts="team.amount"></child-list><div class="frameList"><div class="frameListLeft">总计</div><div class="frameListRight"><p>{{totalCost | pliceNumber}} （<span v-text="captialTotalCost"></span>）人民币</p></div></div><div class="frameList"><div class="frameListLeft">维修内容</div><div class="frameListRight"><p>{{content}}</p></div></div><div class="frameList"><div class="frameListLeft">照片</div><div class="frameListRight"><ul><span v-if="picShow">无</span><li class="event_pic_list" v-for="value in pic"><img :src="imgSrc(value)" :data-original="imgOriginalSrc(value)" @click="previewPicture($event)" alt=""/></li></ul></div></div><div class="frameList" v-if="operationShow"><div class="frameListLeft">用户签字</div><div class="frameListRight"><ul><li class="event_pic_list" v-for="value in signature"><img :src="imgSrc(value)" :data-original="imgOriginalSrc(value)" @click="previewPicture($event)" alt=""/></li></ul></div></div><div class="frameList" v-if="operationShow"><div class="frameListLeft">用户满意度</div><div class="frameListRight satisfaction" v-html="starHtml"></div></div></div>',data:function(){return this.myOrderdeta},computed:{starHtml:function(){switch(this.satisfaction){case"1":var i='<ul><li><img src="/src/images/security/star.png" width="20" alt=""></li></ul><span>非常不满</span>';return i;case"2":var i='<ul><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li></ul><span>不满意</span>';return i;case"3":var i='<ul><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li></ul><span>一般</span>';return i;case"4":var i='<ul><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li></ul><span>满意</span>';return i;case"5":var i='<ul><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li><li><img src="/src/images/security/star.png" width="20" alt=""></li></ul><span>非常满意</span>';return i;default:var i="<p> </p>";return i}},picShow:function(){return!(this.pic.length>0)},operationShow:function(){return"MO_01"==this.originTypeCode}},filters:{pliceNumber:function(i,e,s){e=e||",",s=s||".";var t=i<0?"-":"",a=parseInt(i=Math.abs(+i||0).toFixed(2),10)+"",r=(r=a.length)>3?r%3:0;return t+(r?a.substr(0,r)+e:"")+a.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+e)+(s+Math.abs(i-a).toFixed(2).slice(2))}},methods:{workRecordCostArr:function(i){if(i.length>0)return i;var e={name:"",prices:"",amount:""};return i.push(e)},imgSrc:function(i){return"/cloudlink-core-file/file/getImageBySize?fileId="+i+"&viewModel=fill&width=104&hight=78"},previewPicture:function(i){viewPicObj.viewPic(i.currentTarget)},imgOriginalSrc:function(i){return"/cloudlink-core-file/file/downLoad?fileId="+i}}}),childList=Vue.extend({props:["names","prices","amounts"],template:'<div class="priceList"><div class="frameList"><div class="frameListThird"><div class="frameListLeft">名称</div><div class="frameListRight"><p>{{names}}</p></div></div><div class="frameListThird"><div class="frameListLeft">单价</div><div class="frameListRight"><p>{{prices|pliceNumber}}</p></div></div><div class="frameListThird"><div class="frameListLeft">数量</div><div class="frameListRight"><p>{{amounts}}</p></div></div></div></div>',filters:{pliceNumber:function(i,e,s){if(""==i||null==i||void 0==i)return"";e=e||",",s=s||".";var t=i<0?"-":"",a=parseInt(i=Math.abs(+i||0).toFixed(2),10)+"",r=(r=a.length)>3?r%3:0;return t+(r?a.substr(0,r)+e:"")+a.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+e)+(s+Math.abs(i-a).toFixed(2).slice(2))}}});Vue.component("child-component",childComponent),Vue.component("child-list",childList);var Axis={props:["myMsgaxis"],template:'<div><div class="axisDay" v-for="teamarr in dateArr" v-bind:dateName="teamarr.id">                    <div class="axisDayTitle">{{dateChange(teamarr.id)}}</div>                    <div class="axisTime">                        <div class="axisTimeList" v-for="team in timeArr(teamarr.id)">                            <span>{{team.opTime}}</span>                            <p>{{team.createUserName}}<i>{{team.operateTypeName}}</i>{{team.operateContent}}</p>                        </div>                    </div>                </div></div>',data:function(){return this.myMsgaxis},computed:{dateArr:function(){for(var i=this.operateList,e=[],s="",t=0;t<i.length;t++)if(s!=i[t].opDate){s=i[t].opDate;var a={id:s};e.push(a)}return e}},methods:{timeArr:function(i){for(var e=this.operateList,s=[],t=0;t<e.length;t++)e[t].opDate==i&&s.push(e[t]);return s},dateChange:function(i){return i==(new Date).Format("yyyy-MM-dd")?"今天（"+i+"）":i==this.GetDateStr(-1)?"昨天（"+i+"）":i},GetDateStr:function(i){var e=new Date;e.setDate(e.getDate()+i);var s=e.getFullYear(),t=e.getMonth()+1,a=e.getDate();return t<10&&(t="0"+t),a<10&&(a="0"+a),s+"-"+t+"-"+a}}};Vue.component("axis-html",Axis);var detailsV=new Vue({el:"#repairDetails",data:{which_to_show:"user",maintenanceCode:"---",detailsShow:!0,axisShow:!1,modifyShow:!1,frameName:"",dataAxis:{maintenanceCode:"---",reason:"---",operateList:[{operateTypeCode:"---",operateTypeName:"---",operateContent:"---",createUserId:"---",createUserName:"---",createTime:"---",opDate:"---",opTime:"---"}]},dataBasics:{address:"---",buzId:"---",captialTotalCost:"---",contactPhone:"---",content:"---",createTime:"---",createUserId:"---",createUserName:"---",enterpriseId:"---",maintenanceCode:"---",maintenanceName:"---",maintenanceRecordTime:"---",objectId:"---",orgId:"---",originTypeCode:"---",originTypeName:"---",pic:[],reason:"---",relationshipPersonIds:"",relationshipPersonNames:"---",relationshipPersons:[],remediationTime:"---",satisfaction:"---",signature:[],status:"---",totalCost:"---",typeCode:"---",typeName:"---",workRecordCost:[],workRecordId:""}},components:{user:User,facility:Facility,event:Events,other:Other},methods:{tabChange:function(i){"details"==i?(this.detailsShow=!0,this.axisShow=!1):(this.detailsShow=!1,this.axisShow=!0)},witchName:function(i){i?(this.frameName="维修记录编辑",this.modifyShow=!0):(this.frameName="维修详情",this.modifyShow=!1)},getRepairDetails:function(i){var e=this,s={objectId:i};repairObj._selectedPersons=[],$.ajax({type:"GET",url:"/cloudlink-inspection-event/commonData/maintenanceWork/get?token="+lsObj.getLocalStorage("token"),data:s,contentType:"application/json",dataType:"json",success:function(i,s){1==i.success?(e.maintenanceCode=i.rows[0].maintenanceCode,$.extend(detailsV.dataBasics,i.rows[0],!0),e.ergodicPersons(i.rows[0].relationshipPersons)):xxwsWindowObj.xxwsAlert("获取数据失败！")}})},getRepairAxis:function(i){var e={objectId:i};$.ajax({type:"POST",url:"/cloudlink-inspection-event/commonData/maintenanceOperate/getList?token="+lsObj.getLocalStorage("token"),data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(i,e){1==i.success?Vue.set(detailsV.dataAxis,"operateList",i.rows[0].operateList):xxwsWindowObj.xxwsAlert("获取数据失败！")}})},ergodicPersons:function(i){for(var e=0;e<i.length;e++){var s={relationshipPersonId:i[e].relationshipPersonId,relationshipPersonName:i[e].relationshipPersonName};repairObj._selectedPersons.push(s)}},openPerson:function(){userTable._selectPeople=repairObj._selectedPersons,createmaintenance.chooserepairer(!0)},getSelectPerson:function(i,e){repairObj._selectedPersons=[];for(var s=0;s<i.length;s++)repairObj._selectedPersons.push(i[s]);this.dataBasics.relationshipPersonNames=e},modifySave:function(){var i=this,e={tip:"是否保存你所修改的维修工单？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){i.modifyDataSave()}};xxwsWindowObj.xxwsAlert(e)},modifyDataSave:function(){var i=this;if(0==repairObj._selectedPersons.length)xxwsWindowObj.xxwsAlert("请选择维修人员");else{var e={objectId:i.dataBasics.objectId,relationshipPerson:repairObj._selectedPersons};$.ajax({type:"POST",url:"/cloudlink-inspection-event/maintenanceWork/updateMaintenancePersonnel?token="+lsObj.getLocalStorage("token"),data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(i,e){if(1==i.success){var s={tip:"修改维修工单成功",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){repairObj.$repairDetails.modal("hide"),window.location.reload()}};xxwsWindowObj.xxwsAlert(s)}else"XE05001"==i.code?xxwsWindowObj.xxwsAlert("维修工单已结束，维修人员不能修改"):xxwsWindowObj.xxwsAlert("维修人员修改失败！")}})}}}}),repairObj={$repairDetails:$("#repairDetails"),$repairHistory:$("#repairHistory"),_repairId:null,_historySeachKey:"",_historySeachId:"",_isModify:null,_selectedPersons:[],detailsInitial:{address:"---",buzId:"---",captialTotalCost:"---",contactPhone:"---",content:"---",createTime:"---",createUserId:"---",createUserName:"---",enterpriseId:"---",maintenanceCode:"---",maintenanceName:"---",maintenanceRecordTime:"---",objectId:"---",orgId:"---",originTypeCode:"---",originTypeName:"---",pic:[],reason:"---",relationshipPersonIds:"",relationshipPersonNames:"---",relationshipPersons:[],remediationTime:"---",satisfaction:"---",signature:[],status:"---",totalCost:"---",typeCode:"---",typeName:"---",workRecordCost:[],workRecordId:""},axisInitial:[{operateTypeCode:"---",operateTypeName:"---",operateContent:"---",createUserId:"---",createUserName:"---",createTime:"---",opDate:"---",opTime:"---"}],init:function(){var i=this;i.$repairDetails.on("shown.bs.modal",function(e){detailsV.getRepairDetails(i._repairId),detailsV.getRepairAxis(i._repairId)}),$(".historySeachBtn").click(function(){i._historySeachKey=$(".historySeachMain input").val().trim(),i.getHistoryTable()}),i.$repairHistory&&i.historyTable()},openDetailsFrame:function(i,e,s){detailsV.which_to_show="MO_01"==e?"user":"MO_02"==e?"facility":"MO_03"==e?"event":"other",this._repairId=i,this._isModify=s,detailsV.maintenanceCode="---",$.extend(detailsV.dataBasics,this.detailsInitial,!0),Vue.set(detailsV.dataAxis,"operateList",this.axisInitial),detailsV.witchName(s),detailsV.tabChange("details"),this.$repairDetails.modal()},openHistoryFrame:function(i){this.$repairHistory.modal(),this._historySeachKey="",this._historySeachId=i,$(".historySeachMain input").val(""),this.getHistoryTable()},historyTable:function(){var i=this,e={keyword:"",buzId:"",pageNum:1,pageSize:10};$("#repairTableHistory").bootstrapTable({url:"/cloudlink-inspection-event/commonData/maintenanceWorkHistory/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",cache:!1,showHeader:!0,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(i){return e.pageSize=i.pageNumber,e.pageNum=i.pageSize,e},onLoadSuccess:function(i){i.success},onDblClickRow:function(e){return i.openDetailsFrame(e.objectId,e.originTypeCode),!1},columns:[{field:"maintenanceCode",title:"维修编号",align:"center",visible:!0,sortable:!1,width:"17%",editable:!0},{field:"maintenanceRecordTime",title:"维修时间",align:"center",visible:!0,sortable:!1,width:"17%",editable:!0},{field:"originTypeName",title:"维修来源",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"relationshipPersonNames",title:"维修人",align:"center",visible:!0,sortable:!1,width:"20%",editable:!0},{field:"reason",title:"维修原因",align:"center",visible:!0,sortable:!1,width:"31%",editable:!0},{field:"operate",title:"操作",align:"center",events:i.historyTableEvent(),width:"5%",formatter:i.historyTableOperation}]})},getHistoryTable:function(){var i=this,e={keyword:i._historySeachKey,buzId:i._historySeachId,pageNum:1,pageSize:10};$("#repairTableHistory").bootstrapTable("refreshOptions",{queryParams:function(i){return e.pageNum=i.pageNumber,e.pageSize=i.pageSize,e}})},historyTableOperation:function(i,e,s){return['<a class="look" href="javascript:void(0)" title="查看">',"<i></i>","</a>"].join("")},historyTableEvent:function(){var i=this;return{"click .look":function(e,s,t,a){return i.openDetailsFrame(t.objectId,t.originTypeCode),!1}}}};$(function(){repairObj.init()});