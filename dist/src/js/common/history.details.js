function previewPicture(e){viewPicObj.viewPic(e)}function playAmrAudio(e,t){if(window.ActiveXObject||"ActiveXObject"in window)return xxwsWindowObj.xxwsAlert("IE浏览器暂不支持录音文件的播放，建议使用Chrome、Firefox等浏览器！"),!0;$.ajax({type:"GET",url:"/cloudlink-core-file/file/getUrlByFileId?fileId="+e,contentType:"application/json",dataType:"json",success:function(e,i){var a=e.rows[0].fileUrl.replace(/^.*?\:\/\/[^\/]+/,"");fetchBlob("/audio"+a,function(e){playAmrBlob(e)}),$(t).attr("class","audioPlayIn"),setTimeout(function(){$(t).attr("class","audioPlay")},1e4)}})}var historyDetailsObj={$historyDetailsFrame:$("#historyDetailsFrame"),$historyAddressMap:new BMap.Map("historyAddressMap"),$deleteBtn:$(".deleteHistory"),$exportBtn:$(".exportHistory"),_recordId:null,init:function(){var e=this;e.$historyAddressMap.centerAndZoom(new BMap.Point(116.404,39.915),15),e.$historyAddressMap.enableScrollWheelZoom(!0),e.$deleteBtn.click(function(){var t={tip:"您是否删除该设施检查记录？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.deleteHistory(e._recordId)}};xxwsWindowObj.xxwsAlert(t)}),e.$exportBtn.click(function(){e.exportHistory(e._recordId)})},clearHistoryDetails:function(){var e=this;$(".facilityCheckTimeH").text("---"),$(".createUserNameH").text("---"),$(".facilityTypeNameH").text("---"),$(".facilityNameH").text("---"),$(".addressH").text("---"),$(".isLeakageNameH").text("---"),$(".combustibleGasConcentrationH").text("---"),$(".isFacilityWorkNameH").text("---"),$(".facilityWorkDescH").text("---"),$(".facilityCheckResultNameH").text("---"),$(".additionalBox").html(""),$(".historyAudio").html("<span>无</span>"),$(".historyImg").html("<span>无</span>"),$(".remarkH").text("---"),e.$historyAddressMap.clearOverlays(),e.$deleteBtn.hide()},boxMain:function(e){var t="";switch(e.facilityTypeCode){case"FT_01":t='<div class="planList"><div class="planListHalf"><div class="planListLeft">进口压力(kPa)</div><div class="planListRight"><p class="pressureInH">'+e.pressureIn+'</p></div></div><div class="planListHalf"><div class="planListLeft">出口压力(kPa)</div><div class="planListRight"><p class="pressureOutH">'+e.pressureOut+'</p></div></div></div><div class="planList"><div class="planListLeft">压力是否正常</div><div class="planListRight textarea_text"><p class="pressureSituationNameH">'+e.pressureSituationName+"</p></div></div>";break;case"FT_04":t='<div class="planList"><div class="planListHalf"><div class="planListLeft">井内有无积水</div><div class="planListRight"><p class="isSeeperNameH">'+e.isSeeperName+'</p></div></div><div class="planListHalf"><div class="planListLeft">井盖是否损坏</div><div class="planListRight"><p class="isWellCoverDamageNameH">'+e.isWellCoverDamageName+'</p></div></div></div><div class="planList"><div class="planListLeft">有无占压</div><div class="planListRight textarea_text"><p class="isOccupyNameH">'+e.isOccupyName+"</p></div></div>";break;case"FT_10":t='<div class="planList"><div class="planListHalf"><div class="planListLeft">压力是否正常</div><div class="planListRight"><p class="pressureSituationNameH">'+e.pressureSituationName+'</p></div></div><div class="planListHalf"><div class="planListLeft">流量计读数(m<sup>3</sup>)</div><div class="planListRight"><p class="flowmeterDataH">'+e.flowmeterData+"</p></div></div></div>";break;default:t=""}return t},setCenterZoom:function(e){var t=new BMap.Point(e.facilityBdLon,e.facilityBdLat),i=new BMap.Marker(t);this.$historyAddressMap.addOverlay(i),this.$historyAddressMap.setCenter(t)},geiHistoryDetails:function(e){var t=this,i={objectId:e};$.ajax({type:"GET",url:"/cloudlink-inspection-event/facilityRecord/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:i,dataType:"json",success:function(e){if(1==e.success){t._recordId=e.rows[0].objectId,$(".facilityCheckTimeH").text(e.rows[0].facilityCheckTime),$(".createUserNameH").text(e.rows[0].createUserName),$(".facilityTypeNameH").text(e.rows[0].facilityTypeName),$(".facilityNameH").text(e.rows[0].facilityName),$(".addressH").text(e.rows[0].address),$(".isLeakageNameH").text(e.rows[0].isLeakageName),$(".combustibleGasConcentrationH").text(e.rows[0].combustibleGasConcentration),$(".isFacilityWorkNameH").text(e.rows[0].isFacilityWorkName),$(".facilityWorkDescH").text(e.rows[0].facilityWorkDesc),$(".facilityCheckResultNameH").text(e.rows[0].facilityCheckResultName);var i=t.boxMain(e.rows[0]);$(".additionalBox").html(i),t.setCenterZoom(e.rows[0]),$(".remarkH").text(e.rows[0].remark);var a="";if(e.rows[0].pic.length>0){for(var s=0;s<e.rows[0].pic.length;s++)a+='<li class="event_pic_list"><img  src="/cloudlink-core-file/file/getImageBySize?fileId='+e.rows[0].pic[s]+'&viewModel=fill&width=104&hight=78" data-original="/cloudlink-core-file/file/downLoad?fileId='+e.rows[0].pic[s]+'" onclick="previewPicture(this)" alt=""/></li>';$(".historyImg").html(a)}if(e.rows[0].audio.length>0){var l='<button  class="audioPlay" onclick="playAmrAudio(\''+e.rows[0].audio[0]+"',this)\"></button>";$(".historyAudio").html(l)}var o=JSON.parse(lsObj.getLocalStorage("userBo")).objectId;1==JSON.parse(lsObj.getLocalStorage("userBo")).isSysadmin?t.$deleteBtn.show():e.rows[0].createUserId==o?t.$deleteBtn.show():t.$deleteBtn.hide()}else xxwsWindowObj.xxwsAlert("获取设施检查记录详情失败")},error:function(){xxwsWindowObj.xxwsAlert("获取设施检查记录详情失败")}})},deleteHistory:function(e){var t={objectId:e};$.ajax({type:"POST",url:"/cloudlink-inspection-event/facilityRecord/delete?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(e,t){if(1==e.success){var i={tip:"设施检查记录删除成功！",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(i)}else 410==e.code&&xxwsWindowObj.xxwsAlert("您没有删除设施检查记录的权限！"),xxwsWindowObj.xxwsAlert("设施检查记录删除失败！")}})},exportHistory:function(e){var t=this,i={facilityCheckResult:"",isLeakage:"",facilityTypeCode:"",facilityId:"",startDate:"",endDate:"",keywordWeb:"",pageNum:1,pageSize:10,idList:[]};i.idList.push(e),t.expoerData(i)},expoerData:function(e){var t={url:"/cloudlink-inspection-event/facilityRecord/exportWord?token="+lsObj.getLocalStorage("token"),data:e,method:"post"};this.downLoadFile(t)},downLoadFile:function(e){var t=$.extend(!0,{method:"post"},e),i=$('<iframe id="down-file-iframe" />'),a=$('<form target="down-file-iframe" method="'+t.method+'" />');a.attr("action",t.url);for(var s in t.data)a.append('<input type="hidden" name="'+s+'" value="'+t.data[s]+'" />');i.append(a),$(document.body).append(i),a[0].submit(),i.remove()}};$(function(){historyDetailsObj.init()});