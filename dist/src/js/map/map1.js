function palyInspect(e){var t=$(e).closest("div.record_details").find("input[name=inspect_id_m]").val(),n=$(e).closest("div.record_details").find("input[name=flag_m]").val();playerObj.play(t,n)}function view_detail(e){var t=$(e).attr("name");taskDetailsObj.loadDetails(t)}function previewPicture(e){viewPicObj.viewPic(e)}function playAmrAudio(e,t){if(window.ActiveXObject||"ActiveXObject"in window)return xxwsWindowObj.xxwsAlert("IE浏览器暂不支持录音文件的播放，建议使用Chrome、Firefox等浏览器！"),!0;$.ajax({type:"GET",url:"/cloudlink-core-file/file/getUrlByFileId?fileId="+e,contentType:"application/json",dataType:"json",success:function(e,n){var i=e.rows[0].fileUrl.replace(/^.*?\:\/\/[^\/]+/,"");fetchBlob("/audio"+i,function(e){playAmrBlob(e)}),$(t).attr("class","audioPlayIn"),setTimeout(function(){$(t).attr("class","audioPlay")},1e4)}})}function eventsAndInspectersLoadFinish(e){if(loadCount++,null!=e&&e.length>0&&(aEventsAndInspecters=aEventsAndInspecters.concat(e)),2==loadCount&&aEventsAndInspecters.length>0)mapObj.setPointsMarkerWithCenterPointAndZoomLevel(aEventsAndInspecters),loadCount=0,aEventsAndInspecters=[];else if(2==loadCount&&0==aEventsAndInspecters.length){var t=new BMap.Point(116.404,39.915);mapObj.$bdMap.centerAndZoom(t,5)}}function eventsOrInspectersLoadFinish(e){null!=e&&e.length>0&&(aEventsAndInspecters=aEventsAndInspecters.concat(e)),aEventsAndInspecters.length>0&&(mapObj.setPointsMarkerWithCenterPointAndZoomLevel(aEventsAndInspecters),loadCount=0,aEventsAndInspecters=[])}function toolsBarForDistance(){tabObj.closeTip(),mapObj.$myDis.open()}$(function(){eventObj.init(),inspectObj.init(),tabObj.init()});var eventObj={$eventBtn:$(".eventBtn"),$searchEvent:$("#search_event"),$searchEventText:$(".search_event"),$eventInformation:$(".event_list"),$eventClosed:$(".close_event"),$tabEventClosed:$("#event_closed"),_eventData:null,eventStartPoints:[],eventPoints:[],initialPoints:[],markerClusterer:null,eventConditionObj:{status:"20",type:"",startDate:"2016-10-01",endDate:"",keyword:"",userIds:"",pageNum:1,pageSize:100},init:function(){var e=this;this.getEventData(),this.$eventBtn.click(function(){$(this).hasClass("active")?e.closeEvent():e.openEvent()}),this.$eventClosed.click(function(){$(".event_list").hide();for(var t=0;t<e.eventPoints.length;t++)e.eventPoints[t].value.setAnimation()}),this.$searchEvent.click(function(){var t=e.$searchEventText.val().trim();e.searchData(t)}),$("#_event .event").on("click","li",function(){var t=$(this).find("input[type=hidden]").val();e.eventTabListClick(t)}),this.$tabEventClosed.click(function(){inspectObj.resetInspect(),e.resetevent()})},closeEvent:function(){this.$eventBtn.removeClass("active"),this.removePoints(),this.$eventInformation.hide()},openEvent:function(){this.$eventBtn.addClass("active"),this.addPoints()},assignmentPoints:function(){for(var e=0;e<this.eventPoints.length;e++)this.eventStartPoints[e]=this.eventPoints[e]},setInitialPoints:function(){for(var e=0;e<this.eventPoints.length;e++)this.initialPoints[e]=this.eventPoints[e]},getInitialPoints:function(){if(this.initialPoints.length>0){for(var e=0;e<this.initialPoints.length;e++)this.eventPoints[e]=this.initialPoints[e];this.initialPoints=[]}},setEventPointsMarker:function(e,t){this.removePoints();var n=this;""==t||null==t||void 0==t||n.setInitialPoints();var i=null,s=null,a=null;this.eventPoints=[];for(var o=0;o<e.length;o++)a=new BMap.Point(e[o].bdLon,e[o].bdLat),i=e[o].eventIconName?20==e[o].status?new BMap.Icon("/src/images/common/process/"+e[o].eventIconName,new BMap.Size(29,42),{anchor:new BMap.Size(15,42)}):new BMap.Icon("/src/images/common/finish/"+e[o].eventIconName,new BMap.Size(29,42),{anchor:new BMap.Size(15,42)}):new BMap.Icon("/src/images/common/process/D01.png",new BMap.Size(29,42),{anchor:new BMap.Size(15,42)}),s=new BMap.Marker(a,{icon:i}),this.eventPoints.push({key:e[o].objectId,value:s}),s.addEventListener("click",function(e){n.eventPointClick(e,t)});this.addPoints()},eventPointClick:function(e,t){for(var n=this,i=0;i<this.eventPoints.length;i++)this.eventPoints[i].value.setAnimation();for(var i=0;i<inspectObj.inspectPoints.length;i++)inspectObj.inspectPoints[i].value.setAnimation();var s=e.target;s.setAnimation(BMAP_ANIMATION_BOUNCE);for(var i=0;i<this.eventPoints.length;i++)this.eventPoints[i].value==s&&(""==t||null==t||void 0==t?n.getEventDetails(this.eventPoints[i].key):taskDetailsObj.loadDetails(this.eventPoints[i].key))},eventTabListClick:function(e){var t=this;this.$eventBtn.hasClass("active")||this.addPoints();for(var n=0;n<inspectObj.inspectPoints.length;n++)inspectObj.inspectPoints[n].value.setAnimation();for(var n=0;n<t.eventPoints.length;n++)if(t.eventPoints[n].key==e){var i=t.eventPoints[n].value.getPosition().lng,s=t.eventPoints[n].value.getPosition().lat;mapObj.$bdMap.centerAndZoom(new BMap.Point(i,s),19),t.eventPoints[n].value.setAnimation(BMAP_ANIMATION_BOUNCE)}else t.eventPoints[n].value.setAnimation();this.getEventDetails(e),this.$eventBtn.addClass("active")},setEventTab:function(e){this.$eventBtn.addClass("active"),$("#_event .event ul").html("");var t=null;try{if(e.length>0)for(var n=0;n<e.length;n++)t='<li><input type="hidden" value="'+e[n].objectId+'"><div class="line01"><span class="type">'+e[n].fullTypeName+'</span><span class="name">'+e[n].inspectorName+'</span><span class="date">'+e[n].occurrenceTime+'</span></div><div class="loca_desc">'+e[n].address+"</div></li>",$("#_event .event ul").append(t);else t='<p style="text-align:center;">没有查询到您要数据！</p>',$("#_event .event ul").append(t)}catch(e){t='<p style="text-align:center;">没有查询到您要数据！</p>',$("#_event .event ul").append(t)}},eventInit:function(){var e=this._eventData.rows.length;$(".eventAll").text(e),this.assignmentPoints(),this.setEventTab(this._eventData.rows)},searchData:function(e){var t=jsonFuzzyQuery(this._eventData.rows,e,"fullTypeName,inspectorName,occurrenceTime,address");this.setEventPointsMarker(t),this.setEventTab(t),this.$eventInformation.hide(),mapObj.setPointsMarkerWithCenterPointAndZoomLevel(t),this.$eventBtn.addClass("active")},resetevent:function(){this.$eventInformation.hide(),this.$searchEventText.val(""),this.setEventPointsMarker(this._eventData.rows),this.setEventTab(this._eventData.rows),mapObj.setPointsMarkerWithCenterPointAndZoomLevel(this._eventData.rows),this.$eventBtn.addClass("active")},getEventData:function(){var e=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/eventInfo/web/v1/getPageList?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e.eventConditionObj),dataType:"json",success:function(t,n){e._eventData=t,e.eventInit(),eventObj.setEventPointsMarker(e._eventData.rows),eventsAndInspectersLoadFinish(e._eventData.rows)}})},getEventDetails:function(e){var t=this;inspectObj.$inspectInformation.hide(),t.$eventInformation.show(),$.ajax({type:"GET",url:"/cloudlink-inspection-event/eventInfo/get?token="+lsObj.getLocalStorage("token")+"&eventId="+e,contentType:"application/json",dataType:"json",success:function(e,t){var n=e.rows,i=n[0].pic;$(".eventpic_list ul").html(""),$(".event_code").text(n[0].eventCode),$(".event_type").text(n[0].fullTypeName),$(".report_man").text(n[0].inspectorName),$(".event_address").text(n[0].address),$(".event_description").text(n[0].description),$(".event_date").text(n[0].occurrenceTime),$(".detail_btn").attr("name",n[0].objectId);var s="";if($(".pic_des").html(""),i.length>0)for(var a=0;a<i.length;a++)s+='<li><img data-original="/cloudlink-core-file/file/downLoad?fileId='+i[a]+'" src="/cloudlink-core-file/file/getImageBySize?fileId='+i[a]+'&viewModel=fill&width=64&hight=64" id="imagesPic'+a+'" onclick="previewPicture(this)" alt=""/></li>';else $(".pic_des").html("无");if($(".eventpic_list ul").append(s),$(".event_audio_list").html(""),0==n[0].audio.length)$(".event_audio_list").html("无");else{var o='<button  class="audioPlay" onclick="playAmrAudio(\''+n[0].audio[0]+"',this)\"></button>";$(".event_audio_list").html(o)}}})},addPoints:function(){for(var e=[],t=0;t<this.eventPoints.length;t++)e.push(this.eventPoints[t].value);this.markerClusterer=new BMapLib.MarkerClusterer(mapObj.$bdMap,{markers:e})},removePoints:function(){if(this.eventPoints.length>0)for(var e=0;e<this.eventPoints.length;e++)this.markerClusterer.removeMarker(this.eventPoints[e].value)}},inspectObj={$inspectBtn:$(".inspectBtn"),$networkBtn:$(".networkBtn"),$search:$("#search_people"),$searchText:$(".search_people"),$inspectInformation:$("#accordion"),$inspectClosed:$(".close_inspect"),$tabInspectClosed:$("#people_closed"),$eventDate:$(".eventDate"),$lineDate:$(".inspectDate"),_inspectData:null,inspectStartPoints:[],inspectPoints:[],eventParameterObj:{status:"20,21,30",type:"",startDate:(new Date).Format("yyyy-MM-dd"),endDate:(new Date).Format("yyyy-MM-dd"),keyword:"",inspectorId:"",pageNum:1,pageSize:100},eventSearchObj:{},inspectParameterObj:{status:"1,0",startDate:(new Date).Format("yyyy-MM-dd"),endDate:(new Date).Format("yyyy-MM-dd"),keyword:"",userIds:"",pageNum:1,pageSize:100},inspectSearchObj:{},init:function(){var e=this;this.getInspectData(),this.getNewestData(),this.eventInspectLinkage(),this.bindDateDiyEvent(),this.getCurrentTime(),this.$search.click(function(){var t=e.$searchText.val().trim();e.searchData(t)}),this.$inspectBtn.click(function(){$(this).hasClass("active")?e.closeInspect():e.openInspect()}),this.$networkBtn.click(function(){$(this).hasClass("active")?($(this).removeClass("active"),pipeLineObj.removeLines()):($(this).addClass("active"),pipeLineObj.drawLines())}),$("#people .people").on("click","li",function(){var t=$(this).find("input[name=inspect_id]").val(),n=$(this).find("input[name=is_online]").val(),i=$(this).find("input[name=is_bdLon]").val();e.inspectTabListClick(t,n,i)}),this.$inspectClosed.click(function(){e.$inspectInformation.hide();for(var t=0;t<e.inspectPoints.length;t++)e.inspectPoints[t].value.setAnimation()}),this.$tabInspectClosed.click(function(){playerObj.close_player(function(){eventObj.getInitialPoints()}),e.resetInspect(),eventObj.resetevent()})},closeInspect:function(){this.$inspectBtn.removeClass("active"),this.removePoints(),this.$inspectInformation.hide()},openInspect:function(){this.$inspectBtn.addClass("active"),this.addPoints()},assignmentPoints:function(){for(var e=0;e<this.inspectPoints.length;e++)this.inspectStartPoints[e]=this.inspectPoints[e]},setInspectPointsMarker:function(e){this.removePoints();var t=this,n=null,i=null,s=null;this.inspectPoints=[];for(var a=0;a<e.length;a++)n=1==e[a].isOnline?mapObj.bdIconObj.inspectOn:mapObj.bdIconObj.inspecLeave,s=new BMap.Point(e[a].bdLon,e[a].bdLat),i=new BMap.Marker(s,{icon:n}),this.inspectPoints.push({key:e[a].objectId,name:e[a].userName,value:i,isOnline:e[a].isOnline,isBd:e[a].bdLon}),i.addEventListener("click",function(e){t.inspectPointClick(e)});this.addPoints()},inspectPointClick:function(e){for(var t=this,n=0;n<eventObj.eventPoints.length;n++)eventObj.eventPoints[n].value.setAnimation();for(var n=0;n<this.inspectPoints.length;n++)this.inspectPoints[n].value.setAnimation();var i=e.target;i.setAnimation(BMAP_ANIMATION_BOUNCE);for(var n=0;n<this.inspectPoints.length;n++)this.inspectPoints[n].value==i&&t.getAllDetails(this.inspectPoints[n].key,this.inspectPoints[n].isOnline,this.inspectPoints[n].isBd)},inspectTabListClick:function(e,t,n){var i=this;playerObj.close_player(function(){eventObj.getInitialPoints()}),this.$inspectBtn.hasClass("active")||this.addPoints(),this.$inspectBtn.addClass("active");for(var s=Enumerable.From(this._inspectData.rows).Where(function(t){return t.objectId==e}).Select(function(e){return e}).ToArray(),a=0,o=0;o<eventObj.eventPoints.length;o++)eventObj.eventPoints[o].value.setAnimation();for(var i=this,o=0;o<i.inspectPoints.length;o++)if(i.inspectPoints[o].key==e){a++,i.inspectPoints[o].value.setAnimation(BMAP_ANIMATION_BOUNCE);var l=i.inspectPoints[o].value.getPosition().lng,c=i.inspectPoints[o].value.getPosition().lat;mapObj.$bdMap.setCenter(new BMap.Point(l,c))}else i.inspectPoints[o].value.setAnimation();if(this.getAllDetails(e,t,n),!(a>0)&&0==s[0].isOnline){var p=new BMap.Point(s[0].bdLon,s[0].bdLat),r=new BMap.Marker(p),d=mapObj.bdIconObj.inspecLeave;r=new BMap.Marker(p,{icon:d}),mapObj.$bdMap.addOverlay(r),mapObj.$bdMap.setCenter(p),r.setAnimation(BMAP_ANIMATION_BOUNCE),this.inspectPoints.push({key:e,name:s[0].userName,value:r,isOnline:s[0].isOnline,isBd:s[0].bdLon}),r.addEventListener("click",function(e){i.inspectPointClick(e)})}},inspectOnline:function(e){var t=Enumerable.From(e).Where(function(e){return-1!==e.isOnline}).Select(function(e){return e}).ToArray(),n=Enumerable.From(e).Where(function(e){return e.isOnline>-1&&e.bdLon>0}).Select(function(e){return e}).ToArray();$(".inspectOnline").text(n.length),this.setInspectPointsMarker(t)},inspectInit:function(){$(".patrolNum").text(this._inspectData.rows.length),this.inspectOnline(this._inspectData.rows),this.setInspectTab(this._inspectData.rows)},searchData:function(e){var t=jsonFuzzyQuery(this._inspectData.rows,e,"userName,orgName,roleNames");this.inspectOnline(t),this.setInspectTab(t),this.$inspectInformation.hide(),mapObj.setPointsMarkerWithCenterPointAndZoomLevel(t),this.$inspectBtn.addClass("active")},resetInspect:function(){this.$inspectInformation.hide(),this.$searchText.val(""),this.inspectOnline(this._inspectData.rows),this.setInspectTab(this._inspectData.rows),this.$inspectBtn.addClass("active")},setInspectTab:function(e){$("#people .people ul").html("");var t=null;try{if(e.length>0)for(var n=0;n<e.length;n++){var i=e[n].roleNames,s=e[n].orgName;null!=i&&""!=i||(i="----"),null!=s&&""!=s||(s="----");var a=e[n].isOnline>-1&&+e[n].bdLon>0?"今日已巡":"今日未巡",o=e[n].isOnline>-1&&+e[n].bdLon>0?"active":"";t='<li><input type="hidden" name="inspect_id" value="'+e[n].objectId+'"><input type="hidden" name="is_online" value="'+e[n].isOnline+'"><input type="hidden" name="is_bdLon" value="'+e[n].bdLon+'"><span class="peoicon '+o+'">'+a+'</span><span class="name">'+e[n].userName+'</span><span class="dept">'+s+'</span><span class="task">'+i+"</span></li>",$("#people .people ul").append(t)}else t='<p style="text-align:center;">没有查询到您要数据！</p>',$("#people .people ul").append(t)}catch(e){t='<p style="text-align:center;">没有查询到您要数据！</p>',$("#people .people ul").append(t)}},getInspectData:function(){var e=this;$.ajax({type:"GET",url:"/cloudlink-inspection-event/inspectionMonitor/getListAuthority?token="+lsObj.getLocalStorage("token"),contentType:"application/json",dataType:"json",success:function(t,n){e._inspectData=t,e.inspectInit(),eventsAndInspectersLoadFinish(t.rows)}})},getNewestData:function(){$.ajax({type:"GET",url:"/cloudlink-inspection-analysis/patrolStatistical/getPatrolStatisticsData?token="+lsObj.getLocalStorage("token"),contentType:"application/json",dataType:"json",success:function(e,t){$(".eventNew").text(e.rows[0].eventCountToday)}})},getInspectDetails:function(e,t,n){var i=this;eventObj.$eventInformation.hide(),i.$inspectInformation.show(),$.ajax({type:"GET",url:"/cloudlink-inspection-analysis/mapStatistical/getUserStatistics?token="+lsObj.getLocalStorage("token")+"&inspectorId="+e,contentType:"application/json",dataType:"json",success:function(e,i){null!=e.rows[0].profilePhoto&&""!=e.rows[0].profilePhoto?$(".inspectImg").attr("src","/cloudlink-core-file/file/getImageBySize?fileId="+e.rows[0].profilePhoto+"&viewModel=fill&width=500&hight=500"):$(".inspectImg").attr("src","/src/images/main/photo.png"),1==t&&+n>0?($(".isOnline").attr({src:"/src/images/map/line.png",title:"在线"}),$(".status").css("background","#51b7ff"),$(".isPolling").text("今日已巡")):0==t&&+n>0?($(".isOnline").attr({src:"/src/images/map/Leave_line.png",title:"离线"}),$(".status").css("background","#51b7ff"),$(".isPolling").text("今日已巡")):($(".status").css("background","#b9b9b9"),$(".isPolling").text("今日未巡"),$(".isOnline").attr({src:"/src/images/map/Leave_line.png",title:"离线"})),$(".dynamicTitle").attr("title",e.rows[0].mobileNum),$(".inspectUseName").text(e.rows[0].userName);var s=e.rows[0].roleNames,a=e.rows[0].orgName;null!=s&&""!=s||(s="----"),null!=a&&""!=a||(a="----"),$(".inspectDepartment").text(a),$(".inspectRoleName").text(s),$(".inspectCount").text(e.rows[0].inspectTodayCount+" 次"),$(".inspectKm").text((e.rows[0].inspectTodayDistance/1e3).toFixed(2)+" km"),$(".inspectQi").text(e.rows[0].eventTodayCount+" 起")}})},addPoints:function(){for(var e=0;e<this.inspectPoints.length;e++){var t=new BMap.Label(this.inspectPoints[e].name,{offset:new BMap.Size(30,3)});1==this.inspectPoints[e].isOnline?t.setStyle({color:"#75c3fe",fontSize:"12px",border:"1px solid #75c3fe",padding:"3px"}):t.setStyle({color:"#999",fontSize:"12px",border:"1px solid #999",padding:"3px"}),this.inspectPoints[e].value.setLabel(t),mapObj.$bdMap.addOverlay(this.inspectPoints[e].value)}},removePoints:function(){for(var e=0;e<this.inspectPoints.length;e++)mapObj.$bdMap.removeOverlay(this.inspectPoints[e].value)},getEventPageList:function(){var e=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/eventInfo/web/v1/getPageList?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e.eventSearchObj),dataType:"json",success:function(e,t){if(1==e.success){$(".eventListPage").html("");var n="";if(e.rows.length>0)for(var i=0;i<e.rows.length;i++)n='<div class="record_details "><p class="pb10 pt10"><span class="fr5 width fl5">事件时间</span><span class="borderLeft fl block ">'+e.rows[i].createTime+'</span></p><p class = "pb10 pt10" ><span class = "fr5 width" > 事件类型 </span><span class="borderLeft fl block">'+e.rows[i].fullTypeName+'</span ></p><p class = "pb10 pt10"> <span class = "fr5 width">上报人</span><span class="borderLeft fl block">'+e.rows[i].inspectorName+'</span></p><p class = "pb10 pt10" > <span class = "fr5 width"> 事件状态</span><span class="borderLeft fl block">'+e.rows[i].statusValue+'</span> </p><button class = "viewDetails" name="'+e.rows[i].objectId+'" onclick="view_detail(this)"> 查看详情 </button></div>',$(".eventListPage").append(n);else n='<p style="text-align:center;min-height:152px;line-height:152px;">暂无相关数据</p>',$(".eventListPage").append(n)}$(".eventListPage").find("div").last().css("margin-bottom","0px")}})},getInspectionPageList:function(){var e=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/inspectionRecord/web/v1/getPageList?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e.inspectSearchObj),dataType:"json",success:function(e,t){if(1==e.success){var n="",i=null,s=null,a=(new Date).getTime(),o=null;if($(".peopleList").html(""),e.rows.length>0)for(var l=0;l<e.rows.length;l++)i=e.rows[l].flag,o=new Date(e.rows[l].endTime).getTime(),s=1==i?"已完成":a-o>3e5?"其他":"巡检中",n='<div class="record_details"><input type="hidden" name="inspect_id_m" value="'+e.rows[l].objectId+'"><input type="hidden" name="flag_m" value="'+e.rows[l].flag+'"><p class="pb10 pt10"><span class="fr5 width fl5">开始时间</span><span class="borderLeft fl block ">'+e.rows[l].beginTime+'</span></p><p class = "pb10 pt10" ><span class = "fr5 width" > 结束时间 </span><span class="borderLeft fl block">'+e.rows[l].endTime+'</span ></p><p class = "pb10 pt10"> <span class = "fr5 width">时长</span><span class="borderLeft fl block">'+e.rows[l].wholeTime+'</span></p><p class = "pb10 pt10" > <span class = "fr5 width"> 巡线状态</span><span class="borderLeft fl block">'+s+'</span> </p><p class="pb10 pt10"><span class="fr5 width">总里程</span><span class="borderLeft fl block peopleDistance">'+(e.rows[l].distance/1e3).toFixed(2)+' KM</span> </p><p class="pb10 pt10" style="height:23px;line-height:23px"><span class="fr5 width">轨迹回放</span><span class="borderLeft fl block"><img onclick="palyInspect(this)" src="/src/images/map/bofang.png" alt=""></span></p>',$(".peopleList").append(n);else n='<p style="text-align:center;line-height:152px;min-height:152px;">暂无相关数据</p>',$(".peopleList").append(n);$(".peopleList").find("div").last().css("margin-bottom","0px")}}})},getAllDetails:function(e,t,n){$.extend(this.inspectSearchObj,this.inspectParameterObj),this.inspectSearchObj.userIds=e,$.extend(this.eventSearchObj,this.eventParameterObj),this.eventSearchObj.inspectorId=e,this.getInspectDetails(e,t,n),this.getEventPageList(),this.searchEventByDate(),this.searchlineByDate(),this.getInspectionPageList()},eventSearchList:function(){this.getEventPageList()},InspectSearchList:function(){this.getInspectionPageList()},eventInspectLinkage:function(){$(".panel-heading").click(function(){var e=$(this).closest(".panel-default"),t=$(this).closest(".panel-default").siblings(".panel-default");e.find("div.collapse").is(":hidden")?(e.find("div.collapse").slideDown(),e.find(".panel-heading span").removeClass("glyphicon-menu-down").addClass("glyphicon-menu-up")):(e.find("div.collapse").slideUp(),e.find(".panel-heading span").removeClass("glyphicon-menu-up").addClass("glyphicon-menu-down")),t.find("div.collapse").slideUp(),t.find(".panel-heading span").removeClass("glyphicon-menu-up").addClass("glyphicon-menu-down")})},bindDateDiyEvent:function(){$("#datetimeStartEvent").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStartEvent").datetimepicker("setEndDate",$("#datetimeEndEvent").val())}),$("#datetimeEndEvent").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEndEvent").datetimepicker("setStartDate",$("#datetimeStartEvent").val()),$("#datetimeEndEvent").datetimepicker("setEndDate",new Date)}),$("#datetimeStartInspect").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStartInspect").datetimepicker("setEndDate",$("#datetimeEndInspect").val())}),$("#datetimeEndInspect").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEndInspect").datetimepicker("setStartDate",$("#datetimeStartInspect").val()),$("#datetimeEndInspect").datetimepicker("setEndDate",new Date)})},getCurrentTime:function(){var e=(new Date).Format("yyyy-MM-dd");$("#datetimeStartInspect").val(e),$("#datetimeEndInspect").val(e),$("#datetimeStartEvent").val(e),$("#datetimeEndEvent").val(e)},searchEventByDate:function(){var e=this;this.$eventDate.click(function(){var t=$("#datetimeStartEvent").val(),n=$("#datetimeEndEvent").val();e.eventSearchObj.startDate=t,e.eventSearchObj.endDate=n,e.getEventPageList()})},searchlineByDate:function(){var e=this;this.$lineDate.click(function(){var t=$("#datetimeStartInspect").val(),n=$("#datetimeEndInspect").val();e.inspectSearchObj.startDate=t,e.inspectSearchObj.endDate=n,e.getInspectionPageList()})}},tabObj={tabsTitle:$(".item_wrapper .item"),people:$("#people"),event:$("#_event"),location:$("#location"),tool:$("#tool"),closeBtn:$(".result_wrapper .close_btn"),refresh:$("#gf_refresh"),currentTab:null,init:function(){this.bindEvent()},bindEvent:function(){var e=this;e.tabsTitle.click(function(){var t=$(this).attr("data-tab");if("people"==t?inspectObj.$inspectBtn.hasClass("active")?eventObj.closeEvent():(eventObj.closeEvent(),inspectObj.openInspect()):"event"==t&&(playerObj.close_player(function(){eventObj.getInitialPoints()}),eventObj.$eventBtn.hasClass("active")?inspectObj.closeInspect():(inspectObj.closeInspect(),eventObj.openEvent())),t!==e.currentTab)return e.closeTip(),void e.showTip(t);e.closeTip(),$(this).removeClass("active")}),e.closeBtn.click(function(){e.closeTip()}),e.refresh.click(function(){location.reload()})},requestPeople:function(){},showTip:function(e){var t=this;e&&($("#"+e+"_title").addClass("active"),t[e].removeClass("hide"),t.currentTab=e)},closeTip:function(){var e=this;e.currentTab&&($("#"+e.currentTab+"_title").removeClass("active"),e[e.currentTab].addClass("hide"),e.currentTab=null)}},taskDetailsObj={_taskId:null,init:function(){},loadDetails:function(e){$("#details").modal(),this.loadEventDetails(e),this.loadTaskDetails(e)},loadEventDetails:function(e){$.ajax({type:"GET",url:"/cloudlink-inspection-event/eventInfo/get?token="+lsObj.getLocalStorage("token")+"&eventId="+e,contentType:"application/json",dataType:"json",success:function(e,t){var n=e.rows,i=n[0].pic;if($(".event_pic ul").html(""),$(".eventCode").text(n[0].eventCode),$(".occurrenceTime").text(n[0].occurrenceTime),$(".fullTypeName").text(n[0].fullTypeName),$(".inspectorName").text(n[0].inspectorName),$(".address").text(n[0].address),$(".description").text(n[0].description),0==n[0].audio.length)$(".event_audio").html("无");else{var s='<button class="audioPlay" onclick="playAmrAudio(\''+n[0].audio[0]+"',this)\"></button>";$(".event_audio").html(s)}var a="";if(i.length>0)for(var o=0;o<i.length;o++)a+='<li class="event_pic_list"><img data-original="/cloudlink-core-file/file/downLoad?fileId='+i[o]+'" src="/cloudlink-core-file/file/getImageBySize?fileId='+i[o]+'&viewModel=fill&width=104&hight=78" id="imagesPic'+o+'" onclick="previewPicture(this)" alt=""/></li>';else a="<span>无</span>";$(".event_pic ul").append(a)}})},loadTaskDetails:function(e){$.ajax({type:"GET",url:"/cloudlink-inspection-task/dispose/getPageListByEventId?token="+lsObj.getLocalStorage("token")+"&bizId="+e,contentType:"application/json",dataType:"json",success:function(e,t){""==e.rows[0].taskCode?$(".taskCode").text("无"):$(".taskCode").text(e.rows[0].taskCode),$(".dispose_content").html("");var n=e.rows[0].disposeList;if(n.length>0){for(var i="",s=[],a="",o=0;o<n.length;o++)a!=n[o].modifyday&&(s.push(n[o].modifyday),a=n[o].modifyday);for(var l=0;l<s.length;l++){i='<div class="dispose_date" id="day_'+l+'"><div class="dispose_day"><div class="day_dian"></div><div class="day_time">'+s[l]+"</div></div></div>",$(".dispose_content").append(i);for(var c=0;c<n.length;c++){var p="";if(n[c].modifyday==s[l]){var r=n[c].recevieUserName;if(null!=r&&""!=r||(r="无"),p=0==n[c].typeCode||40==n[c].typeCode?'<div class="dispose_main"><div class="dispose_main_l"><span class="dispose_time">'+n[c].modifytime+'</span></div><div class="dispose_main_r"><div class="dispose_info"><span class="modifyUserName">'+n[c].modifyUserName+'</span>&nbsp&nbsp<span class="disposeValue">'+n[c].disposeValue+'</span></div><div class="dispose_info"><span class="info_l text-right">信息描述：</span><div class="info_r">'+n[c].content+'</div></div><div class="dispose_info"><span class="info_l text-right">接收人：</span><div class="info_r">'+r+"</div></div></div></div>":'<div class="dispose_main"><div class="dispose_main_l"><span class="dispose_time">'+n[c].modifytime+'</span></div><div class="dispose_main_r"><div class="dispose_info"><span class="modifyUserName">'+n[c].modifyUserName+'</span>&nbsp&nbsp<span class="disposeValue">'+n[c].disposeValue+'</span></div><div class="dispose_info"><span class="info_l text-right">信息描述：</span><div class="info_r">'+n[c].content+'</div></div><div class="dispose_info"><span class="info_l text-right">语音描述：</span><div class="info_r task_audio_'+c+'"></div></div><div class="dispose_info"><span class="info_l text-right">接收人：</span><div class="info_r">'+r+'</div></div><div class="dispose_info"><span class="info_l text-right">照片：</span><div class="info_r"><ul class="taskImg_'+c+'"></ul></div></div></div></div>',$("#day_"+l).append(p),0==n[c].audio.length)$(".task_audio_"+c).html("无");else{var d='<button  class="audioPlay" onclick="playAmrAudio(\''+n[c].audio[0]+"',this)\"></button>";$(".task_audio_"+c).html(d)}var v=n[c].pic,h="";if(v.length>0)for(var u=0;u<v.length;u++)h+='<li class="task_pic_list"><img data-original="/cloudlink-core-file/file/downLoad?fileId='+v[u]+'" src="/cloudlink-core-file/file/getImageBySize?fileId='+v[u]+'&viewModel=fill&width=104&hight=78" id="taskImagesPic'+u+'" onclick="previewPicture(this)" alt=""/></li>';else h="<span>无</span>";$(".taskImg_"+c).append(h)}}}}else{$(".dispose_content").html("<p style='text-align:center;background:#fff;margin:0;'>本事件无处置信息！</p>")}}})}},aEventsAndInspecters=[],loadCount=0;