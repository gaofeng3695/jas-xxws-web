function dateChangeForSearchGas(){var e=$("#datetimeStartGas").val(),t=$("#datetimeEndGas").val();""!=e&&""!==t?$("#diyDateBtnGas").addClass("active"):$("#diyDateBtnGas").removeClass("active")}function dateChangeForSearchPressure(){var e=$("#datetimeStartPressure").val(),t=$("#datetimeEndPressure").val();""!=e&&""!==t?$("#diyDateBtnPressure").addClass("active"):$("#diyDateBtnPressure").removeClass("active")}function handleFiles(e){fileObj.handleFiles(e)}function closeImg(e){var t=$(e).attr("data-key");$(e).closest(".feedback_images").remove(),$(".feedback_img_file input[name=file]").each(function(){$(this).attr("data-value")==t&&$(this).remove()})}function deleteImg(e){var t=$(e).attr("data-key");$(e).closest(".feedback_images").remove(),facilityFrame._deleteImgs.push(t)}function dateChangeForSearch(){var e=$("#datetimeStart").val(),t=$("#datetimeEnd").val();""!=e&&""!==t?$("#diyDateBtn").addClass("active"):$("#diyDateBtn").removeClass("active")}var facility={$addFacility:$("#addFacility"),$locationBtn:$("#map_choice"),init:function(){var e=this;e.$addFacility.click(function(){facilityFrame.$addFacilityFrame.modal()}),e.$locationBtn.click(function(){var e=$("#tableFacility").bootstrapTable("getSelections");if(0==e.length)return xxwsWindowObj.xxwsAlert("请选择你要展示的信息！"),!1;facilityMapObj.mapSetCenter(e)})}},facilityMapObj={$bdMap:new BMap.Map("facilityMap"),$detailsAddressMap:new BMap.Map("detailsAddressMap"),$mapCon:$("#facilityMap"),$mapBtn:$(".bottom_btn span"),aCurrentPoints:[],init:function(){var e=this;e.mapLoad(),e.$mapBtn.click(function(){e.mapSwitch()})},mapLoad:function(){this.$bdMap.centerAndZoom(new BMap.Point(116.404,39.915),5),this.$bdMap.enableScrollWheelZoom(!0);var e=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT}),t=new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});this.$bdMap.addControl(e),this.$bdMap.addControl(t),this.$bdMap.addControl(new BMap.MapTypeControl),this.$detailsAddressMap.centerAndZoom(new BMap.Point(116.404,39.915),15),this.$detailsAddressMap.enableScrollWheelZoom(!0)},bdIconFn:function(e){var t;switch(e){case"FT_01":t=new BMap.Icon("/src/images/facility/facility_type_01.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_02":t=new BMap.Icon("/src/images/facility/facility_type_02.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_03":t=new BMap.Icon("/src/images/facility/facility_type_03.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_04":t=new BMap.Icon("/src/images/facility/facility_type_04.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_05":t=new BMap.Icon("/src/images/facility/facility_type_05.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_06":t=new BMap.Icon("/src/images/facility/facility_type_06.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_07":t=new BMap.Icon("/src/images/facility/facility_type_07.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_08":t=new BMap.Icon("/src/images/facility/facility_type_08.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_09":t=new BMap.Icon("/src/images/facility/facility_type_09.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_10":t=new BMap.Icon("/src/images/facility/facility_type_10.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_11":t=new BMap.Icon("/src/images/facility/facility_type_11.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;case"FT_99":t=new BMap.Icon("/src/images/facility/facility_type_99.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)});break;default:t=new BMap.Icon("/src/images/facility/facility_type_99.png",new BMap.Size(35,35),{anchor:new BMap.Size(17,17)})}return t},mapSwitch:function(){this.$mapCon.is(":hidden")?this.show():this.hide()},hide:function(){this.$mapCon.slideUp(),this.$mapBtn.attr("class","map_down")},show:function(){this.$mapCon.slideDown(),this.$mapBtn.attr("class","map_up")},mapSetCenter:function(e){var t=this;t.$bdMap.clearOverlays(),t.aCurrentPoints=[];var a=e.length,i=[];try{for(var n=0;n<a;n++)""!=e[n].bdLon&&""!=e[n].bdLat&&i.push(new BMap.Point(e[n].bdLon,e[n].bdLat));if(i.length>0)t.$bdMap.setViewport(i,{zoomFactor:-1});else{var r=new BMap.Point(116.404,39.915);t.$bdMap.centerAndZoom(r,5)}}catch(e){var r=new BMap.Point(116.404,39.915);t.$bdMap.centerAndZoom(r,5)}t.addPoints(e)},addPoints:function(e){var t=this,a=null,i=null,n=null,r=null;if(e.length>0)for(var l=0;l<e.length;l++)a="<div><p>设施名称："+e[l].facilityName+"</p><p>设施编号："+e[l].facilityCode+"</p><p>设施类型："+e[l].facilityTypeName+"</p></div>",r=new BMap.Point(e[l].bdLon,e[l].bdLat),i=t.bdIconFn(e[l].facilityTypeCode),n=new BMap.Marker(r,{icon:i}),t.$bdMap.addOverlay(n),t.aCurrentPoints.push({key:e[l].objectId,value:n}),t.addClickHandler(a,n)},addClickHandler:function(e,t){var a=this;t.addEventListener("click",function(t){a.openInfo(e,t)})},openInfo:function(e,t){var a=this,i={width:250,height:80,enableMessage:!0},n=t.target,r=new BMap.Point(n.getPosition().lng,n.getPosition().lat),l=new BMap.InfoWindow(e,i);a.$bdMap.openInfoWindow(l,r)},locationClick:function(e){for(var t=this,a=0,i=0;i<t.aCurrentPoints.length;i++)t.aCurrentPoints[i].key==e.objectId?(a++,t.aCurrentPoints[i].value.setAnimation(BMAP_ANIMATION_BOUNCE),t.$bdMap.setCenter(t.aCurrentPoints[i].value.point)):t.aCurrentPoints[i].value.setAnimation();if(!(a>0)){var n=[];n.push(e),t.addPoints(n);var r=t.aCurrentPoints.length;t.aCurrentPoints[r-1].value.setAnimation(BMAP_ANIMATION_BOUNCE),t.$bdMap.setCenter(new BMap.Point(e.bdLon,e.bdLat))}}},facilityFrame={$addFacilityFrame:$("#addFacilityFrame"),$modifyFacilityFrame:$("#modifyFacilityFrame"),$facilityDetailsFrame:$("#facilityDetailsFrame"),$addressMapFrame:$("#addressMapFrame"),$personFrame:$("#stakeholder"),$historyFrame:$("#historyFrame"),$historyDetailsFrame:$("#historyDetailsFrame"),$measurementFrame:$("#measurementFrame"),$addPerson:$(".facilityAdd input[name=personSelect]"),$modifyPerson:$(".facilityModify input[name=personSelect]"),$addAddress:$(".facilityAdd input[name=addressSelect]"),$modifyAddress:$(".facilityModify input[name=addressSelect]"),_selectPersonArr:[],$dataPass:$(".dataPass"),$personBtn:$("#btn_selectPeople"),$deleteFacilityBtn:$(".deleteFacility"),$getHistoryBtn:$(".getHistory"),$getMeasurementBtn:$(".getMeasurement"),temporaryObj:{name:null,lng:null,lat:null,gpsLon:null,gpsLat:null},_facilityId:null,_recordId:null,_addressEdit:null,_personEdit:null,_flag:!0,_imgLengthAdd:0,_deleteImgs:[],_facilityTypeCode:null,init:function(){var e=this;e.$addFacilityFrame.on("shown.bs.modal",function(t){document.getElementById("addFacilityFrameT").scrollTop=0,e.temporaryObj.name=null,e.temporaryObj.lng=null,e.temporaryObj.lat=null,e.temporaryObj.gpsLon=0,e.temporaryObj.gpsLat=0,e.$addFacilityFrame.find("input[name=inspectionCount]").val(0),e.$addFacilityFrame.find("input[name=inspectionDays]").val(1),e.$addFacilityFrame.find("input[name=createUserName]").val(JSON.parse(lsObj.getLocalStorage("userBo")).userName),e.$addAddress.val(""),e.$addPerson.val(""),e._selectPersonArr=[]}),e.$modifyFacilityFrame.on("shown.bs.modal",function(t){document.getElementById("modifyFacilityFrameT").scrollTop=0,e._deleteImgs=[],e.getModifyData(e._facilityId)}),e.$addAddress.click(function(){e._addressEdit=!1,e.$addressMapFrame.modal()}),e.$modifyAddress.click(function(){e._addressEdit=!0,e.$addressMapFrame.modal()}),e.$addressMapFrame.on("shown.bs.modal",function(t){1==e._addressEdit?addressMapObj.drawPoint(e.$modifyFacilityFrame,e.temporaryObj):addressMapObj.drawPoint(e.$addFacilityFrame,e.temporaryObj)}),e.$dataPass.click(function(){var t=addressMapObj.getPoint();t.key==e.$addFacilityFrame?e.$addAddress.val(t.value.name):t.key==e.$modifyFacilityFrame&&e.$modifyAddress.val(t.value.name),$.extend(e.temporaryObj,t.value)}),e.$addPerson.click(function(){e._personEdit=!1,e.$personFrame.modal()}),e.$modifyPerson.click(function(){e._personEdit=!0,e.$personFrame.modal()}),e.$personFrame.on("shown.bs.modal",function(t){1==e._personEdit?peopleTreeObj.requestPeopleTree(e.$modifyFacilityFrame,e._selectPersonArr):peopleTreeObj.requestPeopleTree(e.$addFacilityFrame,e._selectPersonArr)}),this.$personBtn.click(function(){var t=peopleTreeObj.getSelectPeople();e._selectPersonArr=[],t.key==e.$addFacilityFrame?e.$addPerson.val(t.selectedName):t.key==e.$modifyFacilityFrame&&e.$modifyPerson.val(t.selectedName);for(var a=0;a<t.selectedArr.length;a++)e._selectPersonArr[a]=t.selectedArr[a]}),$(".addSubmit").click(function(){if(1==e._flag){var t=e.formVerification($(".facilityAdd"));if(0==t)return;var a={tip:"您是否确定新建设施？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e._imgLengthAdd=0,e._facilityId=baseOperation.createuuid(),t.objectId=e._facilityId,e.facilityAdd(t)}};xxwsWindowObj.xxwsAlert(a)}}),$(".modifySubmit").click(function(){if(1==e._flag){var t=e.formVerification($(".facilityModify"));if(0==t)return;t.objectId=e._planId;var a={tip:"您是否确定修改该设施？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e._imgLengthAdd=0,t.objectId=e._facilityId,e.facilityJudge(t)}};xxwsWindowObj.xxwsAlert(a)}}),e.$facilityDetailsFrame.on("shown.bs.modal",function(t){document.getElementById("facilityDetailsFrameT").scrollTop=0,e.facilityDetails(e._facilityId)}),e.$getHistoryBtn.click(function(){repairObj.openHistoryFrame(e._facilityId)}),e.$historyFrame.on("shown.bs.modal",function(t){document.getElementById("historyFrameT").scrollTop=0,facilityTable.getHistoryTable(e._facilityId,e._facilityTypeCode)}),historyDetailsObj.$historyDetailsFrame.on("shown.bs.modal",function(t){document.getElementById("historyDetailsFrameT").scrollTop=0,historyDetailsObj.geiHistoryDetails(e._recordId)}),e.$deleteFacilityBtn.click(function(){var t={tip:"您是否删除该设施，同时删除相关的检查记录？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){e.facilityDelete(e._facilityId)}};return xxwsWindowObj.xxwsAlert(t),!1}),e.$getMeasurementBtn.click(function(){e.$measurementFrame.modal(),facilityChart.clearAll()}),e.$measurementFrame.on("shown.bs.modal",function(t){document.getElementById("measurementFrameT").scrollTop=0,facilityChart.getGasData(e._facilityId),"FT_01"==e._facilityTypeCode&&($(".pressureMain").show(),facilityChart.getPressureData(e._facilityId))})},clearfacilityDetails:function(){$(".facilityNameT").text("---"),$(".facilityCodeT").text("---"),$(".createTimeT").text("---"),$(".facilityTypeNameT").text("---"),$(".pipelineTypeNameT").text("---"),$(".facilityStatusNameT").text("---"),$(".addressT").text("---"),$(".manufacturerT").text("---"),$(".investmentTimeT").text("---"),$(".installationTimeT").text("---"),$(".specificationT").text("---"),$(".relationshipPersonNamesT").text("---"),$(".inspectionFrequencyT").text("---"),$(".facilityImg").html("<span>无</span>"),$(".createUserNameT").text("---"),this.$deleteFacilityBtn.hide(),facilityMapObj.$detailsAddressMap.clearOverlays()},facilityDetails:function(e){var t=this,a={objectId:e};$.ajax({type:"GET",url:"/cloudlink-inspection-event/facility/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:a,dataType:"json",success:function(e){if(1==e.success){t._facilityId=e.rows[0].objectId,t._facilityTypeCode=e.rows[0].facilityTypeCode,$(".facilityNameT").text(e.rows[0].facilityName),$(".facilityCodeT").text(e.rows[0].facilityCode),$(".createTimeT").text(e.rows[0].createTime),$(".facilityTypeNameT").text(e.rows[0].facilityTypeName),$(".pipelineTypeNameT").text(e.rows[0].pipelineTypeName),$(".facilityStatusNameT").text(e.rows[0].facilityStatusName),$(".addressT").text(e.rows[0].address),$(".manufacturerT").text(e.rows[0].manufacturer),$(".investmentTimeT").text(e.rows[0].investmentTime),$(".installationTimeT").text(e.rows[0].installationTime),$(".specificationT").text(e.rows[0].specification),$(".relationshipPersonNamesT").text(e.rows[0].relationshipPersonNames),$(".inspectionFrequencyT").text(e.rows[0].inspectionFrequency),$(".facilityImg").html("<span>无</span>"),$(".createUserNameT").text(e.rows[0].createUserName);var a=new BMap.Point(e.rows[0].bdLon,e.rows[0].bdLat),i=new BMap.Marker(a);facilityMapObj.$detailsAddressMap.addOverlay(i),facilityMapObj.$detailsAddressMap.setCenter(a);var n=JSON.parse(lsObj.getLocalStorage("userBo")).objectId;1==JSON.parse(lsObj.getLocalStorage("userBo")).isSysadmin?t.$deleteFacilityBtn.show():e.rows[0].createUserId==n?t.$deleteFacilityBtn.show():t.$deleteFacilityBtn.hide();var r="";if(e.rows[0].pic.length>0){for(var l=0;l<e.rows[0].pic.length;l++)r+='<li class="event_pic_list"><img  src="/cloudlink-core-file/file/getImageBySize?fileId='+e.rows[0].pic[l]+'&viewModel=fill&width=104&hight=78" data-original="/cloudlink-core-file/file/downLoad?fileId='+e.rows[0].pic[l]+'" onclick="previewPicture(this)" alt=""/></li>';$(".facilityImg").html(r)}}else xxwsWindowObj.xxwsAlert("获取设施详情失败")},error:function(){xxwsWindowObj.xxwsAlert("获取设施详情失败")}})},facilityDelete:function(e){var t={objectId:e};$.ajax({type:"POST",url:"/cloudlink-inspection-event/facility/delete?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(e,t){if(1==e.success){var a={tip:"设施删除成功！",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(a)}else 410==e.code?xxwsWindowObj.xxwsAlert("您没有删除设施的权限！"):xxwsWindowObj.xxwsAlert("设施删除失败！")}})},getModifyData:function(e){var t=this,a={objectId:e};$.ajax({type:"GET",url:"/cloudlink-inspection-event/facility/get?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:a,dataType:"json",success:function(e){if(1==e.success){t._facilityId=e.rows[0].objectId,$(".facilityModify").find("input[name=facilityName]").val(e.rows[0].facilityName),$(".facilityModify").find("input[name=facilityCode]").val(e.rows[0].facilityCode),$(".facilityModify").find("input[name=addressSelect]").val(e.rows[0].address),$(".facilityModify").find("input[name=manufacturer]").val(e.rows[0].manufacturer),$(".facilityModify").find("input[name=specification]").val(e.rows[0].specification),$(".facilityModify").find("input[name=inspectionCount]").val(e.rows[0].inspectionCount),$(".facilityModify").find("input[name=inspectionDays]").val(e.rows[0].inspectionDays),$(".facilityModify").find("input[name=investmentTime]").val(e.rows[0].investmentTime),$(".facilityModify").find("input[name=installationTime]").val(e.rows[0].installationTime),$(".facilityModify").find("input[name=personSelect]").val(e.rows[0].relationshipPersonNames),$(".facilityModify").find("input[name=createUserName]").val(e.rows[0].createUserName),$(".facilityModify").find("select[name=facilityTypeCode]").val(e.rows[0].facilityTypeCode),$(".facilityModify").find("select[name=pipelineTypeCode]").val(e.rows[0].pipelineTypeCode),$(".facilityModify").find("select[name=facilityStatusCode]").val(e.rows[0].facilityStatusCode),t.temporaryObj.name=e.rows[0].address,t.temporaryObj.lng=e.rows[0].bdLon,t.temporaryObj.lat=e.rows[0].bdLat,t.temporaryObj.gpsLon=e.rows[0].lon,t.temporaryObj.gpsLat=e.rows[0].lat,t._selectPersonArr=[];for(var a=0;a<e.rows[0].relationshipPersonList.length;a++)t._selectPersonArr[a]=e.rows[0].relationshipPersonList[a];var i="";if(e.rows[0].pic.length>0){for(var a=0;a<e.rows[0].pic.length;a++)i+='<div class="feedback_images"><img src="/cloudlink-core-file/file/getImageBySize?fileId='+e.rows[0].pic[a]+'&viewModel=fill&width=104&hight=78" alt=""><span onclick="deleteImg(this);" data-key="'+e.rows[0].pic[a]+'"></span></div>';$(".facilityModify .feedback_img_list").html(i)}}else xxwsWindowObj.xxwsAlert("获取设施修改信息失败")},error:function(){xxwsWindowObj.xxwsAlert("获取设施修改信息失败")}})},formVerification:function(e){for(var t=this,a=e.find("input[name=facilityName]").val().trim(),i=e.find("input[name=facilityCode]").val().trim(),n=e.find("input[name=addressSelect]").val().trim(),r=e.find("input[name=manufacturer]").val().trim(),l=e.find("input[name=specification]").val().trim(),s=e.find("input[name=inspectionCount]").val().trim(),o=e.find("input[name=inspectionDays]").val().trim(),d=/^[1-9]\d*|0$/,c=""==e.find("input[name=investmentTime]").val()?null:e.find("input[name=investmentTime]").val(),m=""==e.find("input[name=installationTime]").val()?null:e.find("input[name=installationTime]").val(),f=[],p=0;p<t._selectPersonArr.length;p++)f[p]=t._selectPersonArr[p];if(""==a||null==a)return xxwsWindowObj.xxwsAlert("请输入设施名称"),!1;if(a.length>25)return xxwsWindowObj.xxwsAlert("设施名称过长，填写上限为25个字"),!1;if(""==i||null==i)return xxwsWindowObj.xxwsAlert("请输入设施编号"),!1;if(i.length>25)return xxwsWindowObj.xxwsAlert("设施编号过长，填写上限为25个字"),!1;if(""==n||null==n)return xxwsWindowObj.xxwsAlert("请输入详细位置"),!1;if(r.length>25)return xxwsWindowObj.xxwsAlert("生产厂家字数过长，填写上限为25个字"),!1;if(l.length>100)return xxwsWindowObj.xxwsAlert("规格字数过长，填写上限为100个字"),!1;if(d.test(s)){if(s.length>3)return xxwsWindowObj.xxwsAlert("巡检频次次数过多"),!1;if(d.test(o)){if(o.length>3)return xxwsWindowObj.xxwsAlert("巡检频次天数过大"),!1;return{facilityName:a,facilityCode:i,address:n,facilityTypeCode:e.find("select[name=facilityTypeCode]").val(),pipelineTypeCode:e.find("select[name=pipelineTypeCode]").val(),facilityStatusCode:e.find("select[name=facilityStatusCode]").val(),manufacturer:r,specification:l,investmentTime:c,installationTime:m,inspectionCount:s,inspectionDays:o,bdLon:t.temporaryObj.lng,bdLat:t.temporaryObj.lat,lon:t.temporaryObj.gpsLon,lat:t.temporaryObj.gpsLat,relationshipPersonList:f}}return xxwsWindowObj.xxwsAlert("巡检频次天数格式不对"),!1}return xxwsWindowObj.xxwsAlert("巡检频次次数格式不对"),!1},facilityAdd:function(e){var t=this;t._flag=!1;var a=$(".facilityFileAdd .feedback_img_file").find("input[name=file]").length;if(t._imgLengthAdd<a){var i=$(".facilityFileAdd .feedback_img_file").find("input[name=file]").eq(t._imgLengthAdd).attr("id");t.facilityFileAdd(i,e)}else t.facilityDataAdd(e)},facilityFileAdd:function(e,t){var a=this;$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+a._facilityId+"&bizType=pic&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:e,dataType:"json",type:"POST",async:!1,success:function(e,i){1==e.success?(a._imgLengthAdd++,a.facilityAdd(t)):xxwsWindowObj.xxwsAlert("照片上传失败，请重试",function(){a._imgLengthAdd=0,a.again()})}})},facilityDataAdd:function(e){var t=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/facility/save?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e),dataType:"json",success:function(e){if(1==e.success){t.$addFacilityFrame.modal("hide");var a={tip:"添加设施成功",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(a)}else xxwsWindowObj.xxwsAlert("添加设施失败");t.again()},error:function(){xxwsWindowObj.xxwsAlert("添加设施失败"),t.again()}})},facilityJudge:function(e){var t=this;t._flag=!1;var a={objectId:t._facilityId,facilityTypeCode:e.facilityTypeCode};$.ajax({type:"POST",url:"/cloudlink-inspection-event/facility/judgeCodeForUpdate?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(a){1==a.success?t.facilityFileDelete(e):"XE04001"==a.code?(xxwsWindowObj.xxwsAlert("修改设施失败,设施下已经存在检查记录，设施类型不能被修改"),t.again()):(xxwsWindowObj.xxwsAlert("修改设施失败"),t.again())},error:function(){xxwsWindowObj.xxwsAlert("修改设施失败"),t.again()}})},facilityFileDelete:function(e){var t=this;if(t._deleteImgs.length>0){var a={businessId:t._facilityId,fileIds:t._deleteImgs,bizType:"pic"};$.ajax({type:"POST",url:"/cloudlink-core-file/attachment/deleteByBizIdAndBizAttrAndFileIds?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(a){1==a.success?t.facilityModify(e):(xxwsWindowObj.xxwsAlert("修改设施失败"),t.again())},error:function(){xxwsWindowObj.xxwsAlert("修改设施失败"),t.again()}})}else t.facilityModify(e)},facilityModify:function(e){var t=this,a=$(".facilityModify .feedback_img_file").find("input[name=file]").length;if(t._imgLengthAdd<a){var i=$(".facilityModify .feedback_img_file").find("input[name=file]").eq(t._imgLengthAdd).attr("id");t.facilityFileModify(i,e)}else t.facilityDataModify(e)},facilityFileModify:function(e,t){var a=this;$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+a._facilityId+"&bizType=pic&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:e,dataType:"json",type:"POST",async:!1,success:function(e,i){1==e.success?(a._imgLengthAdd++,a.facilityModify(t)):xxwsWindowObj.xxwsAlert("照片上传失败，请重试",function(){a._imgLengthAdd=0,a.again()})}})},facilityDataModify:function(e){var t=this;$.ajax({type:"POST",url:"/cloudlink-inspection-event/facility/update?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(e),dataType:"json",success:function(e){if(1==e.success){t.$modifyFacilityFrame.modal("hide");var a={tip:"修改设施成功",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!1,callBack:function(){window.location.reload()}};xxwsWindowObj.xxwsAlert(a)}else xxwsWindowObj.xxwsAlert("修改设施失败");t.again()},error:function(){xxwsWindowObj.xxwsAlert("修改设施失败"),t.again()}})},again:function(){this._flag=!0}},facilityChart={$timeBtn:$(".timeBtn"),$timePressure:$(".timePressure"),gasChart:null,pressureChart:null,_ObjId:null,gasParam:{startDate:"2017-05-01",endDate:"2017-05-20",facilityId:""},pressureParam:{startDate:"2017-05-01",endDate:"2017-05-20",facilityId:""},init:function(){var e=this;e.gasChart=echarts.init(document.getElementById("gasChart")),e.pressureChart=echarts.init(document.getElementById("pressureChart")),e.timeEvent(),e.$timeBtn.click(function(){var t=$(this).closest(".chartCondition").attr("data-key"),a=$(this).attr("data-value");if("diy"===a){if(0==e.diyTime(t))return!1}else e.setTime(t,a);var i={};i[t]=a,e.renderActive(i),"gas"==t?e.getGasData():e.getPressureData()})},getGasData:function(e){var t=this;e?(t._ObjId=e,t.gasParam.facilityId=e):t.gasParam.facilityId=t._ObjId,$.ajax({type:"POST",url:"/cloudlink-inspection-event/facilityRecord/getCombustibleGasConcentrationByFacilityCheckTime?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t.gasParam),dataType:"json",success:function(e){if(1==e.success){var a=[],i=[];if(e.rows.length>0)for(var n=0;n<e.rows.length;n++)a.push(e.rows[n].facilityCheckTime),i.push(e.rows[n].combustibleGasConcentration);t.gasChartParam(a,i)}else xxwsWindowObj.xxwsAlert("获取可燃气浓度数据失败")},error:function(){xxwsWindowObj.xxwsAlert("获取可燃气浓度数据失败")}})},gasChartParam:function(e,t){var a=this;option={tooltip:{trigger:"item",formatter:"{b} <br/>{a} : {c}"},color:["#59b6fc"],legend:{left:"left",data:["浓度"]},xAxis:{type:"category",name:"时间",splitLine:{show:!1},nameGap:5,data:e},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},yAxis:{type:"value",name:"浓度（ppm）"},series:[{name:"浓度（ppm）",type:"bar",data:t,barWidth:20}]},a.gasChart.setOption(option)},getPressureData:function(e){var t=this;e?(t._ObjId=e,t.pressureParam.facilityId=e):t.pressureParam.facilityId=t._ObjId,$.ajax({type:"POST",url:"/cloudlink-inspection-event/facilityRecord/getInOutPressureByFacilityCheckTime?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t.pressureParam),dataType:"json",success:function(e){if(1==e.success){var a=[],i=[],n=[];if(e.rows.length>0)for(var r=0;r<e.rows.length;r++)a.push(e.rows[r].facilityCheckTime),i.push(e.rows[r].pressureIn),n.push(e.rows[r].pressureOut);t.gasPressureParam(a,i,n)}else xxwsWindowObj.xxwsAlert("获取进出口压力数据失败")},error:function(){xxwsWindowObj.xxwsAlert("获取进出口压力数据失败")}})},gasPressureParam:function(e,t,a){var i=this;option={tooltip:{trigger:"item",formatter:"{b} <br/>{a} : {c}"},legend:{left:"left",data:["进口压力","出口压力"]},xAxis:{type:"category",name:"时间",splitLine:{show:!1},nameGap:5,data:e},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},yAxis:{type:"value",name:"压力（kPa）"},series:[{name:"进口压力",type:"line",data:t},{name:"出口压力",type:"line",data:a}]},i.pressureChart.setOption(option)},diyTime:function(e){var t=this;if("gas"==e){var a=$("#datetimeStartGas").val(),i=$("#datetimeEndGas").val();if(!a)return xxwsWindowObj.xxwsAlert("请选择起始时间"),!1;if(!i)return xxwsWindowObj.xxwsAlert("请选择结束时间"),!1;t.gasParam.startDate=a,t.gasParam.endDate=i}else{var a=$("#datetimeStartPressure").val(),i=$("#datetimeEndPressure").val();if(!a)return xxwsWindowObj.xxwsAlert("请选择起始时间"),!1;if(!i)return xxwsWindowObj.xxwsAlert("请选择结束时间"),!1;t.pressureParam.startDate=a,t.pressureParam.endDate=i}return!0},setTime:function(e,t){var a=this,i=new Date;switch(t){case"week":"gas"==e?(a.gasParam.startDate=i.getWeekStartDate().Format("yyyy-MM-dd"),a.gasParam.endDate=i.getWeekEndDate().Format("yyyy-MM-dd")):(a.pressureParam.startDate=i.getWeekStartDate().Format("yyyy-MM-dd"),a.pressureParam.endDate=i.getWeekEndDate().Format("yyyy-MM-dd"));break;case"month":"gas"==e?(a.gasParam.startDate=i.getMonthStartDate().Format("yyyy-MM-dd"),a.gasParam.endDate=i.getMonthEndDate().Format("yyyy-MM-dd")):(a.pressureParam.startDate=i.getMonthStartDate().Format("yyyy-MM-dd"),a.pressureParam.endDate=i.getMonthEndDate().Format("yyyy-MM-dd"));break;default:"gas"==e?(a.gasParam.startDate="",a.gasParam.endDate=""):(a.pressureParam.startDate="",a.pressureParam.endDate="")}},renderActive:function(e){var t=this;e||(e=t.activeObj);for(var a in e){var i=t.$timeBtn.parent("[data-key="+a+"]");i.find("span").removeClass("active"),i.find('.timeBtn[data-value="'+e[a]+'"]').addClass("active"),"diy"===e[a]&&i.find(".diy").addClass("active")}},timeEvent:function(){$("#datetimeStartGas").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStartGas").datetimepicker("setEndDate",$("#datetimeEndGas").val())}),$("#datetimeEndGas").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEndGas").datetimepicker("setStartDate",$("#datetimeStartGas").val())}),$("#datetimeStartPressure").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStartPressure").datetimepicker("setEndDate",$("#datetimeEndPressure").val())}),$("#datetimeEndPressure").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEndPressure").datetimepicker("setStartDate",$("#datetimeStartPressure").val())})},clearAll:function(){var e=this;$("#datetimeStartGas").val(""),$("#datetimeEndGas").val(""),$("#datetimeStartPressure").val(""),$("#datetimeEndPressure").val("");new Date;e.setTime("gas","week"),e.setTime("pressure","week"),e.renderActive({gas:"week"}),e.renderActive({pressure:"week"}),$(".pressureMain").hide()}},facilityTable={init:function(){var e=this;e.getTable(),e.historyTable()},getTable:function(){var e=this;$("#tableFacility").bootstrapTable({url:"/cloudlink-inspection-event/facility/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",toolbar:"#toolbar",toolbarAlign:"left",cache:!1,showHeader:!0,showRefresh:!0,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return searchObj.defaultObj.pageSize=e.pageSize,searchObj.defaultObj.pageNum=e.pageNumber,searchObj.defaultObj},onLoadSuccess:function(e){1==e.success&&facilityMapObj.mapSetCenter(e.rows)},onDblClickRow:function(e){return facilityFrame._facilityId=e.objectId,facilityFrame.$facilityDetailsFrame.modal(),facilityFrame.clearfacilityDetails(),!1},columns:[{field:"state",checkbox:!0,align:"center",visible:!0,sortable:!1,width:"4%"},{field:"facilityName",title:"设施名称",align:"center",visible:!0,sortable:!1,width:"15%",editable:!0},{field:"facilityCode",title:"设施编号",align:"center",visible:!0,sortable:!1,width:"15%",editable:!0},{field:"facilityTypeName",title:"设施类型",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"pipelineTypeName",title:"管网类型",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0},{field:"facilityStatusName",title:"设施状态",align:"center",visible:!0,sortable:!1,width:"10%",formatter:function(e,t,a){return"<span class='atatus_"+t.facilityStatusCode+"'>"+e+"</span>"}},{field:"address",title:"详细位置",align:"center",visible:!0,sortable:!1,width:"21%",editable:!0},{field:"operate",title:"操作",align:"center",events:e.tableEvent(),width:"15%",formatter:e.tableOperation}]})},tableOperation:function(e,t,a){var i=null,n=null;return 1==JSON.parse(lsObj.getLocalStorage("userBo")).isSysadmin?(i="modify",n="delete"):t.createUserId==JSON.parse(lsObj.getLocalStorage("userBo")).objectId?(i="modify",n="delete"):(i="modify_end",n="delete_end"),['<a class="location" href="javascript:void(0)" title="定位">',"<i></i>","</a>",'<a class="look" href="javascript:void(0)" title="查看">',"<i></i>","</a>",'<a class="history" href="javascript:void(0)" title="历史检查">',"<i></i>","</a>",'<a class="'+i+'" href="javascript:void(0)" title="修改">',"<i></i>","</a>",'<a class="'+n+'" href="javascript:void(0)" title="删除">',"<i></i>","</a>"].join("")},tableEvent:function(){return{"click .location":function(e,t,a,i){return"active"==$(this).find("i").attr("class")||($(".location").find("i").attr("class",""),$(this).find("i").attr("class","active"),facilityMapObj.locationClick(a)),$("body,html").animate({scrollTop:0},500),!1},"click .look":function(e,t,a,i){return facilityFrame._facilityId=a.objectId,facilityFrame.$facilityDetailsFrame.modal(),facilityFrame.clearfacilityDetails(),!1},"click .modify":function(e,t,a,i){return facilityFrame._facilityId=a.objectId,facilityFrame.$modifyFacilityFrame.modal(),!1},"click .history":function(e,t,a,i){return facilityFrame._facilityId=a.objectId,facilityFrame._facilityTypeCode=a.facilityTypeCode,facilityFrame.$historyFrame.modal(),!1},"click .delete":function(e,t,a,i){var n={tip:"您是否删除该设施，同时删除相关的检查记录？",name_title:"提示",name_cancel:"取消",name_confirm:"确定",isCancelBtnShow:!0,callBack:function(){facilityFrame.facilityDelete(a.objectId)}};return xxwsWindowObj.xxwsAlert(n),!1}}},historyTable:function(){var e=this,t={startDate:"",endDate:"",facilityCheckResult:"",isLeakage:"",facilityTypeCode:"",keyword:"",facilityId:"0",pageNum:1,pageSize:10};$("#tableHistory").bootstrapTable({url:"/cloudlink-inspection-event/facilityRecord/getPageList?token="+lsObj.getLocalStorage("token"),method:"post",cache:!1,showHeader:!0,pagination:!0,striped:!0,sidePagination:"server",pageNumber:1,pageSize:10,pageList:[10,20,50],search:!1,searchOnEnterKey:!1,queryParamsType:"",queryParams:function(e){return t.pageSize=e.pageNumber,t.pageNum=e.pageSize,t},onLoadSuccess:function(e){e.success},onDblClickRow:function(e){return facilityFrame._recordId=e.objectId,historyDetailsObj.$historyDetailsFrame.modal(),historyDetailsObj.clearHistoryDetails(),!1},columns:[[{field:"facilityCheckTime",title:"检查时间",align:"center",visible:!0,sortable:!1,width:"24%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"isLeakageName",title:"漏气状态",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"pressureSituationName",title:"压力情况",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"pressure",title:"压力",align:"center",width:"16%",colspan:2,rowspan:1},{field:"isSeeperName",title:"井内有无积水",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"isWellCoverDamageName",title:"井盖是否损坏",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"isOccupyName",title:"有无占压",align:"center",visible:!0,sortable:!1,width:"8%",valign:"middle",colspan:1,rowspan:2},{field:"flowmeterData",
title:"流量计读数（m<sup>3</sup>）",align:"center",visible:!0,sortable:!1,width:"14%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"isFacilityWorkName",title:"设施运行情况",align:"center",visible:!0,sortable:!1,width:"14%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"facilityCheckResultName",title:"检查结果",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"createUserName",title:"检查人",align:"center",visible:!0,sortable:!1,width:"10%",editable:!0,valign:"middle",colspan:1,rowspan:2},{field:"operate",title:"操作",align:"center",events:e.historyTableEvent(),width:"8%",formatter:e.historyTableOperation,valign:"middle",colspan:1,rowspan:2}],[{field:"pressureIn",title:"进口(kPa)",align:"center",visible:!0,sortable:!1,width:"8%",editable:!0,colspan:1,rowspan:1},{field:"pressureOut",title:"出口(kPa)",align:"center",visible:!0,sortable:!1,width:"8%",colspan:1,rowspan:1}]]})},getHistoryTable:function(e,t){var a={startDate:"",endDate:"",facilityCheckResult:"",isLeakage:"","facilityTypeCode ":"",keyword:"",facilityId:e,pageNum:1,pageSize:10};switch($("#tableHistory").bootstrapTable("refreshOptions",{queryParams:function(e){return a.pageNum=e.pageNumber,a.pageSize=e.pageSize,a}}),t){case"FT_01":$("#tableHistory").bootstrapTable("showColumn","pressureSituationName"),$("#tableHistory").bootstrapTable("showColumn","pressureIn"),$("#tableHistory").bootstrapTable("showColumn","pressureOut"),$("#tableHistory").bootstrapTable("hideColumn","isSeeperName"),$("#tableHistory").bootstrapTable("hideColumn","isWellCoverDamageName"),$("#tableHistory").bootstrapTable("hideColumn","isOccupyName"),$("#tableHistory").bootstrapTable("hideColumn","flowmeterData");break;case"FT_04":$("#tableHistory").bootstrapTable("hideColumn","pressureSituationName"),$("#tableHistory").bootstrapTable("hideColumn","pressureIn"),$("#tableHistory").bootstrapTable("hideColumn","pressureOut"),$("#tableHistory").bootstrapTable("showColumn","isSeeperName"),$("#tableHistory").bootstrapTable("showColumn","isWellCoverDamageName"),$("#tableHistory").bootstrapTable("showColumn","isOccupyName"),$("#tableHistory").bootstrapTable("hideColumn","flowmeterData"),$("th[data-field='pressure']").hide();break;case"FT_10":$("#tableHistory").bootstrapTable("showColumn","pressureSituationName"),$("#tableHistory").bootstrapTable("hideColumn","pressureIn"),$("#tableHistory").bootstrapTable("hideColumn","pressureOut"),$("#tableHistory").bootstrapTable("hideColumn","isSeeperName"),$("#tableHistory").bootstrapTable("hideColumn","isWellCoverDamageName"),$("#tableHistory").bootstrapTable("hideColumn","isOccupyName"),$("#tableHistory").bootstrapTable("showColumn","flowmeterData"),$("th[data-field='pressure']").hide();break;default:$("#tableHistory").bootstrapTable("hideColumn","pressureSituationName"),$("#tableHistory").bootstrapTable("hideColumn","pressureIn"),$("#tableHistory").bootstrapTable("hideColumn","pressureOut"),$("#tableHistory").bootstrapTable("hideColumn","isSeeperName"),$("#tableHistory").bootstrapTable("hideColumn","isWellCoverDamageName"),$("#tableHistory").bootstrapTable("hideColumn","isOccupyName"),$("#tableHistory").bootstrapTable("hideColumn","flowmeterData"),$("th[data-field='pressure']").hide()}},historyTableOperation:function(e,t,a){return['<a class="look" href="javascript:void(0)" title="查看">',"<i></i>","</a>"].join("")},historyTableEvent:function(){return{"click .look":function(e,t,a,i){return facilityFrame._recordId=a.objectId,historyDetailsObj.$historyDetailsFrame.modal(),historyDetailsObj.clearHistoryDetails(),!1}}}},searchObj={$items:$(".top .item"),$searchInput:$("#searchInput"),$startDate:$("#datetimeStart"),$endDate:$("#datetimeEnd"),defaultObj:{facilityStatusCode:"",pipelineTypeCode:"",facilityTypeCodeList:[],startDate:"",endDate:"",keyword:"",pageNum:1,pageSize:10},querryObj:{facilityStatusCode:"",pipelineTypeCode:"",facilityTypeCodeList:[],startDate:"",endDate:"",keyword:"",pageNum:1,pageSize:10},activeObj:{facilityStatusCode:"",pipelineTypeCode:"",facilityTypeCodeList:"",date:"all"},init:function(){this.renderActive(),this.bindEvent(),this.bindDateDiyEvent()},renderActive:function(e){var t=this;e||(e=t.activeObj);for(var a in e){var i=t.$items.parent("[data-class="+a+"]");i.find(".item").removeClass("active"),i.find('.item[data-value="'+e[a]+'"]').addClass("active"),"date"===a&&("diy"===e[a]?$("#item_diy").addClass("active"):$("#item_diy").removeClass("active"))}},bindEvent:function(){var e=this;e.$items.click(function(){var t=$(this).parent().attr("data-class"),a=$(this).attr("data-value");"date"===t?e.setDate(a):e.querryObj[t]="facilityTypeCodeList"==t?""==a?[]:[a]:a;var i={};i[t]=a,e.renderActive(i),e.refreshTable(),console.log(e.querryObj)}),$("#gf_Btn").click(function(){var t=$(this).parent().find("input").val().trim();e.querryObj.keyword=t,e.refreshTable()}),e.$searchInput.keypress(function(t){t&&13===t.keyCode&&e.refreshTable()}),$("#search_more").click(function(){$(this).hasClass("active")?($(this).removeClass("active"),$(".more_item_wrapper").slideUp()):($(this).addClass("active"),$(".more_item_wrapper").slideDown())}),$("#gf_reset_Btn").click(function(){$.extend(e.querryObj,e.defaultObj),e.$startDate.val(""),e.$endDate.val(""),e.$searchInput.val(""),$("#diyDateBtn").removeClass("active"),e.renderActive(),e.refreshTable()}),$("#diyDateBtn").on("click",function(){var t=e.$startDate.val(),a=e.$endDate.val();return t?a?(e.querryObj.startDate=t,e.querryObj.endDate=a,e.renderActive({date:"diy"}),void e.refreshTable()):void xxwsWindowObj.xxwsAlert("请选择结束时间"):void xxwsWindowObj.xxwsAlert("请选择起始时间")})},setDate:function(e){var t=this;switch(e){case"day":var a=(new Date).Format("yyyy-MM-dd");t.querryObj.startDate=a,t.querryObj.endDate=a;break;case"week":var a=new Date;t.querryObj.startDate=a.getWeekStartDate().Format("yyyy-MM-dd"),t.querryObj.endDate=a.getWeekEndDate().Format("yyyy-MM-dd");break;case"month":var a=new Date;t.querryObj.startDate=a.getMonthStartDate().Format("yyyy-MM-dd"),t.querryObj.endDate=a.getMonthEndDate().Format("yyyy-MM-dd");break;default:t.querryObj.startDate="",t.querryObj.endDate=""}},refreshTable:function(){var e=this;e.querryObj.keyword=e.$searchInput.val().trim(),e.$searchInput.val(e.querryObj.keyword),e.querryObj.pageNum="1",$("#tableFacility").bootstrapTable("removeAll"),$("#tableFacility").bootstrapTable("refreshOptions",{pageNumber:+e.querryObj.pageNum,pageSize:+e.querryObj.pageSize,queryParams:function(t){return e.querryObj.pageSize=t.pageSize,e.querryObj.pageNum=t.pageNumber,e.querryObj}})},bindDateDiyEvent:function(){$("#datetimeStart").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())}),$("#datetimeEnd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0}).on("click",function(){$("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())}),$("#dateTimeAdd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,endDate:new Date}),$("#dateTimeModify").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,endDate:new Date}),$("#investmentTimeAdd").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,endDate:new Date}),$("#investmentTimeModify").datetimepicker({format:"yyyy-mm-dd",minView:"month",language:"zh-CN",autoclose:!0,endDate:new Date})}},exportFileObj={$exportAll:$("#export_all"),$exportChoice:$("#export_choice"),expoerObj:{facilityStatusCode:"",pipelineTypeCode:"",facilityTypeCode:"",startDate:"",endDate:"",keyword:"",pageNum:1,pageSize:10,idList:[]},init:function(){var e=this;this.$exportAll.click(function(){e.expoerObj.idList=[],e.expoerCondition()}),this.$exportChoice.click(function(){var t=$("#tableFacility").bootstrapTable("getSelections");if(e.expoerObj.idList=[],0==t.length)return xxwsWindowObj.xxwsAlert("请选择你需要导出的设施！"),!1;for(var a=0;a<t.length;a++)e.expoerObj.idList.push(t[a].objectId);e.expoerCondition()})},expoerCondition:function(){$.extend(this.expoerObj,searchObj.querryObj),this.expoerData(this.expoerObj)},expoerData:function(e){var t={url:"/cloudlink-inspection-event/facility/exportExcel?token="+lsObj.getLocalStorage("token"),data:e,method:"post"};this.downLoadFile(t)},downLoadFile:function(e){var t=$.extend(!0,{method:"post"},e),a=$('<iframe id="down-file-iframe" />'),i=$('<form target="down-file-iframe" method="'+t.method+'" />');i.attr("action",t.url);for(var n in t.data)i.append('<input type="hidden" name="'+n+'" value="'+t.data[n]+'" />');a.append(i),$(document.body).append(a),i[0].submit(),a.remove()}},fileObj={fileElem:document.getElementById("fileElem"),path:null,fileList:document.getElementById("fileList"),_mun:0,_isModify:null,init:function(){var e=this;$(".facilityFileAdd .addImg").click(function(){e._isModify=!1,$(".facilityFileAdd").find(".feedback_images").length<=5?$(".facilityFileAdd .upload_file").trigger("click"):xxwsWindowObj.xxwsAlert("最多上传六张图片")}),$(".facilityFileModity .addImg").click(function(){e._isModify=!0,$(".facilityFileModity").find(".feedback_images").length<=5?$(".facilityFileModity .upload_file").trigger("click"):xxwsWindowObj.xxwsAlert("最多上传六张图片")}),window.URL=window.URL||window.webkitURL},handleFiles:function(e){var t=this,a=e.value.substring(e.value.lastIndexOf("."),e.value.length);if(".jpg"!=(a=a.toLowerCase())&&".gif"!=a&&".jpeg"!=a&&".png"!=a&&".bmp"!=a)alert("对不起，系统仅支持标准格式的照片，请您调整格式后重新上传，谢谢 !"),e.focus();else{var i=e.files,n=new Image;if(window.URL)t.path=window.URL.createObjectURL(i[0]),n.onload=function(e){window.URL.revokeObjectURL(this.src)};else if(window.FileReader){var r=new FileReader;r.readAsDataURL(i[0]),r.onload=function(e){t.path=this.result}}else{e.select(),e.blur();var l=document.selection.createRange().text;document.selection.empty(),t.path=l,n.onload=function(){}}t._mun++;var s='<div class="feedback_images"><img src="'+t.path+'" alt=""/><span onclick="closeImg(this);" data-key="'+t._mun+'"></span></div>',o={"data-value":t._mun,id:"fileid"+t._mun,name:"file"},d='<input type="file" onchange="handleFiles(this);"  class="upload_file"/>';1==t._isModify?($(".facilityFileModity .feedback_img_list").append(s),$(".facilityFileModity .feedback_img_file").find("input").attr("class",""),$(".facilityFileModity .feedback_img_file").find("input").last().attr(o),$(".facilityFileModity .feedback_img_file").append(d)):($(".facilityFileAdd .feedback_img_list").append(s),$(".facilityFileAdd .feedback_img_file").find("input").attr("class",""),$(".facilityFileAdd .feedback_img_file").find("input").last().attr(o),$(".facilityFileAdd .feedback_img_file").append(d))}}};$(function(){$("input[type=text]").val(""),searchObj.init(),facility.init(),facilityTable.init(),facilityFrame.init(),exportFileObj.init(),fileObj.init(),facilityChart.init(),facilityMapObj.init(),drafting("facilityMap","drafting_down"),pipeLineObj.init(facilityMapObj.$bdMap),pipelinebtnObj.init($(".facility_map")),$(document).on("show.bs.modal",".modal",function(e){var t=1040+10*$(".modal:visible").length;$(this).css("z-index",t),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",t-1).addClass("modal-stack")},0)}),$(document).on("hidden.bs.modal",".modal",function(e){$(".modal:visible").length>0&&$("body").addClass("modal-open")})});