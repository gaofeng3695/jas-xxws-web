function initUser(){token=lsObj.getLocalStorage("token");var e=JSON.parse(lsObj.getLocalStorage("userBo"));if(""!=e.userName&&null!=e.userName&&$("#name").val(e.userName),""!=e.age&&null!=e.age&&$("#age").val(e.age),""!=e.sex&&null!=e.sex&&$(".selectsex").val(e.sex),""!=e.orgName&&null!=e.orgName&&$("#dept").text(e.orgName),""!=e.position&&null!=e.position&&$("#position").text(e.position),""!=e.mobileNum&&null!=e.mobileNum&&$("#tel").text(e.mobileNum),""!=e.qq&&null!=e.qq&&$("#qq").val(e.qq),""!=e.wechat&&null!=e.wechat&&$("#weixin").val(e.wechat),""!=e.email&&null!=e.email&&$("#email").val(e.email),""!=e.profilePhoto&&null!=e.profilePhoto){personalImg_fileId=e.profilePhoto;var t="/cloudlink-core-file/file/getImageBySize?fileId="+personalImg_fileId+"&viewModel=fill&width=500&hight=500";$("#userImg").attr("src",t),$("#userImg").attr("alt","预览")}$("#uploadfile").change(function(){var e,t=(this.value.lastIndexOf("."),this.files[0]);window.URL&&(e=window.URL.createObjectURL(t));var a=new Image;a.src=e,a.onload=function(t){$("#userImg").attr("src",e),$("#userImg").removeAttr("alt"),window.URL.revokeObjectURL(this.src)}})}function getNewUserBo(){var e=JSON.parse(lsObj.getLocalStorage("userBo"));$.ajax({type:"GET",url:"/cloudlink-core-framework/user/getById?objectId="+e.objectId+"&token="+lsObj.getLocalStorage("token")+"&enterpriseId="+e.enterpriseId,contentType:"application/json",dataType:"json",success:function(e){1==e.success?(lsObj.setLocalStorage("userBo",JSON.stringify(e.rows[0])),initUser(),parent.initPersonal()):(initUser(),parent.initPersonal())}})}function upload_Img(){var e=JSON.parse(lsObj.getLocalStorage("userBo")),t=(lsObj.getLocalStorage("token"),$('input[type="file"]').attr("id"));$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/web/v1/save?businessId="+e.objectId+"&bizType=pic&token="+lsObj.getLocalStorage("token"),secureuri:!1,fileElementId:t,dataType:"json",type:"POST",async:!1,success:function(e,t){1==e.success?updateUserBoImg():xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})}function base_personal(){var e=JSON.parse(lsObj.getLocalStorage("userBo"));nameVal=$("#name").val().trim(),e.userName=nameVal,sexVal=$(".selectsex").val(),e.sex=sexVal;var t={objectId:e.objectId,userName:nameVal,sex:sexVal};if(ageVal=$("#age").val().trim(),e.age=ageVal,""!=ageVal&&null!=ageVal){if(t.age=ageVal,!checkage())return}else t.age=null;if(qqVal=$("#qq").val().trim(),t.qq=qqVal,e.qq=qqVal,(""==qqVal||null==qqVal||checkQQ())&&(weixinVal=$("#weixin").val().trim(),e.wechat=weixinVal,t.wechat=weixinVal,emailVal=$("#email").val().trim(),t.email=emailVal,e.email=emailVal,""==emailVal||null==emailVal||checkemail())){null!=upload_fileId&&""!=upload_fileId&&(e.profilePhoto=upload_fileId,t.profile_photo=upload_fileId);var a=vialidForm();a&&$.ajax({type:"POST",url:"/cloudlink-core-framework/user/update?token="+lsObj.getLocalStorage("token"),contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){1==t.success?(lsObj.setLocalStorage("userBo",JSON.stringify(e)),parent.initPersonal(),xxwsWindowObj.xxwsAlert("修改成功",function(){location.reload()})):xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})}}function deleteAnduploadImg(){var e=JSON.parse(lsObj.getLocalStorage("userBo")),t=(lsObj.getLocalStorage("token"),$('input[type="file"]').attr("id"));$.ajaxFileUpload({url:"/cloudlink-core-file/attachment/update?businessId="+e.objectId+"&bizType=pic&token="+lsObj.getLocalStorage("token")+"&fileId="+personalImg_fileId,secureuri:!1,fileElementId:t,dataType:"json",type:"POST",async:!1,success:function(e){1==e.success&&(upload_fileId=e.rows[0].fileId,base_personal())}})}function updateUserBoImg(){var e={businessId:JSON.parse(lsObj.getLocalStorage("userBo")).objectId,bizType:"pic"};$.ajax({type:"GET",url:"/cloudlink-core-file/attachment/getFileIdListByBizIdAndBizAttr?&toke="+lsObj.getLocalStorage("token"),contentType:"application/json",data:e,dataType:"json",success:function(e){1==e.success?(e.rows.length>0&&(upload_fileId=e.rows[0].fileId),base_personal()):xxwsWindowObj.xxwsAlert("服务异常，请稍候重试")}})}function vialidForm(){var e=$("#userImg").attr("src");return!!checkName()&&(!(e.indexOf("upload.png")>1)||($("#Imgnote").text("请上传个人头像"),!1))}function checkName(){var e=$("#name").val().trim(),t=/^[a-zA-Z\u4e00-\u9fa5]/g;return null==e||""==e?($("#namenote").text("请输入姓名"),!1):e.length>=16?($("#namenote").text("姓名不能超过15个字"),!1):1<e.length<16&&(t.test(e)?($("#namenote").text(""),!0):($("#namenote").text("您输入格式不对"),!1))}function checkage(){var e=$("#age").val().trim(),t=/^[0-9]*$/;return null==e||""==e?($("#agenote").text(""),!0):t.test(e)?parseInt(e)>100?($("#agenote").text("您输入年龄不对"),!1):($("#agenote").text(""),!0):($("#agenote").text("您输入格式不对"),!1)}function checktel(){var e=$("#tel").val().trim(),t=/^(((17[0-9]{1})|(13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;return null==e||""==e?($("#telnote").text("请输入手机号"),!1):t.test(e)?($("#telnote").text(""),!0):($("#telnote").text("您输入的电话号码有错误"),!1)}function checkQQ(){var e=$("#qq").val().trim(),t=/^[1-9][0-9]{4,9}$/;return null==e||""==e?($("#qqnote").text(""),!0):t.test(e)?($("#qqnote").text(""),!0):($("#qqnote").text("您输入的 QQ号码有误"),!1)}function checkemail(){var e=$("#email").val().trim(),t=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;return null==e||""==e?($("#emailnote").text(""),!0):t.test(e)?($("#emailnote").text(""),!0):($("#emailnote").text("您输入的邮箱地址有误"),!1)}$(function(){getNewUserBo()});var personalImg_fileId=null,upload_fileId=null;$(".uploadpicture").click(function(){$("#uploadfile").trigger("click")}),$(".btn").click(function(){var e=$("#userImg").attr("alt"),t=$("#userImg").attr("src");"undefined"==e||t.indexOf("upload.png")>1||"预览"==e?base_personal():null==personalImg_fileId||""==personalImg_fileId?upload_Img():deleteAnduploadImg()}),$("#name").blur(function(){checkName()}),$("#age").blur(function(){checkage()}),$("#tel").blur(function(){checktel()}),$("#qq").blur(function(){checkQQ()}),$("#email").blur(function(){checkemail()});